
<!doctype html>
<html lang="en" prefix="og: https://ogp.me/ns#">
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0J2P9316N6"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-0J2P9316N6');
</script>
<meta charset="utf-8"/>
<title>Securing applications with DPoP - Keycloak</title>
<meta name="twitter:card" content="summary_large">
<meta name="twitter:site" content="@keycloak">
<meta property="og:site_name" content="Keycloak">
<meta property="og:title" content="Securing applications with DPoP">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" property="og:description" content="Guide for securing applications with DPoP using Keycloak">
<meta name="author" content="Keycloak Team">
<meta name="keywords" content="sso,idm,openid connect,saml,kerberos,ldap">
<meta name="robots" content="noindex">
<link href="https://www.keycloak.org/resources/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://www.keycloak.org/resources/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link href="https://www.keycloak.org/resources/css/keycloak.css" rel="stylesheet">
<link rel="canonical" href="https://www.keycloak.org/nightly/securing-apps/dpop">
<meta property="og:url" content="https://www.keycloak.org/nightly/securing-apps/dpop">
<link rel="icon" type="image/x-icon" href="https://www.keycloak.org/resources/favicon.ico">
<link rel="icon" type="image/vnd.microsoft.icon" href="https://www.keycloak.org/resources/favicon.ico">
<link rel="icon" type="image/svg+xml" href="https://www.keycloak.org/resources/favicon.svg"></head>
<body>

<header class="navbar navbar-expand-md bg-light shadow-sm">
<nav class="container-xxl flex-wrap flex-md-no-wrap navbar-light" data-nosnippet>
    <a class="navbar-brand me-3 me-md-4 me-lg-5" href="https://www.keycloak.org/">
        <img style="aspect-ratio: 730/151" class="img-fluid" src="https://www.keycloak.org/resources/images/logo.svg" width="240" alt="Keycloak"/>
    </a>
    <a class="nav-link d-none d-sm-block d-md-none d-lg-block" href="https://github.com/keycloak/keycloak"><img src="https://www.keycloak.org/resources/images/stars-large.svg" style="height: 25px; aspect-ratio: 128/20" alt="GitHub stars"/></a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="fa fa-bars fa-lg px-1 py-2"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
      <ul class="navbar-nav flex-row flex-wrap bd-navbar-nav pt-2 py-md-0">
        <li class="nav-item col-6 col-md-auto">
          <a class="nav-link " href="https://www.keycloak.org/guides">Guides</a>
        </li>
        <li class="nav-item col-6 col-md-auto">
          <a class="nav-link " href="https://www.keycloak.org/documentation">Docs</a>
        </li>
        <li class="nav-item col-6 col-md-auto">
          <a class="nav-link " href="https://www.keycloak.org/downloads">Downloads</a>
        </li>
        <li class="nav-item col-6 col-md-auto">
          <a class="nav-link " href="https://www.keycloak.org/community">Community</a>
        </li>
        <li class="nav-item col-6 col-md-auto">
          <a class="nav-link " href="https://www.keycloak.org/blog">Blog</a>
        </li>
      </ul>
    </div>
    <div class="d-block d-sm-none d-md-block d-lg-none text-center vw-100">
        <a class="nav-link d-inline p-0" href="https://github.com/keycloak/keycloak"><img src="https://www.keycloak.org/resources/images/stars-large.svg" style="height: 25px; aspect-ratio: 128/20" alt="GitHub stars"/></a>
    </div>
</nav>
</header>


<div class="container mt-5 kc-article">
    <div class="row">
        <div class="col-md-9 col-xl-10 col-sm-12">
            <div class="d-flex align-items-center mb-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item"><a href="https://www.keycloak.org/nightly/guides">Guides</a></li>
                        <li class="breadcrumb-item"><a href="https://www.keycloak.org/nightly/guides#securing-apps">Securing applications</a></li>
                        <li class="breadcrumb-item active">Securing applications with DPoP</li>
                    </ol>
                </nav>
            </div>

                <div class="mb-4 alert alert-warning" role="alert">
                  <h4 class="no-top-margin">Nightly release</h4>

                  This guide is for the unstable nightly release, for the latest release go <a href="https://www.keycloak.org/securing-apps/dpop">here</a>.
                </div>

            <div class="mb-4">
                <div data-nosnippet class="me-3 float-end">
                    <select aria-label="Version" onchange="location = this.options[this.selectedIndex].value;" class="form-select">
                        <option value="https://www.keycloak.org/nightly/securing-apps/dpop" selected="selected">Nightly</option>
                        <option value="https://www.keycloak.org/securing-apps/dpop" >26.5.3</option>
                    </select>
                </div>

                <h1>Securing applications with DPoP</h1>
                    <span class="text-muted">Guide for securing applications with DPoP using Keycloak</span>
            </div>



            <div class="kc-asciidoc" id="guide-body">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Standard OAuth 2.0 access tokens are typically <strong>Bearer</strong> tokens. Any party in possession of the token can use it to access protected resources, regardless of whether they are the legitimate client. If a Bearer token is leaked (e.g., via server logs, network interception, or browser storage), it is vulnerable to unauthorized reuse, known as a replay attack.</p>
</div>
<div class="paragraph">
<p><strong>OAuth 2.0 Demonstrating Proof-of-Possession (DPoP)</strong>, defined in <a href="https://datatracker.ietf.org/doc/html/rfc9449">RFC 9449</a>, mitigates this risk by making tokens <strong>Sender-Constrained</strong>.</p>
</div>
<div class="paragraph">
<p>DPoP binds the access and refresh token to a public/private key pair generated by the client. When accessing a resource, the client must prove it holds the private key corresponding to the token. Consequently, even if an attacker steals a DPoP-bound access token, it cannot be used without the clientâ€™s private key.</p>
</div>
<div class="paragraph">
<p>This guide explains the mechanics of DPoP and how to use it with Keycloak.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_when_to_use_dpop"><a class="anchor" href="#_when_to_use_dpop"></a>When to use DPoP</h2>
<div class="sectionbody">
<div class="paragraph">
<p>While DPoP offers superior security, it adds complexity to the client implementation. It is best used in environments where the risk of token leakage is high or where security compliance is strict.</p>
</div>
<div class="paragraph">
<p>Typical use cases include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Public clients</strong>: Single Page Applications (SPAs) or native mobile apps where client secrets cannot be securely stored.</p>
</li>
<li>
<p><strong>Browser-based applications</strong>: Where tokens might be exposed via XSS, browser storage, or malicious extensions.</p>
</li>
<li>
<p><strong>High-security environments</strong>: Where preventing token replay is a strict compliance requirement (e.g., Financial Grade API).</p>
</li>
<li>
<p><strong>Avoid chaining of services</strong>: Application authenticated with Keycloak invokes the REST service service1 with the access token. The service1 should be able to consume the access token, but it should not be able to use that token to invoke further services on behalf of the original application.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dpop_concepts"><a class="anchor" href="#_dpop_concepts"></a>DPoP Concepts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At its core, DPoP uses asymmetric cryptography to change the security model from "Bearer" (whoever holds the token has access) to "Sender-Constrained" (only the legitimate owner of the token has access).</p>
</div>
<div class="paragraph">
<p>The mechanism relies on two fundamental steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Key Binding:</strong> When the client authenticates to receive an access token, it generates a public/private key pair and shares the public key with Keycloak. Keycloak computes a cryptographic fingerprint (thumbprint) of this public key and embeds it directly into the issued access token. The token is now mathematically bound to that specific key pair.</p>
</li>
<li>
<p><strong>Proof of Possession:</strong> Whenever the client uses the token to access a protected resource, it must cryptographically sign the request using its private key. The Resource Server checks this signature against the fingerprint embedded in the access token. If the signature is valid, it proves the requestor holds the private key and is therefore the legitimate owner of the token.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dpop_proof"><a class="anchor" href="#_dpop_proof"></a>DPoP Proof</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To technically implement the <strong>Proof of Possession</strong> mechanism described above DPoP introduces the <strong>DPoP proof</strong>, a JWT created and signed by the client and sent in the <code>DPoP</code> HTTP header. For every HTTP request, the client must generate a new, unique JWT DPoP Proof.</p>
</div>
<div class="paragraph">
<p>This proof serves two purposes: it proves ownership of a public key, and it binds the request to a specific URL and HTTP method to prevent replay attacks.</p>
</div>
<div class="sect2">
<h3 id="_the_dpop_proof_header"><a class="anchor" href="#_the_dpop_proof_header"></a>The DPoP Proof Header</h3>
<div class="paragraph">
<p>The <strong>Header</strong> of the DPoP proof JWT must contain the public key itself.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>typ</code>: MUST be <code>dpop+jwt</code>.</p>
</li>
<li>
<p><code>alg</code>: An asymmetric digital signature algorithm (e.g., <code>ES256</code>, <code>RS256</code>).</p>
</li>
<li>
<p><code>jwk</code>: The public key chosen by the client in JSON Web Key (JWK) format.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">DPoP Proof Header Example</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "typ": "dpop+jwt",
  "alg": "ES256",
  "jwk": {
    "kty": "EC",
    "crv": "P-256",
    "x": "f83OJ3D2xF4...",
    "y": "x_FEzRu9Yq8..."
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_dpop_proof_body"><a class="anchor" href="#_the_dpop_proof_body"></a>The DPoP Proof Body</h3>
<div class="paragraph">
<p>The <strong>Body</strong> binds the proof to the specific HTTP request to prevent replay attacks.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>jti</code>: A unique identifier for the proof.</p>
</li>
<li>
<p><code>htm</code>: The HTTP method (e.g., <code>POST</code>, <code>GET</code>).</p>
</li>
<li>
<p><code>htu</code>: The HTTP target URI without query and fragment parts.</p>
</li>
<li>
<p><code>iat</code>: Creation timestamp.</p>
</li>
<li>
<p><code>ath</code>: <strong>Access Token Hash</strong>. Required when accessing resources. It is the base64url encoded SHA-256 hash of the access token.</p>
</li>
<li>
<p><code>nonce</code>: Included only if the server explicitly requests it via a <code>DPoP-Nonce</code> header.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">DPoP Proof Body Example</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "jti": "BwC3ESc6acc2lTc",
  "htm": "POST",
  "htu": "https://keycloak.org/realms/test/protocol/openid-connect/token",
  "iat": 1562262616
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_dpop_flow"><a class="anchor" href="#_the_dpop_flow"></a>The DPoP flow</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Implementing DPoP changes the interaction between the client application and Keycloak. The following section and diagram illustrate the end-to-end lifecycle of a DPoP-bound session.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.keycloak.org/resources/images/guides/nightly/dpop-flow.dio.svg" alt="DPoP flow">
</div>
<div class="title">Figure 1. DPoP flow</div>
</div>
<div class="sect2">
<h3 id="_1_token_binding"><a class="anchor" href="#_1_token_binding"></a>1. Token Binding</h3>
<div class="paragraph">
<p>When the client sends a token request to Keycloak, it must first generate a key pair. It keeps the private key secure, generates the DPoP proof and sends the key inside a DPoP proof JWT header during the token request.</p>
</div>
<div class="paragraph">
<p>Keycloak validates the proof and issues an access token. Keycloak takes the public key from the proof, calculates its "thumbprint" (base64url encoded SHA-256 hash of the JWK), and embeds it directly into the access token in a claim called <code>cnf</code> (confirmation).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-http" data-lang="http">POST /realms/myrealm/protocol/openid-connect/token HTTP/1.1
DPoP: &lt;DPoP-Proof-JWT&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting JWT access token now carries the SHA-256 thumbprint of the client&#8217;s key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "iss": "https://keycloak.org/realms/test",
  "token_type": "DPoP",
  "cnf": {
    "jkt": "0ZcOCORZNYy-DWpqq30jZyJGHTN0d2HglBV3uiguA4I"
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_2_resource_access"><a class="anchor" href="#_2_resource_access"></a>2. Resource Access</h3>
<div class="paragraph">
<p>When the client calls a protected API, it must send two things: the access token (in the <code>Authorization</code> header) and a <strong>new</strong> DPoP proof (in the <code>DPoP</code> header).</p>
</div>
<div class="paragraph">
<p>The Resource Server performs a check that standard Bearer validation does not: it compares the key inside the DPoP proof with the thumbprint inside the access token. If they don&#8217;t match, or if the proof is missing, access is denied.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-http" data-lang="http">GET /protected-resource HTTP/1.1
Authorization: DPoP &lt;The-Access-Token&gt;
DPoP: &lt;New-DPoP-Proof&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that when using DPoP-bound tokens, the Authorization scheme is DPoP, not Bearer.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_the_nonce_mechanism"><a class="anchor" href="#_the_nonce_mechanism"></a>The Nonce Mechanism</h3>
<div class="paragraph">
<p>To provide stricter protection against replay attacks, DPoP supports a challenge-response mechanism using a <strong>nonce</strong>.</p>
</div>
<div class="paragraph">
<p>If a Resource Server requires a nonce (or if the provided nonce is too old), it rejects the request with a <code>401 Unauthorized</code> status and includes a <code>DPoP-Nonce</code> HTTP header containing a new value. The client must then generate a new DPoP proof that includes this value in the <code>nonce</code> claim and retry the request. This ensures that a proof captured by an attacker cannot be replayed effectively, as the server will invalidate the underlying nonce after use or a short timeout.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_keycloak"><a class="anchor" href="#_configuring_keycloak"></a>Configuring Keycloak</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To force a client to use DPoP, you need to configure the client in the Admin Console.</p>
</div>
<div class="paragraph">
<p>Navigate to your client&#8217;s <strong>Capability config</strong> in the <strong>Settings</strong> section and locate the <strong>Require DPoP bound tokens</strong> switch.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>If enabled</strong>: The client <strong>must</strong> send a valid DPoP proof. All token requests must include a valid DPoP proof. If a client tries to send a token request without a valid DPoP Proof, the request will fail.</p>
</li>
<li>
<p><strong>If disabled</strong>: The client <strong>may</strong> send a DPoP proof. If the client sends a proof, Keycloak will bind the token. If not, it issues a standard Bearer token.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that this Keycloak switch maps to the <code>dpop_bound_access_tokens</code> client registration metadata defined by the DPoP specification.</p>
</div>
<div class="sect2">
<h3 id="_handling_refresh_tokens"><a class="anchor" href="#_handling_refresh_tokens"></a>Handling Refresh Tokens</h3>
<div class="paragraph">
<p>The behavior for refresh tokens differs slightly depending on the client type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Public Clients</strong>: Since these clients cannot hold secrets safely, DPoP is critical. Both the access token and the refresh token are bound to the key. The client must send the DPoP proof signed with the same private key also for the refresh request.</p>
</li>
<li>
<p><strong>Confidential Clients</strong>: These clients are already authenticated for example with Client ID and Secret. Therefore, Keycloak binds only the access token to the DPoP key, relying on the client credentials to secure the refresh token.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_other_keycloak_endpoints"><a class="anchor" href="#_other_keycloak_endpoints"></a>Other Keycloak Endpoints</h3>
<div class="paragraph">
<p>When Keycloak acts as a Resource Server, it strictly enforces DPoP checks on the following endpoints if a DPoP-bound token is used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>UserInfo Endpoint:</strong> Requires a valid DPoP proof matching the access token.</p>
</li>
<li>
<p><strong>Logout Endpoint:</strong> For public clients, the logout request (using a refresh token) requires a DPoP proof.</p>
</li>
<li>
<p><strong>Admin &amp; Account APIs:</strong> Any request to Keycloak&#8217;s internal REST APIs using a DPoP token must include a valid proof.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_client_policies"><a class="anchor" href="#_client_policies"></a>Client Policies</h3>
<div class="paragraph">
<p>For granular control, you can use the <strong>dpop-bind-enforcer</strong> executor within Client Policies. This is useful for advanced scenarios:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Auto-Configuration:</strong> Automatically enable DPoP requirements for all newly registered clients.</p>
</li>
<li>
<p><strong>Refresh Token Only:</strong> Enforce DPoP binding only for the Refresh Token while keeping the access token as a standard Bearer token. This increases security for public clients while maintaining compatibility with legacy resource servers that do not support DPoP.</p>
</li>
<li>
<p><strong>Strict OIDC Enforcement:</strong> Require clients to send the <code>dpop_jkt</code> parameter during the initial Authorization Code flow, binding the entire flow.</p>
</li>
</ul>
</div>
</div>
</div>
</div>            </div>
        </div>

        <div class="col-md-3 mt-4 col-xl-2 col-sm-12 bg-light">
            <div class="sticky-top px-2 py-3">
                <div class="mt-2 mb-2 fw-bold">On this page</div>
                <div id="js-toc"></div>
                <div class="mt-4">
                    <a href="https://github.com/keycloak/keycloak/tree/main/docs/guides/securing-apps/dpop.adoc" target="_blank"><i class="fa fa-edit"></i> Edit this guide</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://www.keycloak.org/resources/js/guide.js" type="text/javascript"></script>


<div class="container mt-5" data-nosnippet>
    <footer class="py-3 my-4 border-top">
        <p class="text-center text-muted">Keycloak is a Cloud Native Computing Foundation incubation project</p>
        <div class="text-center">
            <img style="aspect-ratio: 300/48" alt="Cloud Native Computing Foundation" src="https://www.keycloak.org/resources/images/cncf_logo.png" loading="lazy"/>
        </div>
        <p class="mt-4 text-center small text-muted">&copy; Keycloak Authors 2025. &copy; 2025 The Linux Foundation. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage">Trademark Usage page</a>.</p>
    </footer>
</div>

<script src="https://www.keycloak.org/resources/bootstrap/dist/js/bootstrap.min.js" type="text/javascript"></script>
<script src="https://www.keycloak.org/resources/tocbot/dist/tocbot.min.js" type="text/javascript"></script>
</body>
</html>
