
<!doctype html>
<html lang="en" prefix="og: https://ogp.me/ns#">
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0J2P9316N6"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-0J2P9316N6');
</script>
<meta charset="utf-8"/>
<title>Keycloak SAML Galleon feature pack detailed configuration - Keycloak</title>
<meta name="twitter:card" content="summary_large">
<meta name="twitter:site" content="@keycloak">
<meta property="og:site_name" content="Keycloak">
<meta property="og:title" content="Keycloak SAML Galleon feature pack detailed configuration">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" property="og:description" content="Review this detailed list of elements for the `keycloak-saml.xml` configuration file.">
<meta name="author" content="Keycloak Team">
<meta name="keywords" content="sso,idm,openid connect,saml,kerberos,ldap">
<link href="https://www.keycloak.org/resources/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://www.keycloak.org/resources/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link href="https://www.keycloak.org/resources/css/keycloak.css" rel="stylesheet">
<link rel="canonical" href="https://www.keycloak.org/securing-apps/saml-galleon-layers-detailed-config">
<meta property="og:url" content="https://www.keycloak.org/securing-apps/saml-galleon-layers-detailed-config">
<link rel="shortcut icon" href="https://www.keycloak.org/resources/favicon.svg"></head>
<body>

<header class="navbar navbar-expand-md bg-light shadow-sm">
<nav class="container-xxl flex-wrap flex-md-no-wrap navbar-light" data-nosnippet>
    <a class="navbar-brand me-3 me-md-4 me-lg-5" href="https://www.keycloak.org/">
        <img style="aspect-ratio: 730/151" class="img-fluid" src="https://www.keycloak.org/resources/images/logo.svg" width="240" alt="Keycloak"/>
    </a>
    <a class="nav-link d-none d-sm-block d-md-none d-lg-block" href="https://github.com/keycloak/keycloak"><img src="https://www.keycloak.org/resources/images/stars-large.svg" style="height: 25px; aspect-ratio: 128/20" alt="GitHub stars"/></a>
    <a class="nav-link d-block d-sm-none d-md-block d-lg-none" href="https://github.com/keycloak/keycloak"><img src="https://www.keycloak.org/resources/images/stars-small.svg" style="height: 25px; aspect-ratio: 59/20" alt="GitHub stars"/></a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="fa fa-bars fa-lg px-1 py-2"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
      <ul class="navbar-nav flex-row flex-wrap bd-navbar-nav pt-2 py-md-0">
        <li class="nav-item col-6 col-md-auto">
          <a class="nav-link " href="https://www.keycloak.org/guides">Guides</a>
        </li>
        <li class="nav-item col-6 col-md-auto">
          <a class="nav-link " href="https://www.keycloak.org/documentation">Docs</a>
        </li>
        <li class="nav-item col-6 col-md-auto">
          <a class="nav-link " href="https://www.keycloak.org/downloads">Downloads</a>
        </li>
        <li class="nav-item col-6 col-md-auto">
          <a class="nav-link " href="https://www.keycloak.org/community">Community</a>
        </li>
        <li class="nav-item col-6 col-md-auto">
          <a class="nav-link " href="https://www.keycloak.org/blog">Blog</a>
        </li>
      </ul>
    </div>
</nav>
</header>


<div class="container mt-5 kc-article">
    <div class="row">
        <div class="col-md-9 col-xl-10 col-sm-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="https://www.keycloak.org/guides">Guides</a></li>
                    <li class="breadcrumb-item"><a href="https://www.keycloak.org/guides#securing-apps">Securing applications</a></li>
                    <li class="breadcrumb-item active">Keycloak SAML Galleon feature pack detailed configuration</li>
                </ol>
            </nav>


            <div class="mb-4">
                <h1>Keycloak SAML Galleon feature pack detailed configuration</h1>
                    <span class="text-muted">Review this detailed list of elements for the `keycloak-saml.xml` configuration file.</span>
            </div>



            <div class="kc-asciidoc" id="guide-body">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This guide contains the detailed list of elements for the <code>keycloak-saml.xml</code> configuration file used by the Keycloak SAML Galleon feature pack.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sp_element"><a class="anchor" href="#_sp_element"></a>SP element</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Here is the explanation of the SP element attributes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;SP entityID="sp"
    sslPolicy="ssl"
    nameIDPolicyFormat="format"
    forceAuthentication="true"
    isPassive="false"
    keepDOMAssertion="true"
    autodetectBearerOnly="false"&gt;
...
&lt;/SP&gt;</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">entityID</dt>
<dd>
<p>This is the identifier for this client.
The IdP needs this value to determine who the client is that is communicating with it. This setting is <em>REQUIRED</em>.</p>
</dd>
<dt class="hdlist1">sslPolicy</dt>
<dd>
<p>This is the SSL policy the adapter will enforce.
Valid values are: <code>ALL</code>, <code>EXTERNAL</code>, and <code>NONE</code>.
For <code>ALL</code>, all requests must come in via HTTPS.
For <code>EXTERNAL</code>, only non-private IP addresses must come over the wire via HTTPS.
For <code>NONE</code>, no requests are required to come over via HTTPS.
This setting is <em>OPTIONAL</em>. Default value is <code>EXTERNAL</code>.</p>
</dd>
<dt class="hdlist1">nameIDPolicyFormat</dt>
<dd>
<p>SAML clients can request a specific NameID Subject format.
Fill in this value if you want a specific format.
It must be a standard SAML format identifier: <code>urn:oasis:names:tc:SAML:2.0:nameid-format:transient</code>.
This setting is <em>OPTIONAL</em>.
By default, no special format is requested.</p>
</dd>
<dt class="hdlist1">forceAuthentication</dt>
<dd>
<p>SAML clients can request that a user is re-authenticated even if they are already logged in at the IdP.
Set this to <code>true</code> to enable. This setting is <em>OPTIONAL</em>.
Default value is <code>false</code>.</p>
</dd>
<dt class="hdlist1">isPassive</dt>
<dd>
<p>SAML clients can request that a user is never asked to authenticate even if they are not logged in at the IdP.
Set this to <code>true</code> if you want this.
Do not use together with <code>forceAuthentication</code> as they are opposite. This setting is <em>OPTIONAL</em>.
Default value is <code>false</code>.</p>
</dd>
<dt class="hdlist1">turnOffChangeSessionIdOnLogin</dt>
<dd>
<p>The session ID is changed by default on a successful login on some platforms to plug a security attack vector.
Change this to <code>true</code> to disable this.  It is recommended you do not turn it off.
Default value is <code>false</code>.</p>
</dd>
<dt class="hdlist1">autodetectBearerOnly</dt>
<dd>
<p>This should be set to <em>true</em> if your application serves both a web application and web services (for example SOAP or REST).
It allows you to redirect unauthenticated users of the web application to the Keycloak login page,
but send an HTTP <code>401</code> status code to unauthenticated SOAP or REST clients instead as they would not understand a redirect to the login page.
Keycloak auto-detects SOAP or REST clients based on typical headers like <code>X-Requested-With</code>, <code>SOAPAction</code> or <code>Accept</code>.
The default value is <em>false</em>.</p>
</dd>
<dt class="hdlist1">logoutPage</dt>
<dd>
<p>This sets the page to display after logout. If the page is a full URL, such as <code><a href="http://web.example.com/logout.html" class="bare">http://web.example.com/logout.html</a></code>,
the user is redirected after logout to that page using the HTTP <code>302</code> status code. If a link without scheme part is specified,
such as <code>/logout.jsp</code>, the page is displayed after logout, <em>regardless of whether it lies in a protected area according
to <code>security-constraint</code> declarations in web.xml</em>, and the page is resolved relative to the deployment context root.</p>
</dd>
<dt class="hdlist1">keepDOMAssertion</dt>
<dd>
<p>This attribute should be set to <em>true</em> to make the adapter store the DOM representation of the assertion in its
original form inside the <code>SamlPrincipal</code> associated to the request. The assertion document can be retrieved using
the method <code>getAssertionDocument</code> inside the principal. This is specially useful when re-playing a signed assertion.
The returned document is the one that was generated parsing the SAML response received by the Keycloak server.
This setting is <em>OPTIONAL</em> and its default value is <em>false</em> (the document is not saved inside the principal).</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_saml-sp-keys"><a class="anchor" href="#_saml-sp-keys"></a>Service Provider keys and key elements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If the IdP requires that the client application (or SP) sign all of its requests and/or if the IdP will encrypt assertions, you must define the keys used to do this.
For client-signed documents you must define both the private and public key or certificate that is used to sign documents.
For encryption, you only have to define the private key that is used to decrypt it.</p>
</div>
<div class="paragraph">
<p>There are two ways to describe your keys.
They can be stored within a Java KeyStore or you can copy/paste the keys directly within <code>keycloak-saml.xml</code> in the PEM format.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">        &lt;Keys&gt;
            &lt;Key signing="true" &gt;
               ...
            &lt;/Key&gt;
        &lt;/Keys&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Key</code> element has two optional attributes <code>signing</code> and <code>encryption</code>.
When set to true these tell the adapter what the key will be used for.
If both attributes are set to true, then the key will be used for both signing documents and decrypting encrypted assertions.
You must set at least one of these attributes to true.</p>
</div>
<div class="sect2">
<h3 id="_saml-keystore"><a class="anchor" href="#_saml-keystore"></a>KeyStore element</h3>
<div class="paragraph">
<p>Within the <code>Key</code> element you can load your keys and certificates from a Java Keystore.  This is declared within
a <code>KeyStore</code> element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">        &lt;Keys&gt;
            &lt;Key signing="true" &gt;
                &lt;KeyStore resource="/WEB-INF/keystore.jks" password="store123"&gt;
                    &lt;PrivateKey alias="myPrivate" password="test123"/&gt;
                    &lt;Certificate alias="myCertAlias"/&gt;
                &lt;/KeyStore&gt;
            &lt;/Key&gt;
        &lt;/Keys&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here are the XML config attributes that are defined with the <code>KeyStore</code> element.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">file</dt>
<dd>
<p>File path to the key store. This option is <em>OPTIONAL</em>.  The file or resource attribute must be set.</p>
</dd>
<dt class="hdlist1">resource</dt>
<dd>
<p>WAR resource path to the KeyStore.
This is a path used in method call to ServletContext.getResourceAsStream(). This option is <em>OPTIONAL</em>.  The file or resource attribute must be set.</p>
</dd>
<dt class="hdlist1">password</dt>
<dd>
<p>The password of the KeyStore. This option is <em>REQUIRED</em>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If you are defining keys that the SP will use to sign document, you must also specify references to your private keys
and certificates within the Java KeyStore.
The <code>PrivateKey</code> and <code>Certificate</code> elements in the above example define an <code>alias</code> that points to the key or cert
within the keystore.  Keystores require an additional password to access private keys.
In the <code>PrivateKey</code> element you must define this password within a <code>password</code> attribute.</p>
</div>
</div>
<div class="sect2">
<h3 id="_key_pems"><a class="anchor" href="#_key_pems"></a>Key PEMS</h3>
<div class="paragraph">
<p>Within the <code>Key</code> element you declare your keys and certificates directly using the sub elements
<code>PrivateKeyPem</code>, <code>PublicKeyPem</code>, and <code>CertificatePem</code>.
The values contained in these elements must conform to the PEM key format.
You usually use this option if you are generating keys using <code>openssl</code> or similar command line tool.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;Keys&gt;
   &lt;Key signing="true"&gt;
      &lt;PrivateKeyPem&gt;
         2341251234AB31234==231BB998311222423522334
      &lt;/PrivateKeyPem&gt;
      &lt;CertificatePem&gt;
         211111341251234AB31234==231BB998311222423522334
      &lt;/CertificatePem&gt;
   &lt;/Key&gt;
&lt;/Keys&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sp_principalnamemapping_element"><a class="anchor" href="#_sp_principalnamemapping_element"></a>SP PrincipalNameMapping element</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This element is optional.
When creating a Java Principal object that you obtain from methods such as <code>HttpServletRequest.getUserPrincipal()</code>, you can define what name is returned by the <code>Principal.getName()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;SP ...&gt;
  &lt;PrincipalNameMapping policy="FROM_NAME_ID"/&gt;
&lt;/SP&gt;

&lt;SP ...&gt;
  &lt;PrincipalNameMapping policy="FROM_ATTRIBUTE" attribute="email" /&gt;
&lt;/SP&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>policy</code> attribute defines the policy used to populate this value.
The possible values for this attribute are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">FROM_NAME_ID</dt>
<dd>
<p>This policy just uses whatever the SAML subject value is.  This is the default setting</p>
</dd>
<dt class="hdlist1">FROM_ATTRIBUTE</dt>
<dd>
<p>This will pull the value from one of the attributes declared in the SAML assertion received from the server.
You&#8217;ll need to specify the name of the SAML assertion attribute to use within the <code>attribute</code> XML attribute.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_roleidentifiers_element"><a class="anchor" href="#_roleidentifiers_element"></a>RoleIdentifiers element</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>RoleIdentifiers</code> element defines what SAML attributes within the assertion received from the user should be used
as role identifiers within the Jakarta EE Security Context for the user.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;RoleIdentifiers&gt;
     &lt;Attribute name="Role"/&gt;
     &lt;Attribute name="member"/&gt;
     &lt;Attribute name="memberOf"/&gt;
&lt;/RoleIdentifiers&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default <code>Role</code> attribute values are converted to Jakarta EE roles.
Some IdPs send roles using a <code>member</code> or <code>memberOf</code> attribute assertion.
You can define one or more <code>Attribute</code> elements to specify which SAML attributes must be converted into roles.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rolemappingsprovider_element"><a class="anchor" href="#_rolemappingsprovider_element"></a>RoleMappingsProvider element</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>RoleMappingsProvider</code> is an optional element that allows for the specification of the id and configuration of the
<code>org.keycloak.adapters.saml.RoleMappingsProvider</code> SPI implementation that is to be used by the SAML adapter.</p>
</div>
<div class="paragraph">
<p>When Keycloak is used as the IDP, it is possible to use the built-in role mappers to map any roles before adding them to the
SAML assertion. However, the SAML adapters can be used to send SAML requests to third party IDPs and in this case it might be
necessary to map the roles extracted from the assertion into a different set of roles as required by the SP. The
<code>RoleMappingsProvider</code> SPI allows for the configuration of pluggable role mappers that can be used to perform the necessary
mappings.</p>
</div>
<div class="paragraph">
<p>The configuration of the provider looks as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">...
&lt;RoleIdentifiers&gt;
    ...
&lt;/RoleIdentifiers&gt;
&lt;RoleMappingsProvider id="properties-based-role-mapper"&gt;
    &lt;Property name="properties.resource.location" value="/WEB-INF/role-mappings.properties"/&gt;
&lt;/RoleMappingsProvider&gt;
&lt;IDP&gt;
    ...
&lt;/IDP&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>id</code> attribute identifies which of the installed providers is to be used. The <code>Property</code> sub-element can be used multiple times
to specify configuration properties for the provider.</p>
</div>
<div class="sect2">
<h3 id="_properties_based_role_mappings_provider"><a class="anchor" href="#_properties_based_role_mappings_provider"></a>Properties Based role mappings provider</h3>
<div class="paragraph">
<p>Keycloak includes a <code>RoleMappingsProvider</code> implementation that performs the role mappings using a <code>properties</code> file. This
provider is identified by the id <code>properties-based-role-mapper</code> and is implemented by the <code>org.keycloak.adapters.saml.PropertiesBasedRoleMapper</code>
class.</p>
</div>
<div class="paragraph">
<p>This provider relies on two configuration properties that can be used to specify the location of the <code>properties</code> file
that will be used. First, it checks if the <code>properties.file.location</code> property has been specified, using the configured
value to locate the <code>properties</code> file in the filesystem. If the configured file is not located, the provider throws a
<code>RuntimeException</code>. The following snippet shows an example of provider using the <code>properties.file.configuration</code>
option to load the <code>roles.properties</code> file from the <code>/opt/mappers/</code> directory in the filesystem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;RoleMappingsProvider id="properties-based-role-mapper"&gt;
        &lt;Property name="properties.file.location" value="/opt/mappers/roles.properties"/&gt;
    &lt;/RoleMappingsProvider&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <code>properties.file.location</code> configuration has not been set, the provider checks the <code>properties.resource.location</code>
property, using the configured value to load the <code>properties</code> file from the <code>WAR</code> resource. If this configuration property is
also not present, the provider attempts to load the file from <code>/WEB-INF/role-mappings.properties</code> by default. Failure to load the file
from the resource will result in the provider throwing a <code>RuntimeException</code>. The following snippet shows an example of provider
using the <code>properties.resource.location</code> to load the <code>roles.properties</code> file from the application&#8217;s <code>/WEB-INF/conf/</code> directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;RoleMappingsProvider id="properties-based-role-mapper"&gt;
        &lt;Property name="properties.resource.location" value="/WEB-INF/conf/roles.properties"/&gt;
    &lt;/RoleMappingsProvider&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>properties</code> file can contain both roles and principals as keys, and a list of zero or more roles separated by comma
as values. When invoked, the implementation iterates through the set of roles that were extracted from the assertion and checks,
for each role, if a mapping exists. If the role maps to an empty role, it is discarded. If it maps to a set of one or more
different roles, then these roles are set in the result set. If no mapping is found for the role then it is included as is
in the result set.</p>
</div>
<div class="paragraph">
<p>Once the roles have been processed, the implementation checks if the principal extracted from the assertion contains an entry
<code>properties</code> file. If a mapping for the principal exists, any roles listed as value are added to the result set. This
allows the assignment of extra roles to a principal.</p>
</div>
<div class="paragraph">
<p>As an example, let&#8217;s assume the provider has been configured with the following properties file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>roleA=roleX,roleY
roleB=

kc_user=roleZ</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the principal <code>kc_user</code> is extracted from the assertion with roles <code>roleA</code>, <code>roleB</code> and <code>roleC</code>, the final set of roles
assigned to the principal will be <code>roleC</code>, <code>roleX</code>, <code>roleY</code> and <code>roleZ</code> because <code>roleA</code> is being mapped into both <code>roleX</code>
and <code>roleY</code>, <code>roleB</code> was mapped into an empty role - thus being discarded, <code>roleC</code> is used as is and finally an additional role
was added to the <code>kc_user</code> principal (<code>roleZ</code>).</p>
</div>
<div class="paragraph">
<p>Note: to use spaces in role names for mappings, use unicode replacements for space. For example, incoming 'role A' would appear as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>role\u0020A=roleX,roleY</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_adding_your_own_role_mappings_provider"><a class="anchor" href="#_adding_your_own_role_mappings_provider"></a>Adding your own role mappings provider</h3>
<div class="paragraph">
<p>To add a custom role mappings provider one simply needs to implement the <code>org.keycloak.adapters.saml.RoleMappingsProvider</code> SPI.
For more details see the <code>SAML Role Mappings SPI</code> section in <a href="https://www.keycloak.org/docs/latest/server_development/">Server Developer Guide</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_idp_element"><a class="anchor" href="#_idp_element"></a>IDP Element</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Everything in the IDP element describes the settings for the identity provider (authentication server) the SP is communicating with.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;IDP entityID="idp"
     signaturesRequired="true"
     signatureAlgorithm="RSA_SHA1"
     signatureCanonicalizationMethod="http://www.w3.org/2001/10/xml-exc-c14n#"&gt;
...
&lt;/IDP&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here are the attribute config options you can specify within the <code>IDP</code> element declaration.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">entityID</dt>
<dd>
<p>This is the issuer ID of the IDP. This setting is <em>REQUIRED</em>.</p>
</dd>
<dt class="hdlist1">signaturesRequired</dt>
<dd>
<p>If set to <code>true</code>, the client adapter will sign every document it sends to the IDP.
Also, the client will expect that the IDP will be signing any documents sent to it.
This switch sets the default for all request and response types, but you will see later that you have some fine grain control over this.
This setting is <em>OPTIONAL</em> and will default to <code>false</code>.</p>
</dd>
<dt class="hdlist1">signatureAlgorithm</dt>
<dd>
<p> This is the signature algorithm that the IDP expects signed documents to use.
 Allowed values are: <code>RSA_SHA1</code>, <code>RSA_SHA256</code>, <code>RSA_SHA512</code>, and <code>DSA_SHA1</code>.
 This setting is <em>OPTIONAL</em>
 and defaults to <code>RSA_SHA256</code>. Note that <code>SHA1</code> based algorithms are deprecated and can be removed in the future.
We recommend the use of some more secure algorithm instead of <code>*_SHA1</code>. Also, with <code>*_SHA1</code> algorithms, verifying signatures
 do not work if the SAML server (usually Keycloak) runs on Java 17 or higher.</p>
</dd>
<dt class="hdlist1">signatureCanonicalizationMethod</dt>
<dd>
<p>This is the signature canonicalization method that the IDP expects signed documents to use.  This setting is  <em>OPTIONAL</em>.
The default value is <code>http://www.w3.org/2001/10/xml-exc-c14n#</code> and should be good for most IDPs.</p>
</dd>
<dt class="hdlist1">metadataUrl</dt>
<dd>
<p>The URL used to retrieve the IDP metadata, currently this is only used to pick up signing and encryption keys periodically which allow cycling of these keys on the IDP without manual changes on the SP side.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sp-idp-allowedclockskew"><a class="anchor" href="#_sp-idp-allowedclockskew"></a>IDP AllowedClockSkew sub element</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>AllowedClockSkew</code> optional sub element defines the allowed clock skew between IDP and SP.
The default value is 0.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;AllowedClockSkew unit="MILLISECONDS"&gt;3500&lt;/AllowedClockSkew&gt;</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">unit</dt>
<dd>
<p>It is possible to define the time unit attached to the value for this element.
Allowed values are MICROSECONDS, MILLISECONDS, MINUTES, NANOSECONDS and SECONDS.
This is <em>OPTIONAL</em>.
The default value is <code>SECONDS</code>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sp-idp-singlesignonservice"><a class="anchor" href="#_sp-idp-singlesignonservice"></a>IDP SingleSignOnService sub element</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>SingleSignOnService</code> sub element defines the login SAML endpoint of the IDP.
The client adapter will send requests
to the IDP formatted via the settings within this element when it wants to log in.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;SingleSignOnService signRequest="true"
                     validateResponseSignature="true"
                     requestBinding="post"
                     bindingUrl="url"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here are the config attributes you can define on this element:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">signRequest</dt>
<dd>
<p>Should the client sign authn requests? This setting is <em>OPTIONAL</em>.
Defaults to whatever the IDP <code>signaturesRequired</code> element value is.</p>
</dd>
<dt class="hdlist1">validateResponseSignature</dt>
<dd>
<p>Should the client expect the IDP to sign the assertion response document sent back from an authn request?
This setting <em>OPTIONAL</em>. Defaults to whatever the IDP <code>signaturesRequired</code> element value is.</p>
</dd>
<dt class="hdlist1">requestBinding</dt>
<dd>
<p>This is the SAML binding type used for communicating with the IDP.  This setting is <em>OPTIONAL</em>.
The default value is <code>POST</code>, but you can set it to <code>REDIRECT</code> as well.</p>
</dd>
<dt class="hdlist1">responseBinding</dt>
<dd>
<p>SAML allows the client to request what binding type it wants authn responses to use.
The values of this can be <code>POST</code> or <code>REDIRECT</code>.  This setting is <em>OPTIONAL</em>.
The default is that the client will not request a specific binding type for responses.</p>
</dd>
<dt class="hdlist1">assertionConsumerServiceUrl</dt>
<dd>
<p>URL of the assertion consumer service (ACS) where the IDP login service should send responses to.
This setting is <em>OPTIONAL</em>. By default it is unset, relying on the configuration in the IdP.
When set, it must end in <code>/saml</code>, for example <code>http://sp.domain.com/my/endpoint/for/saml</code>. The value
of this property is sent in <code>AssertionConsumerServiceURL</code> attribute of SAML <code>AuthnRequest</code> message.
This property is typically  accompanied by the <code>responseBinding</code> attribute.</p>
</dd>
<dt class="hdlist1">bindingUrl</dt>
<dd>
<p>This is the URL for the IDP login service that the client will send requests to. This setting is <em>REQUIRED</em>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_idp_singlelogoutservice_sub_element"><a class="anchor" href="#_idp_singlelogoutservice_sub_element"></a>IDP SingleLogoutService sub element</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>SingleLogoutService</code> sub element defines the logout SAML endpoint of the IDP.   The client adapter will send requests
to the IDP formatted via the settings within this element when it wants to log out.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;SingleLogoutService validateRequestSignature="true"
                     validateResponseSignature="true"
                     signRequest="true"
                     signResponse="true"
                     requestBinding="redirect"
                     responseBinding="post"
                     postBindingUrl="posturl"
                     redirectBindingUrl="redirecturl"&gt;</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">signRequest</dt>
<dd>
<p>Should the client sign logout requests it makes to the IDP? This setting is <em>OPTIONAL</em>.
Defaults to whatever the IDP <code>signaturesRequired</code> element value is.</p>
</dd>
<dt class="hdlist1">signResponse</dt>
<dd>
<p>Should the client sign logout responses it sends to the IDP requests? This setting is <em>OPTIONAL</em>.
Defaults to whatever the IDP <code>signaturesRequired</code> element value is.</p>
</dd>
<dt class="hdlist1">validateRequestSignature</dt>
<dd>
<p>Should the client expect signed logout request documents from the IDP? This setting is <em>OPTIONAL</em>. Defaults to whatever the IDP <code>signaturesRequired</code> element value is.</p>
</dd>
<dt class="hdlist1">validateResponseSignature</dt>
<dd>
<p>Should the client expect signed logout response documents from the IDP? This setting is <em>OPTIONAL</em>. Defaults to whatever the IDP <code>signaturesRequired</code> element value is.</p>
</dd>
<dt class="hdlist1">requestBinding</dt>
<dd>
<p>This is the SAML binding type used for communicating SAML requests to the IDP. This setting is <em>OPTIONAL</em>.
The default value is <code>POST</code>, but you can set it to REDIRECT as well.</p>
</dd>
<dt class="hdlist1">responseBinding</dt>
<dd>
<p>This is the SAML binding type used for communicating SAML responses to the IDP. The values of this can be <code>POST</code> or <code>REDIRECT</code>.  This setting is <em>OPTIONAL</em>.
The default value is <code>POST</code>, but you can set it to <code>REDIRECT</code> as well.</p>
</dd>
<dt class="hdlist1">postBindingUrl</dt>
<dd>
<p>This is the URL for the IDP&#8217;s logout service when using the POST binding. This setting is <em>REQUIRED</em> if using the <code>POST</code> binding.</p>
</dd>
<dt class="hdlist1">redirectBindingUrl</dt>
<dd>
<p>This is the URL for the IDP&#8217;s logout service when using the REDIRECT binding. This setting is <em>REQUIRED</em> if using the REDIRECT binding.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sp-idp-keys"><a class="anchor" href="#_sp-idp-keys"></a>IDP Keys sub element</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Keys sub element of IDP is only used to define the certificate or public key to use to verify documents signed by the IDP.
It is defined in the same way as the <a href="#_saml-sp-keys">SP&#8217;s Keys element</a>.
But again, you only have to define one certificate or public key reference. Note that, if both IDP and SP are realized by
Keycloak server and adapter, respectively, there is no need to specify the keys for signature validation, see below.</p>
</div>
<div id="_sp-idp-keys-automatic" class="paragraph">
<p>It is possible to configure SP to obtain public keys for IDP signature validation
from published certificates automatically, provided both SP and IDP are
implemented by Keycloak.
This is done by removing all declarations of signature validation keys in Keys
sub element. If the Keys sub element would then remain empty, it can be omitted
completely. The keys are then automatically obtained by SP from SAML descriptor,
location of which is derived from SAML endpoint URL specified in the
<a href="#_sp-idp-singlesignonservice">IDP SingleSignOnService sub element</a>.
Settings of the HTTP client that is used for SAML descriptor retrieval usually
needs no additional configuration, however it can be configured in the
<a href="#_sp-idp-httpclient">IDP HttpClient sub element</a>.</p>
</div>
<div class="paragraph">
<p>It is also possible to specify multiple keys for signature verification. This is done by declaring multiple Key elements
within Keys sub element that have <code>signing</code> attribute set to <code>true</code>.
This is useful for example in situation when the IDP signing keys are rotated: There is
usually a transition period when new SAML protocol messages and assertions are signed
with the new key but those signed by previous key should still be accepted.</p>
</div>
<div class="paragraph">
<p>It is not possible to configure Keycloak to both obtain the keys
for signature verification automatically and define additional static signature
verification keys.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">       &lt;IDP entityID="idp"&gt;
            ...
            &lt;Keys&gt;
                &lt;Key signing="true"&gt;
                    &lt;KeyStore resource="/WEB-INF/keystore.jks" password="store123"&gt;
                        &lt;Certificate alias="demo"/&gt;
                    &lt;/KeyStore&gt;
                &lt;/Key&gt;
            &lt;/Keys&gt;
        &lt;/IDP&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sp-idp-httpclient"><a class="anchor" href="#_sp-idp-httpclient"></a>IDP HttpClient sub element</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>HttpClient</code> optional sub element defines the properties of HTTP client used
for automatic obtaining of certificates containing public keys for IDP signature
verification via SAML descriptor of the IDP when
<a href="#_sp-idp-keys-automatic">enabled</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;HttpClient connectionPoolSize="10"
            disableTrustManager="false"
            allowAnyHostname="false"
            clientKeystore="classpath:keystore.jks"
            clientKeystorePassword="pwd"
            truststore="classpath:truststore.jks"
            truststorePassword="pwd"
            proxyUrl="http://proxy/"
            socketTimeout="5000"
            connectionTimeout="6000"
            connectionTtl="500" /&gt;</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">connectionPoolSize</dt>
<dd>
<p>This config option defines how many connections to the Keycloak server should be pooled.
This is <em>OPTIONAL</em>.
The default value is <code>10</code>.</p>
</dd>
<dt class="hdlist1">disableTrustManager</dt>
<dd>
<p>If the Keycloak server requires HTTPS and this config option is set to <code>true</code> you do not have to specify a truststore.
This setting should only be used during development and <strong>never</strong> in production as it will disable verification of SSL certificates.
This is <em>OPTIONAL</em>.
The default value is <code>false</code>.</p>
</dd>
<dt class="hdlist1">allowAnyHostname</dt>
<dd>
<p>If the Keycloak server requires HTTPS and this config option is set to <code>true</code>
the Keycloak server&#8217;s certificate is validated via the truststore,
but host name validation is not done.
This setting should only be used during development and <strong>never</strong> in production
as it will partly disable verification of SSL certificates.
This setting may be useful in test environments. This is <em>OPTIONAL</em>.
The default value is <code>false</code>.</p>
</dd>
<dt class="hdlist1">truststore</dt>
<dd>
<p>The value is the file path to a truststore file.
If you prefix the path with <code>classpath:</code>, then the truststore will be obtained from the deployment&#8217;s classpath instead.
Used for outgoing HTTPS communications to the Keycloak server.
Client making HTTPS requests need a way to verify the host of the server they are talking to.
This is what the truststore does.
The keystore contains one or more trusted host certificates or certificate authorities.
You can create this truststore by extracting the public certificate of the Keycloak server&#8217;s SSL keystore.
This is <em>REQUIRED</em> unless <code>disableTrustManager</code> is <code>true</code>.</p>
</dd>
<dt class="hdlist1">truststorePassword</dt>
<dd>
<p>Password for the truststore.
This is <em>REQUIRED</em> if <code>truststore</code> is set and the truststore requires a password.</p>
</dd>
<dt class="hdlist1">clientKeystore</dt>
<dd>
<p>This is the file path to a keystore file.
This keystore contains client certificate for two-way SSL when the adapter makes HTTPS requests to the Keycloak server.
This is <em>OPTIONAL</em>.</p>
</dd>
<dt class="hdlist1">clientKeystorePassword</dt>
<dd>
<p>Password for the client keystore and for the client&#8217;s key.
This is <em>REQUIRED</em> if <code>clientKeystore</code> is set.</p>
</dd>
<dt class="hdlist1">proxyUrl</dt>
<dd>
<p>URL to HTTP proxy to use for HTTP connections.
This is <em>OPTIONAL</em>.</p>
</dd>
<dt class="hdlist1">socketTimeout</dt>
<dd>
<p>Timeout for socket waiting for data after establishing the connection in milliseconds.
Maximum time of inactivity between two data packets.
A timeout value of zero is interpreted as an infinite timeout.
A negative value is interpreted as undefined (system default if applicable).
The default value is <code>-1</code>.
This is <em>OPTIONAL</em>.</p>
</dd>
<dt class="hdlist1">connectionTimeout</dt>
<dd>
<p>Timeout for establishing the connection with the remote host in milliseconds.
A timeout value of zero is interpreted as an infinite timeout.
A negative value is interpreted as undefined (system default if applicable).
The default value is <code>-1</code>.
This is <em>OPTIONAL</em>.</p>
</dd>
<dt class="hdlist1">connectionTtl</dt>
<dd>
<p>Connection time-to-live for client in milliseconds.
A value less than or equal to zero is interpreted as an infinite value.
The default value is <code>-1</code>.
This is <em>OPTIONAL</em>.</p>
</dd>
</dl>
</div>
</div>
</div>            </div>
        </div>

        <div class="col-md-3 mt-4 col-xl-2 col-sm-12 bg-light">
            <div class="sticky-top px-2 py-3">
                <div class="mt-2 mb-2 fw-bold">On this page</div>
                <div id="js-toc"></div>
                <div class="mt-4">
                    <a href="https://github.com/keycloak/keycloak/tree/main/docs/guides/securing-apps/saml-galleon-layers-detailed-config.adoc" target="_blank"><i class="fa fa-edit"></i> Edit this guide</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://www.keycloak.org/resources/js/guide.js" type="text/javascript"></script>


<div class="container mt-5" data-nosnippet>
    <footer class="py-3 my-4 border-top">
        <p class="text-center text-muted">Keycloak is a Cloud Native Computing Foundation incubation project</p>
        <div class="text-center">
            <img style="aspect-ratio: 300/48" alt="Cloud Native Computing Foundation" src="https://www.keycloak.org/resources/images/cncf_logo.png" loading="lazy"/>
        </div>
        <p class="mt-4 text-center small text-muted">&copy; Keycloak Authors 2025. &copy; 2025 The Linux Foundation. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage">Trademark Usage page</a>.</p>
    </footer>
</div>

<script src="https://www.keycloak.org/resources/bootstrap/dist/js/bootstrap.min.js" type="text/javascript"></script>
<script src="https://www.keycloak.org/resources/tocbot/dist/tocbot.min.js" type="text/javascript"></script>
</body>
</html>
