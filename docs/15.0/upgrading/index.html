<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<title>Upgrading Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<style>
/* Top menu */

@media only screen and (min-width: 768px) {
       div.top-menu-guides {
              position: fixed;
              display: inline-block;
              top: 0;
              left: 0;
              z-index: 9999;
       }

       div.top-menu-guides p {
              margin: 0;
              padding: 0;
       }

       div.top-menu-guides .content {
              margin: 0;
              padding: 7px 20px 0 20px;
              background-color: #ededed;
              height: 48px;
              width: 20em;
       }

       @media only screen and (max-width: 1280px) {
              div.top-menu-guides .content {
                     width: 15em;
              }
       }

       div.top-menu-guides .ulist {
              display: none;
              position: absolute;
              background-color: #f9f9f9;
              min-width: 160px;
              box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
              padding: 0px;
              margin-top: 12px;
       }

       div.top-menu-guides .ulist ul {
              list-style: none;
              padding: 5px;
              margin: 0;
       }

       div.top-menu-guides .ulist li {
              padding: 5px 10px;
       }

       div.top-menu-guides:hover .ulist {
           display: block;
       }

       div.top-menu-version {
           position: fixed;
           top: 0;
           z-index: 9999;
       }

       div.top-menu-version .content {
           padding: 0;
           margin: 0;
           background-color: #eee;
           height: 48px;
           padding: 7px;
       }

       .versionarchive {
           display: inline-block;
       }

       .versionarchive p {
           margin: 0;
           padding: 2px 5px 2px 10px;
       }

       .versionarchive a {
           background-color: #ffdd57;
           padding: 0 5px;
           font-style: normal;
           border-radius: 5px;
           margin-left: 10px;
       }

       .versionlatest {
           display: inline-block;
       }

       .versionlatest p {
           background-color: #eee;
           border-radius: 5px;
           margin: 0;
           padding: 2px 5px 2px 10px;
       }

       .versionlatest em {
           background-color: #23d160;
           padding: 0 5px;
           font-style: normal;
           border-radius: 5px;
           margin-left: 10px;
       }
}

/* TOC */

#tocbot a.toc-link.node-name--H1{ font-style: italic }
@media screen{
#tocbot > ul.toc-list{ margin-bottom: 0.5em; margin-left: 0.125em }
#tocbot ul.sectlevel0, #tocbot a.toc-link.node-name--H1 + ul{
  padding-left: 0 }
#tocbot a.toc-link{ height:100% }
.is-collapsible{ max-height:3000px; overflow:hidden; }
.is-collapsed{ max-height:0 }
.is-active-link{ font-weight:700 }
}
@media print{
#tocbot a.toc-link.node-name--H4{ display:none }
}

/* Fix scroll to anchor hides title */
h1::before, h2::before, h3::before, h4::before, h5::before, h6::before {
    display: block;
    content: " ";
    height: 70px;
    margin-top: -70px;
}

h1 {
    border-bottom: none !important
}

#toc.toc2 {
    top: 30px;
    bottom: 0px;
    height: unset;
}

body.toc2 {
    padding-top: 30px;
}

@media only screen and (min-width:768px) {
    #toc.toc2 {
        top: 40px;
    }

    body.toc2 {
        padding-top: 40px;
    }
}

@media only screen and (min-width:1280px) {
    #toc.toc2 {
        top: 48px;
    }

    body.toc2 {
        padding-top: 48px;
    }
}


/* General Changes */

h1, h2, h3, #toctitle, .sidebarblock>.content>.title, h4, h5, h6 {
    color: #444444;
    font-weight: 500;
}

a {
    color: #004670;
    text-decoration: none;
}

a:hover {
    color: #7da1dc;
}

body {
    font-family: "Open Sans","DejaVu Sans",sans-serif;
    color: #444444;
}

.subheader, .admonitionblock td.content>.title, .audioblock>.title, .exampleblock>.title, .imageblock>.title, .listingblock>.title, .literalblock>.title, .stemblock>.title, .openblock>.title, .paragraph>.title, .quoteblock>.title, table.tableblock>.title, .verseblock>.title, .videoblock>.title, .dlist>.title, .olist>.title, .ulist>.title, .qlist>.title, .hdlist>.title {
    color: #444444;
}

.admonitionblock td.content>.title, .audioblock>.title, .exampleblock>.title, .imageblock>.title, .listingblock>.title, .literalblock>.title, .stemblock>.title, .openblock>.title, .paragraph>.title, .quoteblock>.title, table.tableblock>.title, .verseblock>.title, .videoblock>.title, .dlist>.title, .olist>.title, .ulist>.title, .qlist>.title, .hdlist>.title {
    font-family: "Open Sans","DejaVu Sans",sans-serif;
    font-style: normal;
}

span.image img {
    border:1px solid #ccc;
    -webkit-box-shadow: 3px 3px 15px 0px rgba(0,0,0,0.5);
    -moz-box-shadow: 3px 3px 15px 0px rgba(0,0,0,0.5);
    box-shadow: 3px 3px 15px 0px rgba(0,0,0,0.5);
}

.sect1+.sect1 {
    border-top: none;
}

.page-links {
    border-bottom: 1px solid #efefed;
    border-top: none;
    background: none;
    position: relative;
    left: 0em;
    width: 100%;
    top: -5em;
    height: 0;
    margin: 0;
    padding: 0;
}

.sect2 .page-links {
    top: -3.5em;
}

.page-links .content {
    background: #f8f8f7;
    border: 1px solid #e0e0dc;
    float: right;
    font-size: 0.8em;
    margin: 0;
    padding: 5px;
}

.page-links a {
    display: block;
    padding: 5px;
}
</style>

</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Upgrading Guide</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#intro">Introduction</a></li>
<li><a href="#_upgrading">Upgrading Keycloak Server</a>
<ul class="sectlevel2">
<li><a href="#_prep_migration">Preparing for Upgrading</a></li>
<li><a href="#_install_new_version">Upgrading Keycloak server</a>
<ul class="sectlevel3">
<li><a href="#running-the-standalone-mode-upgrade-script">Running the Standalone Mode Upgrade Script</a></li>
<li><a href="#running-the-standalone-high-availability-mode-upgrade-script">Running the Standalone-High Availability Mode Upgrade Script</a></li>
<li><a href="#running-the-domain-mode-upgrade-script">Running the Domain Mode Upgrade Script</a></li>
</ul>
</li>
<li><a href="#_migrate_db">Migrating the Database</a>
<ul class="sectlevel3">
<li><a href="#automatic-relational-database-migration">Automatic Relational Database Migration</a></li>
<li><a href="#manual-relational-database-migration">Manual Relational Database Migration</a></li>
</ul>
</li>
<li><a href="#_migrate_themes">Migrating Themes</a>
<ul class="sectlevel3">
<li><a href="#migrating-templates">Migrating Templates</a></li>
<li><a href="#migrating-messages">Migrating Messages</a></li>
<li><a href="#migrating-styles">Migrating Styles</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#upgrading-keycloak-adapters">Upgrading Keycloak Adapters</a>
<ul class="sectlevel2">
<li><a href="#_compatibility_with_older_adapters">Compatibility with older adapters</a></li>
<li><a href="#_upgrade_eap_adapter">Upgrading the EAP Adapter</a></li>
<li><a href="#_upgrade_js_adapter">Upgrading the JavaScript Adapter</a></li>
<li><a href="#_upgrade_nodejs_adapter">Upgrading the Node.js Adapter</a></li>
</ul>
</li>
<li><a href="#upgrading-keycloak-admin-client">Upgrading Keycloak Admin Client</a></li>
<li><a href="#migration-changes">Migration Changes</a>
<ul class="sectlevel2">
<li><a href="#migrating-to-14-0-0">Migrating to 14.0.0</a>
<ul class="sectlevel3">
<li><a href="#client-policies-migration">Client Policies Migration</a></li>
</ul>
</li>
<li><a href="#migrating-to-13-0-0">Migrating to 13.0.0</a>
<ul class="sectlevel3">
<li><a href="#manual-migration-step-needed">Manual migration step needed</a></li>
<li><a href="#upgrade-to-wildfly-23">Upgrade to Wildfly 23</a></li>
<li><a href="#upgrade-to-wildfly-22">Upgrade to Wildfly 22</a></li>
</ul>
</li>
<li><a href="#migrating-to-12-0-2">Migrating to 12.0.2</a>
<ul class="sectlevel3">
<li><a href="#read-only-attributes">Read-only attributes</a></li>
<li><a href="#valid-request-uris">Valid Request URIs</a></li>
</ul>
</li>
<li><a href="#migrating-to-12-0-0">Migrating to 12.0.0</a>
<ul class="sectlevel3">
<li><a href="#upgrade-to-wildfly-21">Upgrade to Wildfly 21</a></li>
<li><a href="#skip-creation-of-user-session-for-the-docker-protocol-authentication">Skip creation of user session for the Docker protocol authentication</a></li>
<li><a href="#upgrade-to-patternfly-4">Upgrade to PatternFly 4</a></li>
<li><a href="#client-credentials-grant-without-refresh-token-by-default">Client Credentials Grant without refresh token by default</a></li>
</ul>
</li>
<li><a href="#migrating-to-11-0-0">Migrating to 11.0.0</a>
<ul class="sectlevel3">
<li><a href="#upgrade-to-wildfly-20">Upgrade to Wildfly 20</a></li>
<li><a href="#ldap-no-import-bugfix">LDAP no-import bugfix</a></li>
<li><a href="#usermodel-changes">UserModel changes</a></li>
<li><a href="#instagram-idp-migrated-to-new-the-api">Instagram IdP migrated to new the API</a></li>
<li><a href="#non-standard-token-introspection-endpoint-removed">Non-standard token introspection endpoint removed</a></li>
</ul>
</li>
<li><a href="#migrating-to-9-0-1">Migrating to 9.0.1</a>
<ul class="sectlevel3">
<li><a href="#legacy-promise-in-javascript-adapter">Legacy promise in JavaScript adapter</a></li>
<li><a href="#duplicated-top-level-groups">Duplicated top level groups</a></li>
</ul>
</li>
<li><a href="#migrating-to-9-0-0">Migrating to 9.0.0</a>
<ul class="sectlevel3">
<li><a href="#improved-handling-of-user-locale">Improved handling of user locale</a></li>
<li><a href="#deprecated-methods-in-token-representation-java-classes">Deprecated methods in token representation Java classes</a></li>
</ul>
</li>
<li><a href="#migrating-to-8-0-2">Migrating to 8.0.2</a>
<ul class="sectlevel3">
<li><a href="#more-authentication-flows-changes">More Authentication flows changes</a></li>
</ul>
</li>
<li><a href="#migrating-to-8-0-0">Migrating to 8.0.0</a>
<ul class="sectlevel3">
<li><a href="#new-default-hostname-provider">New Default Hostname provider</a></li>
<li><a href="#upgrade-to-wildfly-18">Upgrade to Wildfly 18</a></li>
<li><a href="#deploying-scripts-to-the-server">Deploying Scripts to the Server</a></li>
<li><a href="#client-credentials-in-the-javascript-adapter">Client Credentials in the JavaScript adapter</a></li>
<li><a href="#authentication-flows-changes">Authentication flows changes</a></li>
<li><a href="#user-credentials-changes">User credentials changes</a></li>
</ul>
</li>
<li><a href="#migrating-to-7-0-0">Migrating to 7.0.0</a>
<ul class="sectlevel3">
<li><a href="#upgrade-to-wildfly-17">Upgrade to Wildfly 17</a></li>
</ul>
</li>
<li><a href="#migrating-to-6-0-0">Migrating to 6.0.0</a>
<ul class="sectlevel3">
<li><a href="#upgrade-to-wildfly-16">Upgrade to Wildfly 16</a></li>
<li><a href="#new-optional-client-scope">New optional client scope</a></li>
<li><a href="#ability-to-propagate-prompt-none-to-default-idp">Ability to propagate prompt=none to default IDP</a></li>
</ul>
</li>
<li><a href="#migrating-to-5-0-0">Migrating to 5.0.0</a>
<ul class="sectlevel3">
<li><a href="#upgrade-to-wildfly-15">Upgrade to Wildfly 15</a></li>
</ul>
</li>
<li><a href="#migrating-to-4-8-2">Migrating to 4.8.2</a>
<ul class="sectlevel3">
<li><a href="#google-identity-provider-updated-to-use-google-sign-in-authentication-system">Google Identity Provider updated to use Google Sign-in authentication system</a></li>
<li><a href="#linkedin-social-broker-updated-to-version-2-of-linkedin-apis">LinkedIn Social Broker Updated to Version 2 of LinkedIn APIs</a></li>
</ul>
</li>
<li><a href="#migrating-to-4-6-0">Migrating to 4.6.0</a>
<ul class="sectlevel3">
<li><a href="#new-default-client-scopes">New default client scopes</a></li>
<li><a href="#javascript-adapter-promise">JavaScript Adapter Promise</a></li>
<li><a href="#microsoft-identity-provider-updated-to-use-the-microsoft-graph-api">Microsoft Identity Provider updated to use the Microsoft Graph API</a></li>
<li><a href="#upgrade-to-wildfly-14">Upgrade to Wildfly 14</a></li>
</ul>
</li>
<li><a href="#migrating-to-4-4-0">Migrating to 4.4.0</a>
<ul class="sectlevel3">
<li><a href="#upgrade-to-wildfly-13">Upgrade to Wildfly 13</a></li>
</ul>
</li>
<li><a href="#migration-to-4-3-0">Migration to 4.3.0</a>
<ul class="sectlevel3">
<li><a href="#hostname-configuration">Hostname configuration</a></li>
</ul>
</li>
<li><a href="#migrating-to-4-0-0">Migrating to 4.0.0</a>
<ul class="sectlevel3">
<li><a href="#client-templates-changed-to-client-scopes">Client Templates changed to Client Scopes</a></li>
<li><a href="#changes-to-authorization-services">Changes to Authorization Services</a></li>
</ul>
</li>
<li><a href="#migrating-to-3-4-2">Migrating to 3.4.2</a>
<ul class="sectlevel3">
<li><a href="#added-session_state-parameter-to-openid-connect-authentication-response">Added session_state parameter to OpenID Connect Authentication Response</a></li>
</ul>
</li>
<li><a href="#migrating-to-3-2-0">Migrating to 3.2.0</a>
<ul class="sectlevel3">
<li><a href="#new-password-hashing-algorithms">New Password Hashing algorithms</a></li>
<li><a href="#id-token-requires-scope-openid">ID Token requires scope=openid</a></li>
<li><a href="#authentication-sessions-and-action-tokens">Authentication sessions and Action tokens</a></li>
</ul>
</li>
<li><a href="#migrating-to-2-5-1">Migrating to 2.5.1</a>
<ul class="sectlevel3">
<li><a href="#migration-of-old-offline-tokens">Migration of old offline tokens</a></li>
</ul>
</li>
<li><a href="#migrating-to-2-5-0">Migrating to 2.5.0</a>
<ul class="sectlevel3">
<li><a href="#changes-to-the-infinispan-caches">Changes to the Infinispan caches</a></li>
</ul>
</li>
<li><a href="#migrating-to-2-4-0">Migrating to 2.4.0</a>
<ul class="sectlevel3">
<li><a href="#server-spi-split-into-server-spi-and-sever-spi-private">Server SPI split into Server SPI and Sever SPI Private</a></li>
<li><a href="#key-encryption-algorithm-in-saml-assertions">Key encryption algorithm in SAML assertions</a></li>
<li><a href="#infinispan-caches-realms-and-users-are-always-local">Infinispan caches realms and users are always local</a></li>
</ul>
</li>
<li><a href="#migrating-to-2-3-0">Migrating to 2.3.0</a>
<ul class="sectlevel3">
<li><a href="#default-max-results-on-paginated-endpoints">Default max results on paginated endpoints</a></li>
<li><a href="#code-realm-public-key-code-adapter-property-not-recommended"><code>realm-public-key</code> adapter property not recommended</a></li>
<li><a href="#added-infinispan-cache-code-keys-code">Added Infinispan cache <code>keys</code></a></li>
</ul>
</li>
<li><a href="#migrating-to-2-2-0">Migrating to 2.2.0</a>
<ul class="sectlevel3">
<li><a href="#code-databaseschema-code-property-strong-deprecated-strong"><code>databaseSchema</code> property <strong>deprecated</strong></a></li>
<li><a href="#changes-in-client-s-valid-redirect-uris">Changes in Client&#8217;s Valid Redirect URIs</a></li>
<li><a href="#authenticate-by-default-removed-from-identity-providers">Authenticate by default removed from Identity Providers</a></li>
</ul>
</li>
<li><a href="#migrating-to-2-0-0">Migrating to 2.0.0</a>
<ul class="sectlevel3">
<li><a href="#upgrading-from-1-0-0-final-no-longer-supported">Upgrading from 1.0.0.Final no longer supported</a></li>
</ul>
</li>
<li><a href="#migrating-to-1-9-5">Migrating to 1.9.5</a>
<ul class="sectlevel3">
<li><a href="#default-password-hashing-interval-increased-to-20k">Default password hashing interval increased to 20K</a></li>
</ul>
</li>
<li><a href="#migrating-to-1-9-3">Migrating to 1.9.3</a>
<ul class="sectlevel3">
<li><a href="#add-user-script-renamed">Add User script renamed</a></li>
</ul>
</li>
<li><a href="#migrating-to-1-9-2">Migrating to 1.9.2</a>
<ul class="sectlevel3">
<li><a href="#adapter-option-auth-server-url-for-backend-requests-removed">Adapter option auth-server-url-for-backend-requests removed</a></li>
</ul>
</li>
<li><a href="#migrating-to-1-9-0">Migrating to 1.9.0</a>
<ul class="sectlevel3">
<li><a href="#themes-and-providers-directory-moved">Themes and providers directory moved</a></li>
<li><a href="#adapter-subsystems-only-bring-in-dependencies-if-keycloak-is-on">Adapter Subsystems only bring in dependencies if Keycloak is on</a></li>
<li><a href="#client-registration-service-endpoints-moved">Client Registration service endpoints moved</a></li>
<li><a href="#session-state-parameter-in-authentication-response-renamed">Session state parameter in authentication response renamed</a></li>
<li><a href="#deprecated-openid-connect-endpoints">Deprecated OpenID Connect endpoints</a></li>
<li><a href="#updates-to-theme-templates">Updates to theme templates</a></li>
<li><a href="#module-and-source-code-re-org">Module and Source Code Re-org</a></li>
<li><a href="#for-adapters-session-id-changed-after-login">For adapters, session id changed after login</a></li>
<li><a href="#saml-sp-client-adapter-changes">SAML SP Client Adapter Changes</a></li>
</ul>
</li>
<li><a href="#migrating-to-1-8-0">Migrating to 1.8.0</a>
<ul class="sectlevel3">
<li><a href="#admin-account">Admin account</a></li>
<li><a href="#oauth2-token-introspection">OAuth2 Token Introspection</a></li>
</ul>
</li>
<li><a href="#migrating-to-1-7-0-cr1">Migrating to 1.7.0.CR1</a>
<ul class="sectlevel3">
<li><a href="#direct-access-grants-disabled-by-default-for-clients">Direct access grants disabled by default for clients</a></li>
<li><a href="#option-update-profile-on-first-login-moved-from-identity-provider-to-review-profile-authenticator">Option 'Update Profile On First Login' moved from Identity provider to Review Profile authenticator</a></li>
<li><a href="#element-form-error-page-in-web-xml-not-supported-anymore">Element 'form-error-page' in web.xml not supported anymore</a></li>
<li><a href="#identityprovidermapper-changes">IdentityProviderMapper changes</a></li>
</ul>
</li>
<li><a href="#migrating-to-1-6-0-final">Migrating to 1.6.0.Final</a>
<ul class="sectlevel3">
<li><a href="#option-that-refresh-tokens-are-not-reusable-anymore">Option that refresh tokens are not reusable anymore</a></li>
<li><a href="#some-packages-renamed">Some packages renamed</a></li>
<li><a href="#persisting-user-sessions">Persisting user sessions</a></li>
</ul>
</li>
<li><a href="#migrating-to-1-5-0-final">Migrating to 1.5.0.Final</a>
<ul class="sectlevel3">
<li><a href="#realm-and-user-cache-providers">Realm and User cache providers</a></li>
<li><a href="#uses-session-providers">Uses Session providers</a></li>
<li><a href="#contact-details-removed-from-registration-and-account-management">Contact details removed from registration and account management</a></li>
</ul>
</li>
<li><a href="#migrating-to-1-3-0-final">Migrating to 1.3.0.Final</a>
<ul class="sectlevel3">
<li><a href="#direct-grant-api-always-enabled">Direct Grant API always enabled</a></li>
<li><a href="#database-changed">Database changed</a></li>
<li><a href="#userfederationprovider-changed">UserFederationProvider changed</a></li>
<li><a href="#wildfly-9-0-0-final">WildFly 9.0.0.Final</a></li>
<li><a href="#wildfly-jboss-eap-and-jboss-as7-adapters">WildFly, JBoss EAP and JBoss AS7 adapters</a></li>
</ul>
</li>
<li><a href="#migrating-from-1-2-0-beta1-to-1-2-0-rc1">Migrating from 1.2.0.Beta1 to 1.2.0.RC1</a>
<ul class="sectlevel3">
<li><a href="#distribution-changes">Distribution changes</a></li>
<li><a href="#database-changed-2">Database changed</a></li>
<li><a href="#application-and-oauth-client-merge">Application and OAuth client merge</a></li>
</ul>
</li>
<li><a href="#migrating-from-1-1-0-final-to-1-2-0-beta1">Migrating from 1.1.0.Final to 1.2.0.Beta1</a>
<ul class="sectlevel3">
<li><a href="#database-changed-3">Database changed</a></li>
<li><a href="#code-iss-code-in-access-and-id-tokens"><code>iss</code> in access and id tokens</a></li>
<li><a href="#openid-connect-endpoints">OpenID Connect endpoints</a></li>
<li><a href="#theme-changes">Theme changes</a></li>
<li><a href="#claims-changes">Claims changes</a></li>
<li><a href="#social-migration-to-identity-brokering">Social migration to identity brokering</a></li>
</ul>
</li>
<li><a href="#migrating-from-1-1-0-beta1-to-1-1-0-beta2">Migrating from 1.1.0.Beta1 to 1.1.0.Beta2</a></li>
<li><a href="#migrating-from-1-0-x-final-to-1-1-0-beta1">Migrating from 1.0.x.Final to 1.1.0.Beta1</a></li>
<li><a href="#migrating-from-1-0-rc-1-to-rc-2">Migrating from 1.0 RC-1 to RC-2</a></li>
<li><a href="#migrating-from-1-0-beta-4-to-rc-1">Migrating from 1.0 Beta 4 to RC-1</a></li>
<li><a href="#migrating-from-1-0-beta-1-to-beta-4">Migrating from 1.0 Beta 1 to Beta 4</a></li>
<li><a href="#migrating-from-1-0-alpha-4-to-beta-1">Migrating from 1.0 Alpha 4 to Beta 1</a></li>
<li><a href="#migrating-from-1-0-alpha-2-to-alpha-3">Migrating from 1.0 Alpha 2 to Alpha 3</a></li>
<li><a href="#migrating-from-1-0-alpha-1-to-alpha-2">Migrating from 1.0 Alpha 1 to Alpha 2</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="exampleblock top-menu-guides">
<div class="content">
<div class="paragraph">
<p><strong>Upgrading</strong> <span class="icon"><i class="fa fa-angle-down"></i></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.keycloak.org/docs/15.0/getting_started/">Getting Started</a></p>
</li>
<li>
<p><a href="https://www.keycloak.org/docs/15.0/server_installation/">Server Installation</a></p>
</li>
<li>
<p><a href="https://www.keycloak.org/docs/15.0/securing_apps/">Securing Apps</a></p>
</li>
<li>
<p><a href="https://www.keycloak.org/docs/15.0/server_admin/">Server Administration</a></p>
</li>
<li>
<p><a href="https://www.keycloak.org/docs/15.0/server_development/">Server Developer</a></p>
</li>
<li>
<p><a href="https://www.keycloak.org/docs/15.0/authorization_services/">Authorization Services</a></p>
</li>
<li>
<p><a href="https://www.keycloak.org/docs/15.0/release_notes/">Release Notes</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="exampleblock top-menu-version">
<div class="content">
<div class="paragraph versionarchive">
<p>Version <strong>15.0.2</strong> <em><a href="https://www.keycloak.org/docs/latest/upgrading/">Click here for latest</a></em></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="intro"><a class="anchor" href="#intro"></a>Introduction</h2>
<div class="sectionbody">
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak-documentation/blob/master/upgrading/topics/keycloak/intro.adoc" target="_blank">Edit this section</a>
<a href="https://issues.redhat.com/secure/CreateIssueDetails!init.jspa?pid=12313920&amp;components=12323375&amp;issuetype=1&amp;priority=3&amp;description=File:%20upgrading/topics/keycloak/intro.adoc" target="_blank">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>This guide describes how to upgrade Keycloak. It is recommended that you start by upgrading the Keycloak
server first and Keycloak adapters second.</p>
</div>
<div class="paragraph">
<p>Before upgrading make sure to read the instructions carefully and carefully review the changes listed in
<a href="#migration-changes">Migration Changes</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_upgrading"><a class="anchor" href="#_upgrading"></a>Upgrading Keycloak Server</h2>
<div class="sectionbody">
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak-documentation/blob/master/upgrading/topics/keycloak/upgrading.adoc" target="_blank">Edit this section</a>
<a href="https://issues.redhat.com/secure/CreateIssueDetails!init.jspa?pid=12313920&amp;components=12323375&amp;issuetype=1&amp;priority=3&amp;description=File:%20upgrading/topics/keycloak/upgrading.adoc" target="_blank">Report an issue</a>
</div>
</div>
<div class="sect2">
<h3 id="_prep_migration"><a class="anchor" href="#_prep_migration"></a>Preparing for Upgrading</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak-documentation/blob/master/upgrading/topics/prep_migration.adoc" target="_blank">Edit this section</a>
<a href="https://issues.redhat.com/secure/CreateIssueDetails!init.jspa?pid=12313920&amp;components=12323375&amp;issuetype=1&amp;priority=3&amp;description=File:%20upgrading/topics/prep_migration.adoc" target="_blank">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>Before you upgrade, be aware of the order in which you need to perform the upgrade steps. Also note potential issues
that can occur within the upgrade process. In general, you must upgrade Keycloak server first, and then upgrade
the adapters.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Prior to applying the upgrade, handle any open transactions and delete the data/tx-object-store/ transaction directory.</p>
</li>
<li>
<p>Back up the old installation (configuration, themes, and so on).</p>
</li>
<li>
<p>Back up the database. For detailed information on how to back up the database, see the documentation for the relational
database you are using.</p>
</li>
<li>
<p>Upgrade Keycloak server.</p>
<div class="ulist">
<ul>
<li>
<p>Testing the upgrade in a non-production environment first, to prevent any installation issues from being exposed in
production, is a best practice.</p>
</li>
<li>
<p>Be aware that after the upgrade the database will no longer be compatible with the old server</p>
</li>
<li>
<p>Ensure the upgraded server is functional before upgrading adapters in production.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If you need to revert the upgrade, first restore the old installation, and then restore the database from the backup copy.</p>
</li>
<li>
<p>Upgrade the adapters.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_install_new_version"><a class="anchor" href="#_install_new_version"></a>Upgrading Keycloak server</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak-documentation/blob/master/upgrading/topics/install_new_version.adoc" target="_blank">Edit this section</a>
<a href="https://issues.redhat.com/secure/CreateIssueDetails!init.jspa?pid=12313920&amp;components=12323375&amp;issuetype=1&amp;priority=3&amp;description=File:%20upgrading/topics/install_new_version.adoc" target="_blank">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>It is important that you upgrade Keycloak server before upgrading the adapters.</p>
</div>
<div class="paragraph">
<p>To upgrade Keycloak server, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Prior to applying the upgrade, handle any open transactions and delete the data/tx-object-store/ transaction directory.</p>
</li>
<li>
<p>Download the new server archive</p>
</li>
<li>
<p>Move the downloaded archive to the desired location.</p>
</li>
<li>
<p>Extract the archive. This step installs a clean instance of the latest Keycloak release.</p>
</li>
<li>
<p>For standalone installations, copy the KEYCLOAK_HOME/standalone/ directory from the previous installation over the
directory in the new installation.</p>
<div class="paragraph">
<p>For domain installations, copy the KEYCLOAK_HOME/domain/ directory from the previous installation over the directory
in the new installation.</p>
</div>
<div class="paragraph">
<p>For domain installations, create the empty directory KEYCLOAK_HOME/domain/deployments.</p>
</div>
<div class="paragraph">
<p>NOTE:
Files in the bin directory should not be overwritten by the files from previous versions. Changes should be made manually.</p>
</div>
</li>
<li>
<p>Copy any custom modules that have been added to the modules directory.</p>
</li>
<li>
<p>Run the applicable upgrade script below.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="running-the-standalone-mode-upgrade-script"><a class="anchor" href="#running-the-standalone-mode-upgrade-script"></a>Running the Standalone Mode Upgrade Script</h4>
<div class="paragraph">
<p>To run the upgrade script for standalone mode, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you are using a different configuration file than the default one, edit the migration script to specify the new file name.</p>
</li>
<li>
<p>Stop the server.</p>
</li>
<li>
<p>Run the upgrade script:</p>
<div class="literalblock">
<div class="content">
<pre>bin/jboss-cli.sh --file=bin/migrate-standalone.cli</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="running-the-standalone-high-availability-mode-upgrade-script"><a class="anchor" href="#running-the-standalone-high-availability-mode-upgrade-script"></a>Running the Standalone-High Availability Mode Upgrade Script</h4>
<div class="paragraph">
<p>For standalone-high availability (HA) mode, all instances must be upgraded at the same time.</p>
</div>
<div class="paragraph">
<p>To run the upgrade script for standalone-HA mode, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you are using a different configuration file than the default one, edit the migration script to specify the new file name.</p>
</li>
<li>
<p>Stop the server.</p>
</li>
<li>
<p>Run the upgrade script:</p>
<div class="literalblock">
<div class="content">
<pre>bin/jboss-cli.sh --file=bin/migrate-standalone-ha.cli</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="running-the-domain-mode-upgrade-script"><a class="anchor" href="#running-the-domain-mode-upgrade-script"></a>Running the Domain Mode Upgrade Script</h4>
<div class="paragraph">
<p>For domain mode, all instances must be upgraded at the same time.</p>
</div>
<div class="paragraph">
<p>To run the upgrade script for domain mode, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you have changed the profile name, you must edit the upgrade script to change a variable near the beginning of the script.</p>
</li>
<li>
<p>Edit the domain script to include the location of the keycloak-server.json file.</p>
</li>
<li>
<p>Stop the server.</p>
</li>
<li>
<p>Run the upgrade script on the domain controller only:</p>
<div class="literalblock">
<div class="content">
<pre>bin/jboss-cli.sh --file=bin/migrate-domain.cli</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_migrate_db"><a class="anchor" href="#_migrate_db"></a>Migrating the Database</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak-documentation/blob/master/upgrading/topics/migrate_db.adoc" target="_blank">Edit this section</a>
<a href="https://issues.redhat.com/secure/CreateIssueDetails!init.jspa?pid=12313920&amp;components=12323375&amp;issuetype=1&amp;priority=3&amp;description=File:%20upgrading/topics/migrate_db.adoc" target="_blank">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>Keycloak can automatically migrate the database schema, or you can choose to do it manually. By default the
database is automatically migrated when you start the new installation for the first time.</p>
</div>
<div class="sect3">
<h4 id="automatic-relational-database-migration"><a class="anchor" href="#automatic-relational-database-migration"></a>Automatic Relational Database Migration</h4>
<div class="paragraph">
<p>To enable automatic upgrading of the database schema, set the migrationStrategy property value to "update" for the
default connectionsJpa provider:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"> <span class="tag">&lt;spi</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionsJpa</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;provider</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;properties&gt;</span>
            ...
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">migrationStrategy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">update</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/properties&gt;</span>
    <span class="tag">&lt;/provider&gt;</span>
<span class="tag">&lt;/spi&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or run this CLI command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/subsystem=keycloak-server/spi=connectionsJpa/provider=default/:map-put(name=properties,key=migrationStrategy,value=update)</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you start the server with this setting your database is automatically migrated if the database schema has changed
in the new version.</p>
</div>
<div class="paragraph">
<p>Creating an index on huge tables with millions of records can easily take a huge amount of time
and potentially cause major service disruption on upgrades.
For those cases, we added a threshold (the number of records) for automated index creation.
By default, this threshold is <code>300000</code> records.
When the number of records is higher than the threshold, the index is not created automatically,
and there will be a warning message in server logs including SQL commands which can be applied later manually.</p>
</div>
<div class="paragraph">
<p>To change the threshold, set the <code>indexCreationThreshold</code> property, value for the default <code>connectionsLiquibase</code> provider:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;spi</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionsLiquibase</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;provider</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;properties&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">indexCreationThreshold</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">300000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/properties&gt;</span>
    <span class="tag">&lt;/provider&gt;</span>
<span class="tag">&lt;/spi&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or run this CLI command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/subsystem=keycloak-server/spi=connectionsLiquibase/:add(default-provider=default)
/subsystem=keycloak-server/spi=connectionsLiquibase/provider=default/:add(properties={indexCreationThreshold =&gt; &quot;300000&quot;},enabled=true)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="manual-relational-database-migration"><a class="anchor" href="#manual-relational-database-migration"></a>Manual Relational Database Migration</h4>
<div class="paragraph">
<p>To enable manual upgrading of the database schema, set the migrationStrategy property value to "manual" for the default
connectionsJpa provider:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"> <span class="tag">&lt;spi</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionsJpa</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;provider</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;properties&gt;</span>
            ...
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">migrationStrategy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">manual</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/properties&gt;</span>
    <span class="tag">&lt;/provider&gt;</span>
<span class="tag">&lt;/spi&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or run this CLI command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/subsystem=keycloak-server/spi=connectionsJpa/provider=default/:map-put(name=properties,key=migrationStrategy,value=manual)</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you start the server with this configuration it checks if the database needs to be migrated. The required changes
are written to an SQL file that you can review and manually run against the database. For further details on how to
apply this file to the database, see the documentation for the relational database you&#8217;re using. After the changes have
been written to the file, the server exits.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_migrate_themes"><a class="anchor" href="#_migrate_themes"></a>Migrating Themes</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak-documentation/blob/master/upgrading/topics/migrate_themes.adoc" target="_blank">Edit this section</a>
<a href="https://issues.redhat.com/secure/CreateIssueDetails!init.jspa?pid=12313920&amp;components=12323375&amp;issuetype=1&amp;priority=3&amp;description=File:%20upgrading/topics/migrate_themes.adoc" target="_blank">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>If you have created any custom themes they must be migrated to the new server. Any changes to the built-in themes might
need to be reflected in your custom themes, depending on which aspects you have customized.</p>
</div>
<div class="paragraph">
<p>You must copy your custom themes from the old server "themes" directory to the new server "themes" directory.
After that you need to review the changes below and consider if the changes need to be applied to your custom theme.</p>
</div>
<div class="paragraph">
<p>In summary:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you have customized any of the changed templates listed below you need to compare the template from the base theme
to see if there are changes you need to apply.</p>
</li>
<li>
<p>If you have customized any of the styles and are extending the Keycloak themes you need to review the changes to
the styles. If you are extending the base theme you can skip this step.</p>
</li>
<li>
<p>If you have customized messages you might need to change the key or value or to add additional messages.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="migrating-templates"><a class="anchor" href="#migrating-templates"></a>Migrating Templates</h4>
<div class="paragraph">
<p>If you have customized any of the templates you need to carefully review the changes that have been made to the templates
to decide if you need to apply these changes to your customized templates. Most likely you will need to apply the same
changes to your customized templates. If you have not customized any of the listed templates you can skip this section.</p>
</div>
<div class="paragraph">
<p>A best practice is to use a diff tool to compare the templates to see what changes you might need to make to your
customized template. If you have only made minor changes it is simpler to compare the updated template to your
customized template. However, if you have made many changes it might be easier to compare the new template to your
customized old template, as this will show you what changes you need to make.</p>
</div>
<div class="paragraph">
<p>The following screenshot compares the info.ftl template from the Login theme and an example custom theme:</p>
</div>
<div class="paragraph">
<div class="title">Comparison of the updated version of a Login theme template with an example custom Login theme template</div>
<p><span class="image"><img src="./images/theme-migration-meld-info-1.png" alt="theme migration meld info 1"></span></p>
</div>
<div class="paragraph">
<p>From this comparison it is easy to identify that the first change ("Hello world!!") was a customization, while the
second change ("if pageRedirectUri") is a change to the base theme. By copying the second change to your custom template,
you have successfully updated your customized template.</p>
</div>
<div class="paragraph">
<p>For the alternative approach the following screenshot compares the info.ftl template from the old installation with
the updated info.ftl template from the new installation:</p>
</div>
<div class="paragraph">
<div class="title">Comparison of the Login theme template from the old installation with the updated version of the Login theme template</div>
<p><span class="image"><img src="./images/theme-migration-meld-info-2.png" alt="theme migration meld info 2"></span></p>
</div>
<div class="paragraph">
<p>From this comparison it is easy to identify what has been changed in the base template. You will then manually have to
make the same changes to your modified template. Since this approach is not as simple as the first approach, only use
this approach if the first one is not feasible.</p>
</div>
</div>
<div class="sect3">
<h4 id="migrating-messages"><a class="anchor" href="#migrating-messages"></a>Migrating Messages</h4>
<div class="paragraph">
<p>If you have added support for another language, you need to apply all the changes listed above. If you have not added
support for another language, you might not need to change anything; you only have to make changes if you have changed
an affected message in your theme.</p>
</div>
<div class="paragraph">
<p>For added values, review the value of the message in the base theme to determine if you need to customize that message.</p>
</div>
<div class="paragraph">
<p>For renamed keys, rename the key in your custom theme.</p>
</div>
<div class="paragraph">
<p>For changed values, check the value in the base theme to determine if you need to make changes to your custom theme.</p>
</div>
</div>
<div class="sect3">
<h4 id="migrating-styles"><a class="anchor" href="#migrating-styles"></a>Migrating Styles</h4>
<div class="paragraph">
<p>If you are inheriting styles from the keycloak or rh-sso themes you might need to update your custom styles to reflect
changes made to the styles from the built-in themes.</p>
</div>
<div class="paragraph">
<p>A best practice is to use a diff tool to compare the changes to stylesheets between the old server installation and the
new server installation.</p>
</div>
<div class="paragraph">
<p>For example, using the diff command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ diff KEYCLOAK_HOME_OLD/themes/keycloak/login/resources/css/login.css \
KEYCLOAK_HOME_NEW/themes/keycloak/login/resources/css/login.css</code></pre>
</div>
</div>
<div class="paragraph">
<p>Review the changes and determine if they affect your custom styling.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="upgrading-keycloak-adapters"><a class="anchor" href="#upgrading-keycloak-adapters"></a>Upgrading Keycloak Adapters</h2>
<div class="sectionbody">
<div id="_upgrade_adapters" class="paragraph">
<p>It is important that you upgrade Keycloak server first, and then upgrade the adapters. Earlier versions of the
adapter might work with later versions of Keycloak server, but earlier versions of Keycloak server might not
work with later versions of the adapter.</p>
</div>
<div class="sect2">
<h3 id="_compatibility_with_older_adapters"><a class="anchor" href="#_compatibility_with_older_adapters"></a>Compatibility with older adapters</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak-documentation/blob/master/upgrading/topics/upgrade_adapters.adoc" target="_blank">Edit this section</a>
<a href="https://issues.redhat.com/secure/CreateIssueDetails!init.jspa?pid=12313920&amp;components=12323375&amp;issuetype=1&amp;priority=3&amp;description=File:%20upgrading/topics/upgrade_adapters.adoc" target="_blank">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>As mentioned above, we try to support newer release versions of Keycloak server working with older release versions of the adapters.
However, in some cases we need to include fixes on the Keycloak server side which may break compatibility with older versions
of the adapters. For example, when we implement new aspects of the OpenID Connect specification, which older client adapter versions
were not aware of.</p>
</div>
<div class="paragraph">
<p>In those cases, we added Compatibility modes. For OpenId Connect clients, there is a section named <code>OpenID Connect Compatibility Modes</code>
in the Keycloak admin console, on the page with client details. Here, you can disable some new aspects of the Keycloak server
to preserve compatibility with older client adapters. More details are available in the tool tips of individual switches.</p>
</div>
</div>
<div class="sect2">
<h3 id="_upgrade_eap_adapter"><a class="anchor" href="#_upgrade_eap_adapter"></a>Upgrading the EAP Adapter</h3>
<div class="paragraph">
<p>To upgrade the WildFly adapter, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download the new adapter archive.</p>
</li>
<li>
<p>Remove the previous adapter modules by deleting the <code>WILDFLY_HOME/modules/system/add-ons/keycloak/</code> directory.</p>
</li>
<li>
<p>Unzip the downloaded archive into WILDFLY_HOME.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_upgrade_js_adapter"><a class="anchor" href="#_upgrade_js_adapter"></a>Upgrading the JavaScript Adapter</h3>
<div class="paragraph">
<p>To upgrade a JavaScript adapter that has been copied to your web application, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download the new adapter archive.</p>
</li>
<li>
<p>Overwrite the keycloak.js file in your application with the keycloak.js file from the downloaded archive.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_upgrade_nodejs_adapter"><a class="anchor" href="#_upgrade_nodejs_adapter"></a>Upgrading the Node.js Adapter</h3>
<div class="paragraph">
<p>To upgrade a Node.js adapter that has been copied to your web application, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download the new adapter archive.</p>
</li>
<li>
<p>Remove the existing Node.js adapter directory</p>
</li>
<li>
<p>Unzip the updated file into its place</p>
</li>
<li>
<p>Change the dependency for keycloak-connect in the package.json of your application</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="upgrading-keycloak-admin-client"><a class="anchor" href="#upgrading-keycloak-admin-client"></a>Upgrading Keycloak Admin Client</h2>
<div class="sectionbody">
<div id="_upgrade_admin_client" class="paragraph">
<p>It is important that you upgrade the Keycloak server first, and then upgrade the admin-client. Earlier versions of the
admin-client might work with later versions of Keycloak server, but earlier versions of Keycloak server might not
work with later versions of the admin-client. It is recommended to use the admin-client version that matches the used
Keycloak server version.</p>
</div>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak-documentation/blob/master/upgrading/topics/upgrade_admin_client.adoc" target="_blank">Edit this section</a>
<a href="https://issues.redhat.com/secure/CreateIssueDetails!init.jspa?pid=12313920&amp;components=12323375&amp;issuetype=1&amp;priority=3&amp;description=File:%20upgrading/topics/upgrade_admin_client.adoc" target="_blank">Report an issue</a>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="migration-changes"><a class="anchor" href="#migration-changes"></a>Migration Changes</h2>
<div class="sectionbody">
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak-documentation/blob/master/upgrading/topics/keycloak/changes.adoc" target="_blank">Edit this section</a>
<a href="https://issues.redhat.com/secure/CreateIssueDetails!init.jspa?pid=12313920&amp;components=12323375&amp;issuetype=1&amp;priority=3&amp;description=File:%20upgrading/topics/keycloak/changes.adoc" target="_blank">Report an issue</a>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-14-0-0"><a class="anchor" href="#migrating-to-14-0-0"></a>Migrating to 14.0.0</h3>
<div class="sect3">
<h4 id="client-policies-migration"><a class="anchor" href="#client-policies-migration"></a>Client Policies Migration</h4>
<div class="paragraph">
<p>The Client policies feature was a preview feature since Keycloak 12 and did not have proper support. If you tried this feature and configured some client policies or client profiles
in Keycloak 12 or Keycloak 13, then you will need to configure your client policies and client profiles again in the new version. The format of the configuration changed significantly
as it was only a preview and hence we do not provide automatic migration of client policies and client profiles created in Keycloak 12 or Keycloak 13.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-13-0-0"><a class="anchor" href="#migrating-to-13-0-0"></a>Migrating to 13.0.0</h3>
<div class="sect3">
<h4 id="manual-migration-step-needed"><a class="anchor" href="#manual-migration-step-needed"></a>Manual migration step needed</h4>
<div class="paragraph">
<p>Manual change is required when the standalone.xml contains references to any of the SmallRye modules.
SmallRye modules were removed from the underlying WildFly distribution, and the server does not start
if the configuration references them. Thus if the configuration in the <code>standalone.xml</code> refers to these modules,
the server configuration migration via <code>migrate-standalone.cli</code> fails before any changes are made to the configuration.
In such case, to perform server configuration migration, you have to manually remove all the lines that refer
to SmallRye modules. In the default configuration, you need to remove specifically the following lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;extension</span> <span class="attribute-name">module</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.wildfly.extension.microprofile.config-smallrye</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;extension</span> <span class="attribute-name">module</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.wildfly.extension.microprofile.health-smallrye</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;extension</span> <span class="attribute-name">module</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.wildfly.extension.microprofile.metrics-smallrye</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:wildfly:microprofile-config-smallrye:1.0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:wildfly:microprofile-health-smallrye:2.0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">empty-liveness-checks-status</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${env.MP_HEALTH_EMPTY_LIVENESS_CHECKS_STATUS:UP}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">empty-readiness-checks-status</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${env.MP_HEALTH_EMPTY_READINESS_CHECKS_STATUS:UP}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:wildfly:microprofile-metrics-smallrye:2.0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">exposed-subsystems</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">prefix</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${wildfly.metrics.prefix:wildfly}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="upgrade-to-wildfly-23"><a class="anchor" href="#upgrade-to-wildfly-23"></a>Upgrade to Wildfly 23</h4>
<div class="paragraph">
<p>The Keycloak server was upgraded to use Wildfly 23 as the underlying container. This does not directly involve any
specific Keycloak server functionality, however, note these changes related to migration:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Dependency updates</dt>
<dd>
<p>The dependencies were updated to the versions used by the Wildfly 23 server. For example, Infinispan is now <code>11.0.9.Final</code>.</p>
</dd>
<dt class="hdlist1">Configuration changes</dt>
<dd>
<p>A few configuration changes exist in the <code>standalone(-ha).xml</code> and <code>domain.xml</code> files. You should follow the <a href="#_install_new_version">Upgrading Keycloak server</a>
section to handle the migration of configuration files automatically. However, here are the most important changes, which you may need
if you made your own configuration changes:</p>
<div class="ulist">
<ul>
<li>
<p>The <code>module</code> attribute of Infinispan cache containers is now <strong>deprecated</strong> (unused) and is <strong>replaced with</strong> the <code>modules</code> attribute,
representing the set of modules associated with this cache container&#8217;s configuration. Moreover, there were also additional
changes to attributes of various elements, originating from the use of Wildfly 23 as the underlying container. For example,
the <code>managed-executor-service</code> and <code>managed-scheduled-executor-service</code> elements now recognize the new <code>hung-task-termination-period</code>
attribute. See <a href="https://docs.wildfly.org/23/wildscribe/index.html">the Wildfly 23 full model reference</a> for details.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="upgrade-to-wildfly-22"><a class="anchor" href="#upgrade-to-wildfly-22"></a>Upgrade to Wildfly 22</h4>
<div class="paragraph">
<p>The Keycloak server was upgraded to use Wildfly 22 as the underlying container. This does not directly involve any
specific Keycloak server functionality, however, note these changes related to migration:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Dependency updates</dt>
<dd>
<p>The dependencies were updated to the versions used by the Wildfly 22 server. For example, Infinispan is now <code>11.0.8.Final</code>.</p>
</dd>
<dt class="hdlist1">Configuration changes</dt>
<dd>
<p>A few configuration changes exist in the <code>standalone(-ha).xml</code> and <code>domain.xml</code> files. You should follow the <a href="#_install_new_version">Upgrading Keycloak server</a>
section to handle the migration of configuration files automatically. However, here are the most important changes, which you may need
if you made your own configuration changes:</p>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://docs.wildfly.org/22/Admin_Guide.html#MicroProfile_Config_SmallRye">Eclipse MicroProfile Config</a>, <a href="https://docs.wildfly.org/22/Admin_Guide.html#MicroProfile_Health_SmallRye">Eclipse MicroProfile Health</a>, and <a href="https://docs.wildfly.org/22/Admin_Guide.html#MicroProfile_Metrics_SmallRye">Eclipse MicroProfile Metrics</a> subsystems are replaced with <a href="https://docs.wildfly.org/22/Admin_Guide.html#Health">WildFly subsystem for health</a> and <a href="https://docs.wildfly.org/22/Admin_Guide.html#MicroProfile_Metrics_SmallRye">WildFly subsystem for base metrics</a>.</p>
</li>
<li>
<p>The default Wildfly configuration now uses the ability to make use of an automatically generated self-signed certificate with Elytron. Refer to <a href="https://docs.wildfly.org/22/WildFly_Elytron_Security.html#update-wildfly-to-use-the-default-elytron-components-for-application-authentication">a dedicated <code>applicationSSC</code> server SSL context section</a> for details.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-12-0-2"><a class="anchor" href="#migrating-to-12-0-2"></a>Migrating to 12.0.2</h3>
<div class="sect3">
<h4 id="read-only-attributes"><a class="anchor" href="#read-only-attributes"></a>Read-only attributes</h4>
<div class="paragraph">
<p>There was added support for the read-only user attributes. This includes the user attributes, which are not supposed to be edited by the user
or by the administrator when updating user with REST API or with the Keycloak user interfaces. It can be important especially if you
use:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Custom user storage providers</p>
</li>
<li>
<p>Custom authenticators</p>
</li>
<li>
<p>Custom Javascript authorization policies, which establish authorization based on some user attribute</p>
</li>
<li>
<p>X.509 authenticator with custom attribute for mapping the X.509 certificate to the user identity</p>
</li>
<li>
<p>Any other custom functionality, where some of the user attributes are used as the metadata for storing authentication/authorization/identity context rather
than simple user profile informations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the details in the <a href="https://www.keycloak.org/docs/15.0/server_admin/#_read_only_user_attributes">Threat model mitigation chapter</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="valid-request-uris"><a class="anchor" href="#valid-request-uris"></a>Valid Request URIs</h4>
<div class="paragraph">
<p>If you use the OpenID Connect parameter <code>request_uri</code>, a requirement exists that your client needs to have <code>Valid Request URIs</code> configured.
This can be configured through the admin console on the client details page or through the admin REST API or client registration API. Valid Request URIs need
to contain the list of Request URI values, which are permitted for the particular client. This is to avoid SSRF attacks. There is possibility to use wildcards
or relative paths similarly such as the <code>Valid Redirect URIs</code> option, however for security purposes, we typically recommend to use as specific value
as possible.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-12-0-0"><a class="anchor" href="#migrating-to-12-0-0"></a>Migrating to 12.0.0</h3>
<div class="sect3">
<h4 id="upgrade-to-wildfly-21"><a class="anchor" href="#upgrade-to-wildfly-21"></a>Upgrade to Wildfly 21</h4>
<div class="paragraph">
<p>The Keycloak server was upgraded to use Wildfly 21 as the underlying container. This does not directly involve any
specific Keycloak server functionality, however, note these changes related to migration:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Dependency updates</dt>
<dd>
<p>The dependencies were updated to the versions used by the Wildfly 21 server. For example, Infinispan is now 11.0.4.Final.</p>
</dd>
<dt class="hdlist1">Configuration changes</dt>
<dd>
<p>A few configuration changes exist in the <code>standalone(-ha).xml</code> and <code>domain.xml</code> files. You should follow the <a href="#_install_new_version">Upgrading Keycloak server</a>
section to handle the migration of configuration files automatically. However, here are the most important changes, which you may need
if you made your own configuration changes:</p>
<div class="ulist">
<ul>
<li>
<p>The <code>object-memory</code> element of Infinispan caches is now <strong>deprecated</strong> (unused) and is <strong>replaced with</strong> the <code>heap-memory</code> element.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="skip-creation-of-user-session-for-the-docker-protocol-authentication"><a class="anchor" href="#skip-creation-of-user-session-for-the-docker-protocol-authentication"></a>Skip creation of user session for the Docker protocol authentication</h4>
<div class="paragraph">
<p>No user session is created after successful authentication with the Docker protocol. For details, please refer to the <a href="https://www.keycloak.org/docs/15.0/server_admin/#_docker">Server Administration Guide</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="upgrade-to-patternfly-4"><a class="anchor" href="#upgrade-to-patternfly-4"></a>Upgrade to PatternFly 4</h4>
<div class="paragraph">
<p>The Keycloak login theme components have been upgraded to PatternFly 4.
The old PatternFly 3 runs simultaneously with the new one, so it&#8217;s possible to keep PF3 components.
However, some changes to the design of the login theme were performed. Please upgrade your custom login theme due them.
An example with the necessary changes can be found in the <code>keycloak/examples/themes/theme/sunrise</code> directory.
No additional setup is required.</p>
</div>
</div>
<div class="sect3">
<h4 id="client-credentials-grant-without-refresh-token-by-default"><a class="anchor" href="#client-credentials-grant-without-refresh-token-by-default"></a>Client Credentials Grant without refresh token by default</h4>
<div class="paragraph">
<p>From this Keycloak version, the OAuth2 Client Credentials Grant endpoint does not issue refresh tokens by default. This behavior is aligned with the OAuth2 specification.
As a side-effect of this change, no user session is created on the Keycloak server side after successful Client Credentials authentication, which results
in improved performance and memory consumption. Clients that use Client Credentials Grant are encouraged to stop using
refresh tokens and instead always authenticate at every request with <code>grant_type=client_credentials</code> instead of using <code>refresh_token</code> as grant type.
In relation to this, Keycloak has support for revocation of access tokens in the OAuth2 Revocation Endpoint, hence clients are allowed
to revoke individual access tokens if needed.</p>
</div>
<div class="paragraph">
<p>For backwards compatibility, a possibility to stick to the behavior of old versions exists. When this is used, the refresh token will be still issued after
a successful authentication with the Client Credentials Grant and also the user session will be created. This can be enabled for the particular client in
the Keycloak admin console, in client details in the section with <code>OpenID Connect Compatibility Modes</code> with the switch <code>Use Refresh Tokens For Client Credentials Grant</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-11-0-0"><a class="anchor" href="#migrating-to-11-0-0"></a>Migrating to 11.0.0</h3>
<div class="sect3">
<h4 id="upgrade-to-wildfly-20"><a class="anchor" href="#upgrade-to-wildfly-20"></a>Upgrade to Wildfly 20</h4>
<div class="paragraph">
<p>The Keycloak server was upgraded to use Wildfly 20 as the underlying container. This does not directly involve any
specific Keycloak server functionality, however, note these changes related to migration:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Dependency updates</dt>
<dd>
<p>The dependencies were updated to the versions used by the Wildfly 20 server. For example, Infinispan is now 10.1.8.Final.</p>
</dd>
<dt class="hdlist1">Configuration changes</dt>
<dd>
<p>A few configuration changes exist in the <code>standalone(-ha).xml</code> and <code>domain.xml</code> files. You should follow the <a href="#_install_new_version">Upgrading Keycloak server</a>
section to handle the migration of configuration files automatically.</p>
</dd>
<dt class="hdlist1">Cross-Datacenter Replication changes</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>You will need to upgrade Infinispan server to version 9.4.19. The older version may still work, but it is
not guaranteed as they are not tested anymore.</p>
</li>
<li>
<p>It is recommended to use the <code>protocolVersion</code> property added to the <code>remote-store</code> element when configuring Infinispan caches.
When connecting to the Infinispan server 9.4.18, the recommended version of the hotrod protocol version is 2.9 as the Infinispan
library version differs among Keycloak server and Infinispan server. For more details, see the
Cross-Datacenter documentation.</p>
</li>
<li>
<p>It is recommended to use <code>remoteStoreSecurityEnabled</code> property under <code>connectionsInfinispan</code> subsystem. For more details,
see the Cross-Datacenter documentation.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ldap-no-import-bugfix"><a class="anchor" href="#ldap-no-import-bugfix"></a>LDAP no-import bugfix</h4>
<div class="paragraph">
<p>In the previous Keycloak version, when the LDAP provider was configured with <code>Import Users</code> OFF, it was possible to update the
user even if some of non-LDAP mapped attributes were changed. This situation resulted in confusing behavior, when the attribute appeared to be updated,
but it was not. In the current version, the update is not allowed to be performed at all if any non-LDAP mapped attributes are changed.</p>
</div>
<div class="paragraph">
<p>This should not affect most of the deployments, but some can be affected under some rare circumstances. For example if you previously
tried to update a user with the admin REST API and the user had some incorrect attribute changes, the update was possible. With the
current version, the update is not possible and you will be immediately informed about the reason.</p>
</div>
</div>
<div class="sect3">
<h4 id="usermodel-changes"><a class="anchor" href="#usermodel-changes"></a>UserModel changes</h4>
<div class="paragraph">
<p>The fields <code>username</code>, <code>email</code>, <code>firstName</code> and <code>lastName</code> in the <code>UserModel</code> are migrated to custom attributes as a preparation for adding more sophisticated user profiles to Keycloak in an upcoming version.
If a database contains users with custom attributes of that exact name, the custom attributes will need to be migrated before upgrading. This migration does not occur automatically. Otherwise, they will not be read from the database anymore and possibly deleted.
This situation implies that the <code>username</code> can now also be accessed and set via <code>UserModel.getFirstAttribute(UserModel.USERNAME)</code>. Similar implications exist for other fields.
Implementors of SPIs subclassing the <code>UserModel</code> directly or indirectly should ensure that the behavior between <code>setUsername</code> and <code>setSingleAttribute(UserModel.USERNAME, &#8230;&#8203;)</code> (and similar for the other fields) is consistent.
Users of the policy evaluation feature have to adapt their policies if they use the number of attributes in their evaluations since every user will now have four new attributes by default.</p>
</div>
<div class="paragraph">
<p>The public API of <code>UserModel</code> did not change. No changes to frontend resources or SPIs accessing user data are necessary.
Also, the database did not change yet.</p>
</div>
</div>
<div class="sect3">
<h4 id="instagram-idp-migrated-to-new-the-api"><a class="anchor" href="#instagram-idp-migrated-to-new-the-api"></a>Instagram IdP migrated to new the API</h4>
<div class="paragraph">
<p>Instagram IdP now uses new API as the old legacy API was <strong>deprecated</strong>. This requires getting new API credentials. For details,
please refer to the <a href="https://www.keycloak.org/docs/15.0/server_admin/#instagram">Server Administration Guide</a>.</p>
</div>
<div class="paragraph">
<p>Special attention is required for existing users that use Instagram IdP, specially the ones for whom it is the only authentication
option. Such users have to login to Keycloak using Instagram IdP before September 30th, 2020. After that day they&#8217;ll have
to use a different authentication method (like password) to login to manually update their Instagram social link, or create
a new account in Keycloak. This is because Instagram user IDs are not compatible between the old and new API, however the
new API temporarily returns both new and old user IDs to allow migration. Keycloak automatically migrates the ID once user
logs in.</p>
</div>
</div>
<div class="sect3">
<h4 id="non-standard-token-introspection-endpoint-removed"><a class="anchor" href="#non-standard-token-introspection-endpoint-removed"></a>Non-standard token introspection endpoint removed</h4>
<div class="paragraph">
<p>In previous versions, Keycloak advertized two introspection endpoints: <code>token_introspection_endpoint</code> and <code>introspection_endpoint</code>.
The latter is the one defined by <a href="https://datatracker.ietf.org/doc/html/rfc8414#section-2">RFC-8414</a>. The former, previously deprecated,
has now been removed.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-9-0-1"><a class="anchor" href="#migrating-to-9-0-1"></a>Migrating to 9.0.1</h3>
<div class="sect3">
<h4 id="legacy-promise-in-javascript-adapter"><a class="anchor" href="#legacy-promise-in-javascript-adapter"></a>Legacy promise in JavaScript adapter</h4>
<div class="paragraph">
<p>It is no longer necessary to set promiseType in the JavaScript adapter, and both are available at the same time. It is
recommended to update applications to use native promise API (<code>then</code> and <code>catch</code>) as soon as possible, as the legacy API
(<code>success</code> and <code>error</code>) will be removed at some point.</p>
</div>
</div>
<div class="sect3">
<h4 id="duplicated-top-level-groups"><a class="anchor" href="#duplicated-top-level-groups"></a>Duplicated top level groups</h4>
<div class="paragraph">
<p>Version 9.0.1 fixes a problem which could create duplicated top level groups in the realm. Nevertheless the existence
of previous duplicated groups makes the upgrade process fail. The Keycloak server can be affected by this issue
if it is using a H2, MariaDB, MySQL or PostgreSQL database. Before launching the upgrade, check if the server contains
duplicated top level groups. For example the following SQL query can be executed at database level to list them:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT REALM_ID, NAME, COUNT(*) FROM KEYCLOAK_GROUP WHERE PARENT_GROUP is NULL GROUP BY REALM_ID, NAME HAVING COUNT(*) &gt; 1;</pre>
</div>
</div>
<div class="paragraph">
<p>Only one top level group can exist in each realm with the same name. Duplicates should be reviewed and deleted before the
upgrade. The error in the upgrade contains the message <code>Change Set META-INF/jpa-changelog-9.0.1.xml::9.0.1-
KEYCLOAK-12579-add-not-null-constraint::keycloak failed.</code></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-9-0-0"><a class="anchor" href="#migrating-to-9-0-0"></a>Migrating to 9.0.0</h3>
<div class="sect3">
<h4 id="improved-handling-of-user-locale"><a class="anchor" href="#improved-handling-of-user-locale"></a>Improved handling of user locale</h4>
<div class="paragraph">
<p>A number of improvements have been made to how the locale for the login page is selected, as well as when the locale
is updated for a user.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://www.keycloak.org/docs/15.0/server_admin/#_user_locale_selection">Server Administration Guide</a> for more details.</p>
</div>
</div>
<div class="sect3">
<h4 id="deprecated-methods-in-token-representation-java-classes"><a class="anchor" href="#deprecated-methods-in-token-representation-java-classes"></a>Deprecated methods in token representation Java classes</h4>
<div class="paragraph">
<p>In the year 2038 an <code>int</code> is no longer able to hold the value of seconds since 1970, as such we are working on updating these to
<code>long</code> values. Moreover, another issue related with processing of <code>int</code> values exists in token representation. An <code>int</code> will by
default result into <code>0</code> in the JSON representation, while it should not be included.</p>
</div>
<div class="paragraph">
<p>See JavaDocs for further details on exact methods that have been deprecated and replacement methods.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-8-0-2"><a class="anchor" href="#migrating-to-8-0-2"></a>Migrating to 8.0.2</h3>
<div class="sect3">
<h4 id="more-authentication-flows-changes"><a class="anchor" href="#more-authentication-flows-changes"></a>More Authentication flows changes</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">REQUIRED and ALTERNATIVE executions not supported at same flow</dt>
<dd>
<p>In previous version, it was possible to have REQUIRED and ALTERNATIVE executions in the same authentication flow at the same level.
There were some issues with this approach and we did the refactoring in the Authentication SPI, which means that this is not considered
valid anymore. If ALTERNATIVE and REQUIRED executions are configured at the same level, the ALTERNATIVE executions are considered disabled.
So when migrating to the newest version, your existing authentication flows will be automatically migrated preserved the same behavior as existed in the previous version.
If they contain ALTERNATIVE executions at the same level as some REQUIRED executions, then the ALTERNATIVE executions will be added to the separate REQUIRED subflow. This
should ensure same/similar behavior of the particular authentication flow as in the previous version. We always recommend
to doublecheck the configuration of your authentication flow and test it to doublecheck that everything works as expected.
This recommendation is true in particular if you have some more customized authentication flows with custom authenticator implementations.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-8-0-0"><a class="anchor" href="#migrating-to-8-0-0"></a>Migrating to 8.0.0</h3>
<div class="sect3">
<h4 id="new-default-hostname-provider"><a class="anchor" href="#new-default-hostname-provider"></a>New Default Hostname provider</h4>
<div class="paragraph">
<p>The old request and fixed hostname providers are replaced with a new default hostname provider. The request
and fixed hostname providers are now deprecated and it is recommended to switch to the default hostname provider as
soon as possible.</p>
</div>
</div>
<div class="sect3">
<h4 id="upgrade-to-wildfly-18"><a class="anchor" href="#upgrade-to-wildfly-18"></a>Upgrade to Wildfly 18</h4>
<div class="paragraph">
<p>The Keycloak server was upgraded to use Wildfly 18 as the underlying container. This does not directly involve any
specific Keycloak server functionality, however, note these changes related to migration:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Dependency updates</dt>
<dd>
<p>The dependencies were updated to the versions used by the Wildfly 18 server. For example, Infinispan is now 9.4.16.Final.</p>
</dd>
<dt class="hdlist1">Configuration changes</dt>
<dd>
<p>A few configuration changes exist in the <code>standalone(-ha).xml</code> and <code>domain.xml</code> files. You should follow the <a href="#_install_new_version">Upgrading Keycloak server</a>
section to handle the migration of configuration files automatically.</p>
</dd>
<dt class="hdlist1">Cross-Datacenter Replication changes</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>You will need to upgrade Infinispan server to version 9.4.19. The older version may still work, but it is
not guaranteed as we don&#8217;t test it anymore.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="deploying-scripts-to-the-server"><a class="anchor" href="#deploying-scripts-to-the-server"></a>Deploying Scripts to the Server</h4>
<div class="paragraph">
<p>Until now, administrators were allowed to upload scripts to the server through the Keycloak Administration Console as well as
through the RESTful Admin API.</p>
</div>
<div class="paragraph">
<p>For now on, this capability is <strong>disabled</strong> by default and users should prefer to deploy scripts directly to the server. For more details,
please take a look at <a href="https://www.keycloak.org/docs/15.0/server_development/#_script_providers">JavaScript Providers</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="client-credentials-in-the-javascript-adapter"><a class="anchor" href="#client-credentials-in-the-javascript-adapter"></a>Client Credentials in the JavaScript adapter</h4>
<div class="paragraph">
<p>In the previous releases, developers were allowed to provide client credentials to the JavaScript adapter. For now on, this capability was <strong>removed</strong>, because client-side apps are not safe to keep secrets.</p>
</div>
</div>
<div class="sect3">
<h4 id="authentication-flows-changes"><a class="anchor" href="#authentication-flows-changes"></a>Authentication flows changes</h4>
<div class="paragraph">
<p>We did some refactoring and improvements related to the authentication flows, which requires some attention during migration.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">OPTIONAL execution requirement removed</dt>
<dd>
<p>Regarding migration, the most important change is removing the support for the OPTIONAL requirement from authentication executions and
replacing it with the CONDITIONAL requirement, which allows more flexibility. The existing OPTIONAL authenticators configured in the
previous version are replaced with the CONDITIONAL subflows. These subflows have the <code>Condition - User Configured</code> condition configured
as first execution, and the previously OPTIONAL authenticator (for example <code>OTP Form</code>) as second execution. From the user&#8217;s point of view,
the behavior during authentication is the same as in the previous version.</p>
</dd>
<dt class="hdlist1">Changes in the Java SPI</dt>
<dd>
<p>Some changes exist in the Java Authentication SPI and Credential Provider SPI. The interface <code>Authenticator</code> is not changed,
but you may be affected if you&#8217;re developing more advanced authenticators, which introduce some new credential types (subclasses of <code>CredentialModel</code>).
There are changes on the <code>CredentialProvider</code> interface and introduction of some new interfaces like <code>CredentialValidator</code>. Also you
may be affected if your authenticator supported the OPTIONAL execution requirement. It is recommended to double check the latest authentication
examples in the server development guide for more details.</p>
</dd>
<dt class="hdlist1">Freemarker template changes</dt>
<dd>
<p>Some changes in the freemarker templates exist. You may be affected if you have your own theme with custom freemarker
templates for login forms or some account forms, especially for the forms related to OTP. It is recommended to double check changes in
the Freemarker templates in the latest Keycloak and align your templates according to it.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="user-credentials-changes"><a class="anchor" href="#user-credentials-changes"></a>User credentials changes</h4>
<div class="paragraph">
<p>We added more flexibility around storing of user credentials. Among other things, every user can have multiple credentials of the same
type, for example multiple OTP credentials. As a result, some changes to the database schema were performed. However the credentials from
the previous version should be automatically updated to the new format and users should be still able to login with their passwords or OTP
credentials set in the previous version.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-7-0-0"><a class="anchor" href="#migrating-to-7-0-0"></a>Migrating to 7.0.0</h3>
<div class="sect3">
<h4 id="upgrade-to-wildfly-17"><a class="anchor" href="#upgrade-to-wildfly-17"></a>Upgrade to Wildfly 17</h4>
<div class="paragraph">
<p>The Keycloak server was upgraded to use Wildfly 17 as the underlying container. This does not directly involve any
specific Keycloak server functionality, however, note these changes related to migration:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Dependency updates</dt>
<dd>
<p>The dependencies were updated to the versions used by the Wildfly 17 server. For example, Infinispan is now 9.4.14.Final.</p>
</dd>
<dt class="hdlist1">Configuration changes</dt>
<dd>
<p>A few configuration changes exist in the <code>standalone(-ha).xml</code> and <code>domain.xml</code> files. You should follow the <a href="#_install_new_version">Upgrading Keycloak server</a>
section to handle the migration of configuration files automatically.</p>
</dd>
<dt class="hdlist1">Cross-Datacenter Replication changes</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>You will need to upgrade Infinispan server to version 9.4.19. The older version may still work, but it is
not guaranteed as we don&#8217;t test it anymore.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-6-0-0"><a class="anchor" href="#migrating-to-6-0-0"></a>Migrating to 6.0.0</h3>
<div class="sect3">
<h4 id="upgrade-to-wildfly-16"><a class="anchor" href="#upgrade-to-wildfly-16"></a>Upgrade to Wildfly 16</h4>
<div class="paragraph">
<p>The Keycloak server was upgraded to use Wildfly 16 as the underlying container. This does not directly involve any
specific Keycloak server functionality, however, note these changes related to migration:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Dependency updates</dt>
<dd>
<p>The dependencies were updated to the versions used by the Wildfly 16 server. For example, Infinispan is now 9.4.8.Final.</p>
</dd>
<dt class="hdlist1">Configuration changes</dt>
<dd>
<p>A few configuration changes exist in the <code>standalone(-ha).xml</code> and <code>domain.xml</code> files. You should follow the <a href="#_install_new_version">Upgrading Keycloak server</a>
section to handle the migration of configuration files automatically.</p>
</dd>
<dt class="hdlist1">Cross-Datacenter Replication changes</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>You will need to upgrade Infinispan server to version 9.4.19. The older version may still work, but it is
not guaranteed as we don&#8217;t test it anymore.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="new-optional-client-scope"><a class="anchor" href="#new-optional-client-scope"></a>New optional client scope</h4>
<div class="paragraph">
<p>We have added a new <code>microprofile-jwt</code> optional client scope to handle the claims defined in the <a href="https://wiki.eclipse.org/MicroProfile/JWT_Auth">MicroProfile/JWT Auth Specification</a>.
This new client scope defines protocol mappers to set the username of the authenticated user to the <code>upn</code> claim and to
set the realm roles to the <code>groups</code> claim.</p>
</div>
</div>
<div class="sect3">
<h4 id="ability-to-propagate-prompt-none-to-default-idp"><a class="anchor" href="#ability-to-propagate-prompt-none-to-default-idp"></a>Ability to propagate prompt=none to default IDP</h4>
<div class="paragraph">
<p>We have added a new switch in the OIDC identity provider configuration named <code>Accepts prompt=none forward from client</code> to identify IDPs that
are able to handle forwarded requests that include the <code>prompt=none</code> query parameter.</p>
</div>
<div class="paragraph">
<p>Until now, when receiving an auth request with <code>prompt=none</code> a realm would return a <code>login_required</code> error if the user is
not authenticated in the realm without checking if the user has been authenticated by an IDP. From now on, if a default
IDP can be determined for the auth request (either by the use of the <code>kc_idp_hint</code> query param or by setting up a default IDP
for the realm) and if the <code>Accepts prompt=none forward from client</code> switch has been enabled for the IDP, the auth request is forwarded to the IDP
to check if the user has been authenticated there.</p>
</div>
<div class="paragraph">
<p>It is important to note that this switch is only taken into account if a default IDP is specified, in which case we know
where to forward the auth request without having to prompt the user to select an IDP. If a default IDP cannot be determined
we cannot assume which one will be used to fulfill the auth request so the request forwarding is not performed.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-5-0-0"><a class="anchor" href="#migrating-to-5-0-0"></a>Migrating to 5.0.0</h3>
<div class="sect3">
<h4 id="upgrade-to-wildfly-15"><a class="anchor" href="#upgrade-to-wildfly-15"></a>Upgrade to Wildfly 15</h4>
<div class="paragraph">
<p>The Keycloak server was upgraded to use Wildfly 15 as the underlying container. This does not directly involve any
specific Keycloak server functionality, however, note these changes related to migration:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Dependency updates</dt>
<dd>
<p>The dependencies were updated to the versions used by the Wildfly 15 server. For example, Infinispan is now 9.4.3.Final.</p>
</dd>
<dt class="hdlist1">Configuration changes</dt>
<dd>
<p>A few configuration changes exist in the <code>standalone(-ha).xml</code> and <code>domain.xml</code> files. You should follow the <a href="#_install_new_version">Upgrading Keycloak server</a>
section to handle the migration of configuration files automatically.</p>
</dd>
<dt class="hdlist1">Cross-Datacenter Replication changes</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>You will need to upgrade Infinispan server to version 9.4.19. The older version may still work, but it is
not guaranteed as we don&#8217;t test it anymore.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-4-8-2"><a class="anchor" href="#migrating-to-4-8-2"></a>Migrating to 4.8.2</h3>
<div class="sect3">
<h4 id="google-identity-provider-updated-to-use-google-sign-in-authentication-system"><a class="anchor" href="#google-identity-provider-updated-to-use-google-sign-in-authentication-system"></a>Google Identity Provider updated to use Google Sign-in authentication system</h4>
<div class="paragraph">
<p>The Google Identity Provider implementation in Keycloak up to version 4.8.1 relies on the Google+ API endpoints
endpoints for authorization and obtaining the user profile. From March 2019 onwards, Google is removing support
for the Google+ API in favor of the new Google Sign-in authentication system. The Keycloak identity provider has been updated
to use the new endpoints so if this integration is in use make sure you upgrade to Keycloak version 4.8.2 or later.</p>
</div>
<div class="paragraph">
<p>If you run into an error saying that the application identifier was not found in the directory, you will have to register the client application again in the
<a href="https://console.developers.google.com/apis/credentials">Google API Console</a> portal to obtain a new application id and secret.</p>
</div>
<div class="paragraph">
<p>It is possible that you will need to adjust custom mappers for non-standard claims that were provided by Google+ user
information endpoint and are provided under different name by Google Sign-in API. Please consult Google documentation
for the most up-to-date information on available claims.</p>
</div>
</div>
<div class="sect3">
<h4 id="linkedin-social-broker-updated-to-version-2-of-linkedin-apis"><a class="anchor" href="#linkedin-social-broker-updated-to-version-2-of-linkedin-apis"></a>LinkedIn Social Broker Updated to Version 2 of LinkedIn APIs</h4>
<div class="paragraph">
<p>Accordingly with LinkedIn, all developers need to migrate to version 2.0 of their APIs and OAuth 2.0. As such, we have updated
our LinkedIn Social Broker.</p>
</div>
<div class="paragraph">
<p>Existing deployments using this broker may start experiencing errors when fetching user&#8217;s profile using version 2 of
LinkedIn APIs. This error may be related with the lack of permissions granted to the client application used to configure the broker
which may not be authorized to access the Profile API or request specific OAuth2 scopes during the authentication process.</p>
</div>
<div class="paragraph">
<p>Even for newly created LinkedIn client applications, you need to make sure that the client is able to request the <code>r_liteprofile</code> and
<code>r_emailaddress</code> OAuth2 scopes, at least, as well that the client application can fetch current member&#8217;s profile from the <code><a href="https://api.linkedin.com/v2/me" class="bare">https://api.linkedin.com/v2/me</a></code> endpoint.</p>
</div>
<div class="paragraph">
<p>Due to these privacy restrictions imposed by LinkedIn in regards to access to member&#8217;s information and the limited set of claims returned by the
current member&#8217;s Profile API, the LinkedIn Social Broker
is now using the member&#8217;s email address as the default username. That means that the <code>r_emailaddress</code> is always set when
sending authorization requests during the authentication.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-4-6-0"><a class="anchor" href="#migrating-to-4-6-0"></a>Migrating to 4.6.0</h3>
<div class="sect3">
<h4 id="new-default-client-scopes"><a class="anchor" href="#new-default-client-scopes"></a>New default client scopes</h4>
<div class="paragraph">
<p>We have added new realm default client scopes <code>roles</code> and <code>web-origins</code>. These client scopes contain protocol
mappers to add the roles of the user and allowed web origins to the token. During migration, these client scopes should be
automatically added to all the OpenID Connect clients as default client scopes. Hence no setup should be required after database
migration is finished.</p>
</div>
<div class="sect4">
<h5 id="protocol-mapper-spi-addition"><a class="anchor" href="#protocol-mapper-spi-addition"></a>Protocol mapper SPI addition</h5>
<div class="paragraph">
<p>Related to this, a small addition to the (unsupported) Protocol Mappers SPI exists. You can be affected only if you
implemented a custom ProtocolMapper. A new <code>getPriority()</code> method on the ProtocolMapper interface got introduced. The method has the
default implementation set to return 0. If your protocol mapper implementation relies on the roles in the access token <code>realmAccess</code>
or <code>resourceAccess</code> properties, you may need to increase the priority of your mapper.</p>
</div>
</div>
<div class="sect4">
<h5 id="audience-resolving"><a class="anchor" href="#audience-resolving"></a>Audience resolving</h5>
<div class="paragraph">
<p>Audiences of all the clients, for which authenticated user has at least one client role in the token, are automatically added
to the <code>aud</code> claim in the access token now. On the other hand, an access token may not automatically contain the audience of the
frontend client, for which it was issued. Read the <a href="https://www.keycloak.org/docs/15.0/server_admin/#_audience">Server Administration Guide</a> for more details.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="javascript-adapter-promise"><a class="anchor" href="#javascript-adapter-promise"></a>JavaScript Adapter Promise</h4>
<div class="paragraph">
<p>To use native JavaScript promise with the JavaScript adapter it is now required to set <code>promiseType</code> to <code>native</code> in the
init options.</p>
</div>
<div class="paragraph">
<p>In the past if native promise was available a wrapper was returned that provided both the legacy Keycloak promise and
the native promise. This was causing issues as the error handler was not always set prior to the native error event, which
resulted in <code>Uncaught (in promise)</code> error.</p>
</div>
</div>
<div class="sect3">
<h4 id="microsoft-identity-provider-updated-to-use-the-microsoft-graph-api"><a class="anchor" href="#microsoft-identity-provider-updated-to-use-the-microsoft-graph-api"></a>Microsoft Identity Provider updated to use the Microsoft Graph API</h4>
<div class="paragraph">
<p>The Microsoft Identity Provider implementation in Keycloak up to version 4.5.0 relies on the Live SDK
endpoints for authorization and obtaining the user profile. From November 2018 onwards, Microsoft is removing support
for the Live SDK API in favor of the new Microsoft Graph API. The Keycloak identity provider has been updated
to use the new endpoints so if this integration is in use make sure you upgrade to Keycloak version 4.6.0 or later.</p>
</div>
<div class="paragraph">
<p>Legacy client applications registered under "Live SDK applications" won&#8217;t work with the Microsoft Graph endpoints
due to changes in the id format of the applications. If you run into an error saying that the application identifier
was not found in the directory, you will have to register the client application again in the
<a href="https://account.live.com/developers/applications/create">Microsoft Application Registration</a> portal to obtain a new application id.</p>
</div>
</div>
<div class="sect3">
<h4 id="upgrade-to-wildfly-14"><a class="anchor" href="#upgrade-to-wildfly-14"></a>Upgrade to Wildfly 14</h4>
<div class="paragraph">
<p>The Keycloak server was upgraded to use Wildfly 14 as the underlying container. This does not directly involve any
specific Keycloak server functionality, however, note these changes related to migration:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Dependency updates</dt>
<dd>
<p>The dependencies were updated to the versions used by the Wildfly 14 server. For example, Infinispan is now 9.3.1.Final.</p>
</dd>
<dt class="hdlist1">Configuration changes</dt>
<dd>
<p>A few configuration changes exist in the <code>standalone(-ha).xml</code> and <code>domain.xml</code> files. You should follow the <a href="#_install_new_version">Upgrading Keycloak server</a>
section to handle the migration of configuration files automatically.</p>
</dd>
<dt class="hdlist1">Cross-Datacenter Replication changes</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>You will need to upgrade Infinispan server to version 9.4.19. The older version may still work, but it is
not guaranteed as we don&#8217;t test it anymore.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-4-4-0"><a class="anchor" href="#migrating-to-4-4-0"></a>Migrating to 4.4.0</h3>
<div class="sect3">
<h4 id="upgrade-to-wildfly-13"><a class="anchor" href="#upgrade-to-wildfly-13"></a>Upgrade to Wildfly 13</h4>
<div class="paragraph">
<p>The Keycloak server was upgraded to use Wildfly 13 as the underlying container. This does not directly involve any
specific Keycloak server functionality, however, note these changes related to migration:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Dependency updates</dt>
<dd>
<p>The dependencies were updated to the versions used by the Wildfly 13 server. For example, Infinispan is now 9.2.4.Final and Undertow is 2.0.9.Final</p>
</dd>
<dt class="hdlist1">Configuration changes</dt>
<dd>
<p>A few configuration changes exist in the <code>standalone(-ha).xml</code> and <code>domain.xml</code> files. You should follow the <a href="#_install_new_version">Upgrading Keycloak server</a>
section to handle the migration of configuration files automatically. However, here are the most important changes, which you may need
if you made your own configuration changes:</p>
<div class="ulist">
<ul>
<li>
<p>Element <code>eviction</code> on infinispan caches is now <strong>deprecated</strong> (unused) and is <strong>replaced with</strong> element <code>object-memory</code></p>
</li>
<li>
<p>The <code>cache-container</code> element in Infinispan subsystem <strong>does not recognize</strong> the <code>jndi-attribute</code> anymore.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Cross-Datacenter Replication changes</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>You will need to upgrade Infinispan server to version 9.4.19. The older version may still work, but it is
not guaranteed as we don&#8217;t test it anymore.</p>
</li>
<li>
<p>You don&#8217;t need to configure security anymore in the Infinispan server configuration file.</p>
</li>
<li>
<p>The <code>transaction</code> element needs to be removed from the configuration of replicated caches in the Infinispan server
configuration file. This is needed because of the infinispan bug <a href="https://issues.redhat.com/browse/ISPN-9323" class="bare">https://issues.redhat.com/browse/ISPN-9323</a>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migration-to-4-3-0"><a class="anchor" href="#migration-to-4-3-0"></a>Migration to 4.3.0</h3>
<div class="sect3">
<h4 id="hostname-configuration"><a class="anchor" href="#hostname-configuration"></a>Hostname configuration</h4>
<div class="paragraph">
<p>In previous versions it was recommended to use a filter to specify permitted hostnames. It is now possible to
set a fixed hostname which makes it easier to make sure the valid hostname is used and also allows internal
applications to invoke Keycloak through an alternative URL, for example an internal IP address. It is
recommended that you switch to this approach in production.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-4-0-0"><a class="anchor" href="#migrating-to-4-0-0"></a>Migrating to 4.0.0</h3>
<div class="sect3">
<h4 id="client-templates-changed-to-client-scopes"><a class="anchor" href="#client-templates-changed-to-client-scopes"></a>Client Templates changed to Client Scopes</h4>
<div class="paragraph">
<p>We added support for Client Scopes, which requires some attention during migration.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Client Templates changed to Client Scopes</dt>
<dd>
<p>Client Templates were changed to Client Scopes. If you had any Client Templates, their protocol mappers and role scope mappings
will be preserved.</p>
</dd>
<dt class="hdlist1">Spaces replaced in the names</dt>
<dd>
<p>Client templates with the space character in the name were renamed by replacing spaces with an underscore, because spaces are
not allowed in the name of client scopes. For example, a client template <code>my template</code> will be changed to client scope <code>my_template</code>.</p>
</dd>
<dt class="hdlist1">Linking Client Scopes to Clients</dt>
<dd>
<p>For clients which had the client template, the corresponding client scope
is now added as <code>Default Client Scope</code> to the client. So protocol mappers and role scope mappings will be preserved on the client.</p>
</dd>
<dt class="hdlist1">Realm Default Client Scopes not linked with existing clients</dt>
<dd>
<p>During the migration, the list of built-in client scopes is added to each realm as well as list of <code>Realm Default Client Scopes</code>. However,
existing clients are NOT upgraded and new client scopes are NOT automatically added to them. Also all the protocol mappers and role
scope mappings are kept on existing clients. In the new version, when you create a new client, it automatically has Realm Default Client Scopes
attached to it and it does not have any protocol mappers attached to it. We did not change existing clients during migration as it
would be impossible to properly detect customizations, which you will have for protocol mappers of the clients, for example. If you want to
update existing clients (remove protocol mappers from them and link them with client scopes), you will need to do it manually.</p>
</dd>
<dt class="hdlist1">Consents need to be confirmed again</dt>
<dd>
<p>The client scopes change required the refactoring of consents. Consents now point to client scopes, not to roles or protocol mappers.
Because of this change, the previously confirmed persistent consents by users are not valid anymore and users need to confirm
the consent page again after the migration.</p>
</dd>
<dt class="hdlist1">Some configuration switches removed</dt>
<dd>
<p>The switch <code>Scope Param Required</code> was removed from Role Detail. The switches <code>Consent Required</code> and <code>Consent Text</code> were removed
from the Protocol Mapper details. Those switches are replaced with the Client Scope feature.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="changes-to-authorization-services"><a class="anchor" href="#changes-to-authorization-services"></a>Changes to Authorization Services</h4>
<div class="paragraph">
<p>We added support for UMA 2.0. This version of the UMA specification introduced some important changes on how permissions are obtained from the server.</p>
</div>
<div class="paragraph">
<p>Here are the main changes introduced by UMA 2.0 support. See <a href="https://www.keycloak.org/docs/15.0/authorization_services/">Authorization Services Guide</a> for details.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Authorization API was removed</dt>
<dd>
<p>Prior to UMA 2.0 (UMA 1.0), client applications were using the Authorization API to obtain permissions from the server in the format of a RPT. The new version
of UMA specification has removed the Authorization API which was also removed from Keycloak. In UMA 2.0, RPTs can now be obtained from the token endpoint by using a specific grant type.
See <a href="https://www.keycloak.org/docs/15.0/authorization_services/#_service_obtaining_permissions">Authorization Services Guide</a> for details.</p>
</dd>
<dt class="hdlist1">Entitlement API was removed</dt>
<dd>
<p>With the introduction of UMA 2.0, we decided to leverage the token endpoint and UMA grant type to allow obtaining RPTs from Keycloak and
avoid having different APIs. The functionality provided by the Entitlement API was kept the same and is still possible to obtain permissions for a set
of one or more resources and scopes or all permissions from the server in case no resource or scope is provided.
See <a href="https://www.keycloak.org/docs/15.0/authorization_services/#_service_obtaining_permissions">Authorization Services Guide</a> for details.</p>
</dd>
<dt class="hdlist1">Changes to UMA Discovery Endpoint</dt>
<dd>
<p>UMA Discovery document changed, see <a href="https://www.keycloak.org/docs/15.0/authorization_services/#_service_authorization_api">Authorization Services Guide</a> for details.</p>
</dd>
<dt class="hdlist1">Changes to Keycloak Authorization JavaScript Adapter</dt>
<dd>
<p>The Keycloak Authorization JavaScript Adapter (keycloak-authz.js) changed in order to comply with the changes introduced by UMA 2.0 while keeping
the same behavior as before. The main change is on how you invoke both <code>authorization</code> and <code>entitlement</code> methods which now
expect a specific object type representing an authorization request. This new object type provides more flexibility on how
permissions can be obtained from the server by supporting the different parameters supported by the UMA grant type.
See <a href="https://www.keycloak.org/docs/15.0/authorization_services/#_enforcer_js_adapter">Authorization Services Guide</a> for details.</p>
<div class="literalblock">
<div class="content">
<pre>One of the main changes introduced by this release is that you are no longer required to exchange access tokens with RPTs in
order to access resources protected by a resource server (when not using UMA). Depending on how the policy enforcer is configured on the resource server side, you can just send regular
access tokens as a bearer token and permissions will still be enforced.</pre>
</div>
</div>
</dd>
<dt class="hdlist1">Changes to Keycloak Authorization Client Java API</dt>
<dd>
<p>When upgrading to the new version of Keycloak Authorization Client Java API, you&#8217;ll notice that some representation classes
were moved to a different package in <code>org.keycloak:keycloak-core</code>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-3-4-2"><a class="anchor" href="#migrating-to-3-4-2"></a>Migrating to 3.4.2</h3>
<div class="sect3">
<h4 id="added-session_state-parameter-to-openid-connect-authentication-response"><a class="anchor" href="#added-session_state-parameter-to-openid-connect-authentication-response"></a>Added session_state parameter to OpenID Connect Authentication Response</h4>
<div class="paragraph">
<p>The OpenID Connect Session Management specification requires that the parameter <code>session_state</code> is present in the OpenID Connect Authentication Response.</p>
</div>
<div class="paragraph">
<p>In past releases, we did not have this parameter, but now Keycloak adds this parameter by default, as required by the specification.</p>
</div>
<div class="paragraph">
<p>However, some OpenID Connect / OAuth2 adapters, and especially older Keycloak adapters, may have issues with this new parameter.</p>
</div>
<div class="paragraph">
<p>For example, the parameter will be always present in the browser URL after successful authentication to the client application.
In these cases, it may be useful to disable adding the <code>session_state</code> parameter to the authentication response. This can be done
for the particular client in the Keycloak admin console, in client details in the section with <code>OpenID Connect Compatibility Modes</code>,
described in <a href="#_compatibility_with_older_adapters">Compatibility with older adapters</a>. Dedicated <code>Exclude Session State From Authentication Response</code> switch exists,
which can be turned on to prevent adding the <code>session_state</code> parameter to the Authentication Response.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The parameter <code>session_state</code> was added in 3.4.2, however the switch <code>Exclude Session State From Authentication Response</code> was added
in 4.0.0.Beta1. If your Keycloak server is on 3.4.2 or 3.4.3 and you have issues with <code>session_state</code> parameter, you will need
to upgrade the server to 4.0.0.Beta1 or newer.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-3-2-0"><a class="anchor" href="#migrating-to-3-2-0"></a>Migrating to 3.2.0</h3>
<div class="sect3">
<h4 id="new-password-hashing-algorithms"><a class="anchor" href="#new-password-hashing-algorithms"></a>New Password Hashing algorithms</h4>
<div class="paragraph">
<p>We&#8217;ve added two new password hashing algorithms (pbkdf2-sha256 and pbkdf2-sha512). New realms will use the pbkdf2-sha256
hashing algorithm with 27500 hashing iterations. Since pbkdf2-sha256 is slightly faster than pbkdf2 the iterations was
increased to 27500 from 20000.</p>
</div>
<div class="paragraph">
<p>Existing realms are upgraded if the password policy contains the default value for hashing algorithm (not specified) and
iteration (20000). If you have changed the hashing iterations you need to manually change to pbkdf2-sha256 if you&#8217;d like
to use the more secure hashing algorithm.</p>
</div>
</div>
<div class="sect3">
<h4 id="id-token-requires-scope-openid"><a class="anchor" href="#id-token-requires-scope-openid"></a>ID Token requires scope=openid</h4>
<div class="paragraph">
<p>OpenID Connect specification requires that parameter <code>scope</code> with value <code>openid</code> is used in initial authorization request. So in Keycloak
2.1.0 we changed our adapters to use <code>scope=openid</code> in the redirect URI to Keycloak. Now we changed the server part too and ID token
will be sent to the application just if <code>scope=openid</code> is really used. If it&#8217;s not used, then ID token will be skipped and just Access token and Refresh token will be sent to the application.
This also allows that you can omit the generation of ID Token on purpose - for example for space or performance purposes.</p>
</div>
<div class="paragraph">
<p>Direct grants (OAuth2 Resource Owner Password Credentials Grant) and Service accounts login (OAuth2 Client credentials grant) also don&#8217;t use ID Token by default now.
You need to explicitly add <code>scope=openid</code> parameter to have ID Token included.</p>
</div>
</div>
<div class="sect3">
<h4 id="authentication-sessions-and-action-tokens"><a class="anchor" href="#authentication-sessions-and-action-tokens"></a>Authentication sessions and Action tokens</h4>
<div class="paragraph">
<p>We are working on support for multiple datacenters. As the initial step, we introduced authentication session and action tokens.
Authentication session replaces Client session, which was used in previous versions. Action tokens are currently used especially for the scenarios, where
the authenticator or requiredActionProvider requires sending email to the user and requires user to click on the link in email.</p>
</div>
<div class="paragraph">
<p>Here are concrete changes related to this, which may affect you for the migration.</p>
</div>
<div class="paragraph">
<p>First change related to this is introducing new Infinispan caches <code>authenticationSessions</code> and <code>actionTokens</code> in <code>standalone.xml</code> or <code>standalone-ha.xml</code>. If you use our migration CLI, you
don&#8217;t need to care much as your <code>standalone(-ha).xml</code> files will be migrated automatically.</p>
</div>
<div class="paragraph">
<p>Second change is changing of some signatures in methods of authentication SPI. This may affect you if you use custom <code>Authenticator</code> or
<code>RequiredActionProvider</code>. Classes <code>AuthenticationFlowContext</code> and <code>RequiredActionContext</code> now allow to retrieve authentication session
instead of client session.</p>
</div>
<div class="paragraph">
<p>We also added some initial support for sticky sessions. You may want to change your loadbalancer/proxy server and configure it if you don&#8217;t want to suffer from it and want to have better performance.
The route is added to the new <code>AUTH_SESSION_ID</code> cookie. More info in the clustering documentation.</p>
</div>
<div class="paragraph">
<p>Another change is, that <code>token.getClientSession()</code> was removed. This may affect you for example if you&#8217;re using Client Initiated Identity Broker Linking feature.</p>
</div>
<div class="paragraph">
<p>The <code>ScriptBasedAuthenticator</code> changed the binding name from <code>clientSession</code> to <code>authenticationSession</code>, so you would need to update your scripts if you&#8217;re using this authenticator.</p>
</div>
<div class="paragraph">
<p>Finally we added some new timeouts to the admin console. This allows you for example to specify different timeouts for the email actions triggered by admin and by user himself.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-2-5-1"><a class="anchor" href="#migrating-to-2-5-1"></a>Migrating to 2.5.1</h3>
<div class="sect3">
<h4 id="migration-of-old-offline-tokens"><a class="anchor" href="#migration-of-old-offline-tokens"></a>Migration of old offline tokens</h4>
<div class="paragraph">
<p>If you migrate from version 2.2.0 or older and you used offline tokens, then your offline tokens didn&#8217;t have KID in the token header.
We added KID to the token header in 2.3.0 together with the ability to have multiple realm keys, so Keycloak is able to find the correct key based on the token KID.</p>
</div>
<div class="paragraph">
<p>For the offline tokens without KID, Keycloak 2.5.1 will always use the active realm key to find the proper key for the token verification. In other words, migration of old
offline tokens will work. So for example, your user requested offline token in 1.9.8, then you migrate from 1.9.8 to 2.5.1 and then your user will be
still able to refresh his old offline token in 2.5.1 version.</p>
</div>
<div class="paragraph">
<p>But a limitation exists. Once you change the realm active key, the users won&#8217;t be able to refresh old offline tokens
anymore. So you shouldn&#8217;t change the active realm key until all your users with offline tokens refreshed their tokens. Obviously newly
refreshed tokens will have KID in the header, so after all users exchange their old offline tokens, you are free to change the active realm key.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-2-5-0"><a class="anchor" href="#migrating-to-2-5-0"></a>Migrating to 2.5.0</h3>
<div class="sect3">
<h4 id="changes-to-the-infinispan-caches"><a class="anchor" href="#changes-to-the-infinispan-caches"></a>Changes to the Infinispan caches</h4>
<div class="paragraph">
<p>The <code>realms</code> cache defined in the infinispan subsystem in <code>standalone.xml</code> or <code>standalone-ha.xml</code> configuration file, now has the eviction with the 10000 records by default.
This is the same default like the <code>users</code> cache.</p>
</div>
<div class="paragraph">
<p>Also the <code>authorization</code> cache now doesn&#8217;t have any eviction on it by default.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-2-4-0"><a class="anchor" href="#migrating-to-2-4-0"></a>Migrating to 2.4.0</h3>
<div class="sect3">
<h4 id="server-spi-split-into-server-spi-and-sever-spi-private"><a class="anchor" href="#server-spi-split-into-server-spi-and-sever-spi-private"></a>Server SPI split into Server SPI and Sever SPI Private</h4>
<div class="paragraph">
<p>The keycloak-server-spi module has been split into keycloak-server-spi and keycloak-server-spi-private. APIs within
keycloak-server-spi will not change between minor releases, while we reserve the right and may quite likely change
APIs in keycloak-server-spi-private between minor releases.</p>
</div>
</div>
<div class="sect3">
<h4 id="key-encryption-algorithm-in-saml-assertions"><a class="anchor" href="#key-encryption-algorithm-in-saml-assertions"></a>Key encryption algorithm in SAML assertions</h4>
<div class="paragraph">
<p>Key in SAML assertions and documents are now encrypted using RSA-OAEP encryption scheme.
If you want to use encrypted assertions, make sure that service providers understand this encryption scheme.
In the unlikely case that SP would not be able to handle the new scheme, Keycloak
can be made to use legacy RSA-v1.5 encryption scheme when started with system property
<code>keycloak.saml.key_trans.rsa_v1.5</code> set to <code>true</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="infinispan-caches-realms-and-users-are-always-local"><a class="anchor" href="#infinispan-caches-realms-and-users-are-always-local"></a>Infinispan caches realms and users are always local</h4>
<div class="paragraph">
<p>Even if you use Keycloak in cluster, the caches <code>realms</code> and <code>users</code> defined in infinispan subsystem in <code>standalone-ha.xml</code> are
always local caches now. A separate cache <code>work</code> exists, which handles sending invalidation messages between cluster nodes and informing whole cluster
what records in underlying <code>realms</code> and <code>users</code> caches should be invalidated.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-2-3-0"><a class="anchor" href="#migrating-to-2-3-0"></a>Migrating to 2.3.0</h3>
<div class="sect3">
<h4 id="default-max-results-on-paginated-endpoints"><a class="anchor" href="#default-max-results-on-paginated-endpoints"></a>Default max results on paginated endpoints</h4>
<div class="paragraph">
<p>All Admin REST API endpoints that support pagination now have a default max results set to 100. If you want to return
 more than 100 entries you need to explicitly specify that with <code>?max=&lt;RESULTS&gt;</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="code-realm-public-key-code-adapter-property-not-recommended"><a class="anchor" href="#code-realm-public-key-code-adapter-property-not-recommended"></a><code>realm-public-key</code> adapter property not recommended</h4>
<div class="paragraph">
<p>In 2.3.0 release we added support for Public Key Rotation. When admin rotates the realm keys in Keycloak admin console, the Client
Adapter will be able to recognize it and automatically download new public key from Keycloak. However this automatic download of new
keys is done just if you don&#8217;t have <code>realm-public-key</code> option in your adapter with the hardcoded public key. For this reason, we don&#8217;t recommend
to use <code>realm-public-key</code> option in adapter configuration anymore.</p>
</div>
<div class="paragraph">
<p>Note this option is still supported, but it may be useful just if you really want to have hardcoded public key in your adapter configuration
and never download the public key from Keycloak. In theory, one reason for this can be to avoid man-in-the-middle attack if you have untrusted network between adapter and Keycloak,
however in that case, it is much better option to use HTTPS, which will secure all the requests between adapter and Keycloak.</p>
</div>
</div>
<div class="sect3">
<h4 id="added-infinispan-cache-code-keys-code"><a class="anchor" href="#added-infinispan-cache-code-keys-code"></a>Added Infinispan cache <code>keys</code></h4>
<div class="paragraph">
<p>In this release, we added new cache <code>keys</code> to the infinispan subsystem, which is defined in <code>standalone.xml</code> or <code>standalone-ha.xml</code> configuration file.
It has also some eviction and expiration defined. This cache is internally used for caching the external public keys of the entities
trusted by the server (Identity providers or clients, which uses authentication with signed JWT).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-2-2-0"><a class="anchor" href="#migrating-to-2-2-0"></a>Migrating to 2.2.0</h3>
<div class="sect3">
<h4 id="code-databaseschema-code-property-strong-deprecated-strong"><a class="anchor" href="#code-databaseschema-code-property-strong-deprecated-strong"></a><code>databaseSchema</code> property <strong>deprecated</strong></h4>
<div class="paragraph">
<p>The <code>databaseSchema</code> property for both JPA and Mongo is now <strong>deprecated</strong> and is <strong>replaced with</strong> <code>initializeEmpty</code>
and <code>migrationStrategy</code>. <code>initializeEmpty</code> can bet set to <code>true</code> or <code>false</code> and controls if an empty database should
be initialized. <code>migrationStrategy</code> can be set to <code>update</code>, <code>validate</code> and <code>manual</code>. <code>manual</code> is only supported for
relational databases and will write an SQL file with the required changes to the database schema. Please note that
for Oracle database, the created SQL file contains <code>SET DEFINE OFF</code> command understood by Oracle SQL clients.
Should the script be consumed by any other client, please replace the lines with equivalent command of the tool of
your choice that disables variable expansion or remove it completely if such functionality is not applicable.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-in-client-s-valid-redirect-uris"><a class="anchor" href="#changes-in-client-s-valid-redirect-uris"></a>Changes in Client&#8217;s Valid Redirect URIs</h4>
<div class="paragraph">
<p>The following scenarios are affected:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When a Valid Redirect URI with query component is saved in a Client (e.g. <code>http://localhost/auth?foo=bar</code>), <code>redirect_uri</code> in authorization request must exactly match this URI (or other registered URI in this Client).</p>
</li>
<li>
<p>When a Valid Redirect URI without a query component is saved in a Client, <code>redirect_uri</code> must exactly match as well.</p>
</li>
<li>
<p>Wildcards in registered Valid Redirect URIs are no longer supported when query component is present in this URI, so the <code>redirect_uri</code> needs to exactly match this saved URI as well.</p>
</li>
<li>
<p>Fragments in registered Valid Redirect URIs (like <code>http://localhost/auth#fragment</code>) are no longer allowed.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="authenticate-by-default-removed-from-identity-providers"><a class="anchor" href="#authenticate-by-default-removed-from-identity-providers"></a>Authenticate by default removed from Identity Providers</h4>
<div class="paragraph">
<p>Identity providers no longer has an option to set it as a default authentication provider. Instead go to Authentication, select the <code>Browser</code> flow and configure the <code>Identity Provider Redirector</code>. It has an option to set the default identity provider.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-2-0-0"><a class="anchor" href="#migrating-to-2-0-0"></a>Migrating to 2.0.0</h3>
<div class="sect3">
<h4 id="upgrading-from-1-0-0-final-no-longer-supported"><a class="anchor" href="#upgrading-from-1-0-0-final-no-longer-supported"></a>Upgrading from 1.0.0.Final no longer supported</h4>
<div class="paragraph">
<p>Upgrading from 1.0.0.Final is no longer supported. To upgrade to this version upgrade to 1.9.8.Final prior to upgrading
to 2.0.0.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-1-9-5"><a class="anchor" href="#migrating-to-1-9-5"></a>Migrating to 1.9.5</h3>
<div class="sect3">
<h4 id="default-password-hashing-interval-increased-to-20k"><a class="anchor" href="#default-password-hashing-interval-increased-to-20k"></a>Default password hashing interval increased to 20K</h4>
<div class="paragraph">
<p>The default password hashing interval for new realms has been increased to 20K (from 1 previously). This change will have an impact
on performance when users authenticate. For example with the old default (1) it takes less than 1 ms to hash a password, but with
the new default (20K) the same operation can take 50-100 ms.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-1-9-3"><a class="anchor" href="#migrating-to-1-9-3"></a>Migrating to 1.9.3</h3>
<div class="sect3">
<h4 id="add-user-script-renamed"><a class="anchor" href="#add-user-script-renamed"></a>Add User script renamed</h4>
<div class="paragraph">
<p>The script to add admin users to Keycloak has been renamed to <code>add-user-keycloak</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-1-9-2"><a class="anchor" href="#migrating-to-1-9-2"></a>Migrating to 1.9.2</h3>
<div class="sect3">
<h4 id="adapter-option-auth-server-url-for-backend-requests-removed"><a class="anchor" href="#adapter-option-auth-server-url-for-backend-requests-removed"></a>Adapter option auth-server-url-for-backend-requests removed</h4>
<div class="paragraph">
<p>We&#8217;ve removed the option auth-server-url-for-backend-requests due to issues in some scenarios when it was used. In more details,
it was possible to access the Keycloak server from 2 different contexts (internal and external), which was causing issues in token validations etc.</p>
</div>
<div class="paragraph">
<p>If you still want to use the optimization of network, which this option provided (avoid the application to send backchannel requests
through loadbalancer but send them to local Keycloak server directly) you may need to handle it at hosts configuration (DNS) level.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-1-9-0"><a class="anchor" href="#migrating-to-1-9-0"></a>Migrating to 1.9.0</h3>
<div class="sect3">
<h4 id="themes-and-providers-directory-moved"><a class="anchor" href="#themes-and-providers-directory-moved"></a>Themes and providers directory moved</h4>
<div class="paragraph">
<p>We&#8217;ve moved the themes and providers directories from <code>standalone/configuration/themes</code> and <code>standalone/configuration/providers</code> to <code>themes</code> and <code>providers</code> respectively.
If you have added custom themes and providers you need to move them to the new location.
You also need to update <code>keycloak-server.json</code> as it&#8217;s changed due to this.</p>
</div>
</div>
<div class="sect3">
<h4 id="adapter-subsystems-only-bring-in-dependencies-if-keycloak-is-on"><a class="anchor" href="#adapter-subsystems-only-bring-in-dependencies-if-keycloak-is-on"></a>Adapter Subsystems only bring in dependencies if Keycloak is on</h4>
<div class="paragraph">
<p>Previously, if you had installed our SAML or OIDC Keycloak subsystem adapters into WildFly or JBoss EAP, we would automatically include Keycloak client jars into EVERY application irregardless if you were using Keycloak or not.
These libraries are now only added to your deployment if you have Keycloak authentication turned on for that adapter (via the subsystem, or auth-method in web.xml)</p>
</div>
</div>
<div class="sect3">
<h4 id="client-registration-service-endpoints-moved"><a class="anchor" href="#client-registration-service-endpoints-moved"></a>Client Registration service endpoints moved</h4>
<div class="paragraph">
<p>The Client Registration service endpoints have been moved from <code>{realm-name}/clients</code> to <code>{realm-name}/clients-registrations</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="session-state-parameter-in-authentication-response-renamed"><a class="anchor" href="#session-state-parameter-in-authentication-response-renamed"></a>Session state parameter in authentication response renamed</h4>
<div class="paragraph">
<p>In the OpenID Connect authentication response we used to return the session state as <code>session-state</code> this is not correct according to the specification and has been renamed to <code>session_state</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="deprecated-openid-connect-endpoints"><a class="anchor" href="#deprecated-openid-connect-endpoints"></a>Deprecated OpenID Connect endpoints</h4>
<div class="paragraph">
<p>In 1.2 we deprecated a number of endpoints that where not consistent with the OpenID Connect specifications, these have now been removed.
This also applies to the validate token endpoint that is replaced with the new introspect endpoint in 1.8.</p>
</div>
</div>
<div class="sect3">
<h4 id="updates-to-theme-templates"><a class="anchor" href="#updates-to-theme-templates"></a>Updates to theme templates</h4>
<div class="paragraph">
<p>Feedback in template.ftl has been moved and format has changed slightly.</p>
</div>
</div>
<div class="sect3">
<h4 id="module-and-source-code-re-org"><a class="anchor" href="#module-and-source-code-re-org"></a>Module and Source Code Re-org</h4>
<div class="paragraph">
<p>Most of our modules and source code have been consolidated into two maven modules:  keycloak-server-spi and keycloak-services.
SPI interfaces are in server-spi, implementations are in keycloak-services.
All JPA dependent modules have been consolidated under keycloak-model-jpa.
Same goes with mongo and Infinispan under modules keycloak-model-mongo and keycloak-model-infinispan.</p>
</div>
</div>
<div class="sect3">
<h4 id="for-adapters-session-id-changed-after-login"><a class="anchor" href="#for-adapters-session-id-changed-after-login"></a>For adapters, session id changed after login</h4>
<div class="paragraph">
<p>To plug a security attack vector, for platforms that support it (Tomcat 8, Undertow/WildFly, Jetty 9), the Keycloak OIDC and SAML adapters will change the session id after login.
You can turn off this behavior check adapter config switches.</p>
</div>
</div>
<div class="sect3">
<h4 id="saml-sp-client-adapter-changes"><a class="anchor" href="#saml-sp-client-adapter-changes"></a>SAML SP Client Adapter Changes</h4>
<div class="paragraph">
<p>Keycloak SAML SP Client Adapter now requires a specific endpoint, <code>/saml</code> to be registered with your IDP.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-1-8-0"><a class="anchor" href="#migrating-to-1-8-0"></a>Migrating to 1.8.0</h3>
<div class="sect3">
<h4 id="admin-account"><a class="anchor" href="#admin-account"></a>Admin account</h4>
<div class="paragraph">
<p>In previous releases we shipped with a default admin user with a default password, this has now been removed.
If you are doing a new installation of 1.8 you will have to create an admin user as a first step.</p>
</div>
</div>
<div class="sect3">
<h4 id="oauth2-token-introspection"><a class="anchor" href="#oauth2-token-introspection"></a>OAuth2 Token Introspection</h4>
<div class="paragraph">
<p>In order to add more compliance with OAuth2 specification, we added a new endpoint for token introspection.
The new endpoint can reached at <code>/realms/{realm-name}/protocols/openid-connect/token/introspect</code> and it is solely based on <code>RFC-7662</code>.</p>
</div>
<div class="paragraph">
<p>The <code>/realms/{realm-name}/protocols/openid-connect/validate</code> endpoint is now deprecated and we strongly recommend you to move to the new introspection endpoint as soon as possible.
The reason for this change is that RFC-7662 provides a more standard and secure introspection endpoint.</p>
</div>
<div class="paragraph">
<p>The new token introspection URL can now be obtained from OpenID Connect Provider&#8217;s configuration at <code>/realms/{realm-name}/.well-known/openid-configuration</code>.
There you will find a claim with name <code>token_introspection_endpoint</code> within the response.
Only <code>confidential clients</code> are allowed to invoke the new endpoint, where these clients will be usually acting as a resource server and looking for token metadata in order to perform local authorization checks.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-1-7-0-cr1"><a class="anchor" href="#migrating-to-1-7-0-cr1"></a>Migrating to 1.7.0.CR1</h3>
<div class="sect3">
<h4 id="direct-access-grants-disabled-by-default-for-clients"><a class="anchor" href="#direct-access-grants-disabled-by-default-for-clients"></a>Direct access grants disabled by default for clients</h4>
<div class="paragraph">
<p>In order to add more compliance with OpenID Connect specification, we added flags into admin console to Client Settings page, where you can enable/disable various kinds of OpenID Connect/OAuth2 flows (Standard flow, Implicit flow, Direct Access Grants, Service Accounts). As part of this, we have <code>Direct Access Grants</code> (corresponds to OAuth2 <code>Resource Owner Password Credentials Grant</code>) disabled by default for new clients.</p>
</div>
<div class="paragraph">
<p>Clients migrated from previous version have <code>Direct Access Grants</code> enabled just if they had flag <code>Direct Grants Only</code> on.
The <code>Direct Grants Only</code> flag was removed as if you enable Direct Access Grants and disable both Standard+Implicit flow, you will achieve same effect.</p>
</div>
<div class="paragraph">
<p>We also added built-in client <code>admin-cli</code> to each realm.
This client has <code>Direct Access Grants</code> enabled.
So if you&#8217;re using Admin REST API or Keycloak admin-client, you should update your configuration to use <code>admin-cli</code> instead of <code>security-admin-console</code> as the latter one doesn&#8217;t have direct access grants enabled anymore by default.</p>
</div>
</div>
<div class="sect3">
<h4 id="option-update-profile-on-first-login-moved-from-identity-provider-to-review-profile-authenticator"><a class="anchor" href="#option-update-profile-on-first-login-moved-from-identity-provider-to-review-profile-authenticator"></a>Option 'Update Profile On First Login' moved from Identity provider to Review Profile authenticator</h4>
<div class="paragraph">
<p>In this version, we added <code>First Broker Login</code>, which allows you to specify what exactly should be done when new user is logged through Identity provider (or Social provider), but no Keycloak user linked to the social account exists yet.
As part of this work, we added option <code>First Login Flow</code> to identity providers where you can specify the flow and then you can configure this flow under <code>Authentication</code> tab in admin console.</p>
</div>
<div class="paragraph">
<p>We also removed the option <code>Update Profile On First Login</code> from the Identity provider settings and moved it to the configuration of <code>Review Profile</code> authenticator.
So once you specify which flow should be used for your Identity provider (by default it&#8217;s <code>First Broker Login</code> flow), you go to <code>Authentication</code> tab, select the flow and then you configure the option under <code>Review Profile</code> authenticator.</p>
</div>
</div>
<div class="sect3">
<h4 id="element-form-error-page-in-web-xml-not-supported-anymore"><a class="anchor" href="#element-form-error-page-in-web-xml-not-supported-anymore"></a>Element 'form-error-page' in web.xml not supported anymore</h4>
<div class="paragraph">
<p>form-error-page in web.xml will no longer work for client adapter authentication errors.
You must define an error-page for the various HTTP error codes.
See documentation for more details if you want to catch and handle adapter error conditions.</p>
</div>
</div>
<div class="sect3">
<h4 id="identityprovidermapper-changes"><a class="anchor" href="#identityprovidermapper-changes"></a>IdentityProviderMapper changes</h4>
<div class="paragraph">
<p>The interface itself and method signatures did not change. However some changes in the behavior exist.
We added <code>First Broker Login</code> flow in this release and the method <code>IdentityProviderMapper.importNewUser</code> is now called after <code>First Broker Login</code> flow is finished.
So if you want to have any attribute available in <code>Review Profile</code> page, you would need to use the method <code>preprocessFederatedIdentity</code> instead of <code>importNewUser</code> . You can set any attribute by invoke <code>BrokeredIdentityContext.setUserAttribute</code> and that will be available on <code>Review profile</code> page.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-1-6-0-final"><a class="anchor" href="#migrating-to-1-6-0-final"></a>Migrating to 1.6.0.Final</h3>
<div class="sect3">
<h4 id="option-that-refresh-tokens-are-not-reusable-anymore"><a class="anchor" href="#option-that-refresh-tokens-are-not-reusable-anymore"></a>Option that refresh tokens are not reusable anymore</h4>
<div class="paragraph">
<p>Old versions of Keycloak allowed reusing refresh tokens multiple times.
Keycloak still permits this, but also have an option <code>Revoke refresh token</code> to disallow it.
Option is under token settings in admin console.
When a refresh token is used to obtain a new access token a new refresh token is also included.
When option is enabled, then this new refresh token should be used next time the access token is refreshed.
It won&#8217;t be possible to reuse old refresh token multiple times.</p>
</div>
</div>
<div class="sect3">
<h4 id="some-packages-renamed"><a class="anchor" href="#some-packages-renamed"></a>Some packages renamed</h4>
<div class="paragraph">
<p>We did a bit of restructure and renamed some packages.
It is mainly about renaming internal packages of util classes.
The most important classes used in your application ( for example AccessToken or KeycloakSecurityContext ) as well as the SPI are still unchanged.
However, a slight chance exists that you will be affected and will need to update imports of your classes.
For example if you are using multitenancy and KeycloakConfigResolver, you will be affected as for example class HttpFacade was moved to different package - it is <code>org.keycloak.adapters.spi.HttpFacade</code> now.</p>
</div>
</div>
<div class="sect3">
<h4 id="persisting-user-sessions"><a class="anchor" href="#persisting-user-sessions"></a>Persisting user sessions</h4>
<div class="paragraph">
<p>We added support for offline tokens in this release, which means that we are persisting "offline" user sessions into database now.
If you are not using offline tokens, nothing will be persisted for you, so you don&#8217;t need to care about worse performance for more DB writes.
However in all cases, you will need to update <code>standalone/configuration/keycloak-server.json</code> and add <code>userSessionPersister</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="key"><span class="delimiter">&quot;</span><span class="content">userSessionPersister</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">provider</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">jpa</span><span class="delimiter">&quot;</span></span>
},</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want sessions to be persisted in Mongo instead of classic RDBMS, use provider <code>mongo</code> instead.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-1-5-0-final"><a class="anchor" href="#migrating-to-1-5-0-final"></a>Migrating to 1.5.0.Final</h3>
<div class="sect3">
<h4 id="realm-and-user-cache-providers"><a class="anchor" href="#realm-and-user-cache-providers"></a>Realm and User cache providers</h4>
<div class="paragraph">
<p>Infinispan is now the default and only realm and user cache providers.
In non-clustered mode a local Infinispan cache is used.
We&#8217;ve also removed our custom in-memory cache and the no cache providers.
If you have realmCache or userCache set in keycloak-server.json to mem or none please remove these.
As Infinispan is the only provider the realmCache and userCache objects are no longer needed and can be removed.</p>
</div>
</div>
<div class="sect3">
<h4 id="uses-session-providers"><a class="anchor" href="#uses-session-providers"></a>Uses Session providers</h4>
<div class="paragraph">
<p>Infinispan is now the default and only user session provider.
In non-clustered mode a local Infinispan cache is used.
We&#8217;ve also removed the JPA and Mongo user session providers.
If you have userSession set in keycloak-server.json to mem, jpa or mongo please remove it.
As Infinispan is the only provider the userSession object is no longer needed and can be removed.</p>
</div>
<div class="paragraph">
<p>For anyone that wants to achieve increased durability of user sessions this can be achieved by configuring the user session cache with more than one owner or use a replicated cache.
It&#8217;s also possible to configure Infinispan to persist caches, although that would have impacts on performance.</p>
</div>
</div>
<div class="sect3">
<h4 id="contact-details-removed-from-registration-and-account-management"><a class="anchor" href="#contact-details-removed-from-registration-and-account-management"></a>Contact details removed from registration and account management</h4>
<div class="paragraph">
<p>In the default theme we have now removed the contact details from the registration page and account management.
The admin console now lists all the users attributes, not just contact specific attributes.
The admin console also has the ability to add/remove attributes to a user.
If you want to add contact details, please refer to the address theme included in the examples.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-1-3-0-final"><a class="anchor" href="#migrating-to-1-3-0-final"></a>Migrating to 1.3.0.Final</h3>
<div class="sect3">
<h4 id="direct-grant-api-always-enabled"><a class="anchor" href="#direct-grant-api-always-enabled"></a>Direct Grant API always enabled</h4>
<div class="paragraph">
<p>In the past Direct Grant API (or Resource Owner Password Credentials) was disabled by default and an option to enable it on a realm existed.
The Direct Grant API is now always enabled and the option to enable/disable for a realm is removed.</p>
</div>
</div>
<div class="sect3">
<h4 id="database-changed"><a class="anchor" href="#database-changed"></a>Database changed</h4>
<div class="paragraph">
<p>There are again few database changes.
Remember to backup your database prior to upgrading.</p>
</div>
</div>
<div class="sect3">
<h4 id="userfederationprovider-changed"><a class="anchor" href="#userfederationprovider-changed"></a>UserFederationProvider changed</h4>
<div class="paragraph">
<p>There are few minor changes in UserFederationProvider interface.
You may need to sync your implementation when upgrade to newer version and upgrade few methods, which has changed signature.
Changes are really minor, but were needed to improve performance of federation.</p>
</div>
</div>
<div class="sect3">
<h4 id="wildfly-9-0-0-final"><a class="anchor" href="#wildfly-9-0-0-final"></a>WildFly 9.0.0.Final</h4>
<div class="paragraph">
<p>Following on from the distribution changes that was done in the last release the standalone download of Keycloak is now based on WildFly 9.0.0.Final.
This also affects the overlay which can only be deployed to WildFly 9.0.0.Final or JBoss EAP 6.4.0.GA.
WildFly 8.2.0.Final is no longer supported for the server.</p>
</div>
</div>
<div class="sect3">
<h4 id="wildfly-jboss-eap-and-jboss-as7-adapters"><a class="anchor" href="#wildfly-jboss-eap-and-jboss-as7-adapters"></a>WildFly, JBoss EAP and JBoss AS7 adapters</h4>
<div class="paragraph">
<p>There are now 3 separate adapter downloads for WildFly, JBoss EAP and JBoss AS7:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>eap6</p>
</li>
<li>
<p>wf9</p>
</li>
<li>
<p>wf8</p>
</li>
<li>
<p>as7</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Make sure you grab the correct one.</p>
</div>
<div class="paragraph">
<p>You also need to update standalone.xml as the extension module and subsystem definition has changed.
See <a href="https://www.keycloak.org/docs/15.0/securing_apps/">Securing Applications and Services Guide</a> for details.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-from-1-2-0-beta1-to-1-2-0-rc1"><a class="anchor" href="#migrating-from-1-2-0-beta1-to-1-2-0-rc1"></a>Migrating from 1.2.0.Beta1 to 1.2.0.RC1</h3>
<div class="sect3">
<h4 id="distribution-changes"><a class="anchor" href="#distribution-changes"></a>Distribution changes</h4>
<div class="paragraph">
<p>Keycloak is now available in 3 downloads: standalone, overlay and demo bundle.
The standalone is intended for production and non-JEE developers.
Overlay is aimed at adding Keycloak to an existing WildFly 8.2 or EAP 6.4 installation and is mainly for development.
Finally we have a demo (or dev) bundle that is aimed at developers getting started with Keycloak.
This bundle contains a WildFly server, with Keycloak server and adapter included.
It also contains all documentation and examples.</p>
</div>
</div>
<div class="sect3">
<h4 id="database-changed-2"><a class="anchor" href="#database-changed-2"></a>Database changed</h4>
<div class="paragraph">
<p>This release contains again a number of changes to the database.
The biggest one is Application and OAuth client merge.
Remember to backup your database prior to upgrading.</p>
</div>
</div>
<div class="sect3">
<h4 id="application-and-oauth-client-merge"><a class="anchor" href="#application-and-oauth-client-merge"></a>Application and OAuth client merge</h4>
<div class="paragraph">
<p>Application and OAuth clients are now merged into <code>Clients</code>.
The UI of admin console is updated and database as well.
Your data from database should be automatically updated.
The previously set Applications will be converted into Clients with <code>Consent required</code> switch off and OAuth Clients will be converted into Clients with this switch on.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-from-1-1-0-final-to-1-2-0-beta1"><a class="anchor" href="#migrating-from-1-1-0-final-to-1-2-0-beta1"></a>Migrating from 1.1.0.Final to 1.2.0.Beta1</h3>
<div class="sect3">
<h4 id="database-changed-3"><a class="anchor" href="#database-changed-3"></a>Database changed</h4>
<div class="paragraph">
<p>This release contains a number of changes to the database.
Remember to backup your database prior to upgrading.</p>
</div>
</div>
<div class="sect3">
<h4 id="code-iss-code-in-access-and-id-tokens"><a class="anchor" href="#code-iss-code-in-access-and-id-tokens"></a><code>iss</code> in access and id tokens</h4>
<div class="paragraph">
<p>The value of <code>iss</code> claim in access and id tokens have changed from <code>realm name</code> to <code>realm url</code>.
This is required by OpenID Connect specification.
If you&#8217;re using our adapters no change is required, except if you&#8217;ve been using bearer-only without specifying the <code>auth-server-url</code>, you have to add it now.
If you&#8217;re using another library (or RSATokenVerifier) you need to make the corresponding changes when verifying <code>iss</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="openid-connect-endpoints"><a class="anchor" href="#openid-connect-endpoints"></a>OpenID Connect endpoints</h4>
<div class="paragraph">
<p>To comply with OpenID Connect specification the authentication and token endpoints have been changed to having a single authentication endpoint and a single token endpoint.
As per-spec <code>response_type</code> and <code>grant_type</code> parameters are used to select the required flow.
The old endpoints (<code>/realms/{realm-name}/protocols/openid-connect/login</code>, <code>/realms/{realm-name}/protocols/openid-connect/grants/access</code>, <code>/realms/{realm-name}/protocols/openid-connect/refresh</code>, <code>/realms/{realm-name}/protocols/openid-connect/access/codes</code>) are now deprecated and will be removed in a future version.</p>
</div>
</div>
<div class="sect3">
<h4 id="theme-changes"><a class="anchor" href="#theme-changes"></a>Theme changes</h4>
<div class="paragraph">
<p>The layout of themes has changed.
The directory hierarchy used to be <code>type/name</code> this is now changed to <code>name/type</code>.
For example a login theme named <code>sunrise</code> used to be deployed to <code>standalone/configuration/themes/login/sunrise</code>, which is now moved to <code>standalone/configuration/themes/sunrise/login</code>.
This change was done to make it easier to have groups of the different types for the same theme into one folder.</p>
</div>
<div class="paragraph">
<p>If you deployed themes as a JAR in the past you had to create a custom theme loader which required Java code.
This has been simplified to only requiring a plain text file (<code>META-INF/keycloak-themes.json</code>) to describe the themes included in a JAR.</p>
</div>
</div>
<div class="sect3">
<h4 id="claims-changes"><a class="anchor" href="#claims-changes"></a>Claims changes</h4>
<div class="paragraph">
<p>Previously a dedicated <code>Claims</code> tab existed in the admin console for application and OAuth clients.
This was used to configure which attributes should go into access token for particular application/client.
This was removed and is replaced with protocol mappers which are more flexible.</p>
</div>
<div class="paragraph">
<p>You don&#8217;t need to care about migration of database from previous version.
We did migration scripts for both RDBMS and Mongo, which should ensure that claims configured for particular application/client will be converted into corresponding protocol mappers (Still it&#8217;s safer to backup DB before migrating to newer version though). Same applies for exported JSON representation from previous version.</p>
</div>
</div>
<div class="sect3">
<h4 id="social-migration-to-identity-brokering"><a class="anchor" href="#social-migration-to-identity-brokering"></a>Social migration to identity brokering</h4>
<div class="paragraph">
<p>We refactored social providers SPI and replaced it with Identity Brokering SPI, which is more flexible.
The <code>Social</code> tab in admin console is renamed to <code>Identity Provider</code> tab.</p>
</div>
<div class="paragraph">
<p>Again you don&#8217;t need to care about migration of database from previous version similarly like for Claims/protocol mappers.
Both configuration of social providers and "social links" to your users will be converted to corresponding Identity providers.</p>
</div>
<div class="paragraph">
<p>Only required action from you would be to change allowed <code>Redirect URI</code> in the admin console of particular 3rd party social providers.
You can first go to the Keycloak admin console and copy Redirect URI from the page where you configure the identity provider.
Then you can simply paste this as allowed Redirect URI to the admin console of 3rd party provider (IE.
Facebook admin console).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-from-1-1-0-beta1-to-1-1-0-beta2"><a class="anchor" href="#migrating-from-1-1-0-beta1-to-1-1-0-beta2"></a>Migrating from 1.1.0.Beta1 to 1.1.0.Beta2</h3>
<div class="ulist">
<ul>
<li>
<p>Adapters are now a separate download.  They are not included in appliance and war distribution.  We have too many now and the distro
is getting bloated.</p>
</li>
<li>
<p><code>org.keycloak.adapters.tomcat7.KeycloakAuthenticatorValve</code>
+<code>org.keycloak.adapters.tomcat.KeycloakAuthenticatorValve</code></p>
</li>
<li>
<p>JavaScript adapter now has idToken and idTokenParsed properties. If you use idToken to retrieve first name, email, etc. you need to change this to idTokenParsed.</p>
</li>
<li>
<p>The as7-eap-subsystem and keycloak-wildfly-subsystem have been merged into one keycloak-subsystem.  If you have an existing standalone.xml
or domain.xml, you will need edit near the top of the file and change the extension module name to org.keycloak.keycloak-subsystem.
For AS7 only, the extension module name is org.keycloak.keycloak-as7-subsystem.</p>
</li>
<li>
<p>Server installation is no longer supported on AS7.  You can still use AS7 as an application client.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="migrating-from-1-0-x-final-to-1-1-0-beta1"><a class="anchor" href="#migrating-from-1-0-x-final-to-1-1-0-beta1"></a>Migrating from 1.0.x.Final to 1.1.0.Beta1</h3>
<div class="ulist">
<ul>
<li>
<p>RealmModel JPA and Mongo storage schema has changed</p>
</li>
<li>
<p>UserSessionModel JPA and Mongo storage schema has changed as these interfaces have been refactored</p>
</li>
<li>
<p>Upgrade your adapters, old adapters are not compatible with Keycloak 1.1.  We interpreted JSON Web Token and OIDC ID Token specification incorrectly.  'aud'
claim must be the client id, we were storing the realm name in there and validating it.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="migrating-from-1-0-rc-1-to-rc-2"><a class="anchor" href="#migrating-from-1-0-rc-1-to-rc-2"></a>Migrating from 1.0 RC-1 to RC-2</h3>
<div class="ulist">
<ul>
<li>
<p>A lot of info level logging has been changed to debug. Also, a realm no longer has the jboss-logging audit listener by default.
If you want log output when users login, logout, change passwords, etc. enable the jboss-logging audit listener through the admin console.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="migrating-from-1-0-beta-4-to-rc-1"><a class="anchor" href="#migrating-from-1-0-beta-4-to-rc-1"></a>Migrating from 1.0 Beta 4 to RC-1</h3>
<div class="ulist">
<ul>
<li>
<p>logout REST API has been refactored.  The GET request on the logout URI does not take a session_state
parameter anymore.  You must be logged in in order to log out the session.
You can also POST to the logout REST URI.  This action requires a valid refresh token to perform the logout.
The signature is the same as refresh token minus the grant type form parameter.  See documentation for details.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="migrating-from-1-0-beta-1-to-beta-4"><a class="anchor" href="#migrating-from-1-0-beta-1-to-beta-4"></a>Migrating from 1.0 Beta 1 to Beta 4</h3>
<div class="ulist">
<ul>
<li>
<p>LDAP/AD configuration is changed.  It is no longer under the "Settings" page.  It is now under
Users&#8594;Federation.  Add Provider will show you an "ldap" option.</p>
</li>
<li>
<p>Authentication SPI has been removed and rewritten.  The new SPI is UserFederationProvider and is
more flexible.</p>
</li>
<li>
<p><code>ssl-not-required</code>
+<code>ssl-required</code>
+<code>all</code>
+<code>external</code>
+<code>none</code></p>
</li>
<li>
<p>DB Schema has changed again.</p>
</li>
<li>
<p>Created applications now have a full scope by default.  This means that you don&#8217;t have to configure
the scope of an application if you don&#8217;t want to.</p>
</li>
<li>
<p>Format of JSON file for importing realm data was changed. Now role mappings is available under the JSON record of particular
user.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="migrating-from-1-0-alpha-4-to-beta-1"><a class="anchor" href="#migrating-from-1-0-alpha-4-to-beta-1"></a>Migrating from 1.0 Alpha 4 to Beta 1</h3>
<div class="ulist">
<ul>
<li>
<p>DB Schema has changed.  We have added export of the database to Beta 1, but not the ability to import
the database from older versions. This will be supported in future releases.</p>
</li>
<li>
<p>For all clients except bearer-only applications, you must specify at least one redirect URI.  Keycloak
will not allow you to log in unless you have specified a valid redirect URI for that application.</p>
</li>
<li>
<p>Direct Grant API
+<code>ON</code></p>
</li>
<li>
<p>standalone/configuration/keycloak-server.json</p>
</li>
<li>
<p>JavaScript adapter</p>
</li>
<li>
<p>Session Timeout</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="migrating-from-1-0-alpha-2-to-alpha-3"><a class="anchor" href="#migrating-from-1-0-alpha-2-to-alpha-3"></a>Migrating from 1.0 Alpha 2 to Alpha 3</h3>
<div class="ulist">
<ul>
<li>
<p>SkeletonKeyToken, SkeletonKeyScope, SkeletonKeyPrincipal, and SkeletonKeySession have been renamed to:
AccessToken, AccessScope, KeycloakPrincipal, and KeycloakAuthenticatedSession respectively.</p>
</li>
<li>
<p>ServletOAuthClient.getBearerToken() method signature has changed.  It now returns an AccessTokenResponse
so that you can obtain a refresh token too.</p>
</li>
<li>
<p>Adapters now check the access token expiration with every request.  If the token is expired, they will
attempt to invoke a refresh on the auth server using a saved refresh token.</p>
</li>
<li>
<p>Subject in AccessToken has been changed to the User ID.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="migrating-from-1-0-alpha-1-to-alpha-2"><a class="anchor" href="#migrating-from-1-0-alpha-1-to-alpha-2"></a>Migrating from 1.0 Alpha 1 to Alpha 2</h3>
<div class="ulist">
<ul>
<li>
<p>DB Schema has changed.  We don&#8217;t have any data migration utilities yet as of Alpha 2.</p>
</li>
<li>
<p>JBoss and WildFly adapters are now installed via a WildFly subsystem.  Please review the adapter
installation documentation.  Edits to standalone.xml are now required.</p>
</li>
<li>
<p>A new credential type "secret" got introduced. Unlike other credential types, it is stored in plain text in
the database and can be viewed in the admin console.</p>
</li>
<li>
<p>Application and OAuth Client credentials are no longer required. These client types are now
hard coded to use the "secret" credential type.</p>
</li>
<li>
<p>Because of the "secret" credential change to Application and OAuth Client, you&#8217;ll have to update
your keycloak.json configuration files and regenerate a secret within the Application or OAuth Client
credentials tab in the administration console.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-08-20 08:43:24 UTC
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.js"></script>

<script>
    var oldtoc = document.getElementById('toctitle').nextElementSibling;
    var newtoc = document.createElement('div');
    newtoc.setAttribute('id', 'tocbot');
    newtoc.setAttribute('class', 'js-toc');
    oldtoc.parentNode.replaceChild(newtoc, oldtoc);
    tocbot.init({ contentSelector: '#content',
        headingSelector: 'h2, h3, h4',
        smoothScroll: false
    });
    var handleTocOnResize = function() {
        var width = window.innerWidth
                    || document.documentElement.clientWidth
                    || document.body.clientWidth;
        if (width < 768) {
            tocbot.refresh({
                contentSelector: '#content',
                headingSelector: 'h2, h3, h4',
                collapseDepth: 6,
                activeLinkClass: 'ignoreactive',
                throttleTimeout: 1000,
                smoothScroll: false
            });
        }
        else {
            tocbot.refresh({
                contentSelector: '#content',
                headingSelector: 'h2, h3, h4',
                smoothScroll: false
            });
        }
    };
    window.addEventListener('resize', handleTocOnResize);
    handleTocOnResize();
</script>
</body>
</html>