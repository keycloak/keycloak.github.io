<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<title>Authorization Services Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<style>
/* Top menu */

@media only screen and (min-width: 768px) {
       div.top-menu-guides {
              position: fixed;
              display: inline-block;
              top: 0;
              left: 0;
              z-index: 9999;
       }

       div.top-menu-guides p {
              margin: 0;
              padding: 0;
       }

       div.top-menu-guides .content {
              margin: 0;
              padding: 7px 20px 0 20px;
              background-color: #ededed;
              height: 48px;
              width: 20em;
       }

       @media only screen and (max-width: 1280px) {
              div.top-menu-guides .content {
                     width: 15em;
              }
       }

       div.top-menu-guides .ulist {
              display: none;
              position: absolute;
              background-color: #f9f9f9;
              min-width: 160px;
              box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
              padding: 0px;
              margin-top: 12px;
       }

       div.top-menu-guides .ulist ul {
              list-style: none;
              padding: 5px;
              margin: 0;
       }

       div.top-menu-guides .ulist li {
              padding: 5px 10px;
       }

       div.top-menu-guides:hover .ulist {
           display: block;
       }

       div.top-menu-version {
           position: fixed;
           top: 0;
           z-index: 9999;
       }

       div.top-menu-version .content {
           padding: 0;
           margin: 0;
           background-color: #eee;
           height: 48px;
           padding: 7px;
       }

        div.top-menu-version p {
            margin: 0;
            padding: 2px 5px 2px 10px;
        }

}

/* TOC */

#tocbot a.toc-link.node-name--H1{ font-style: italic }
@media screen{
#tocbot > ul.toc-list{ margin-bottom: 0.5em; margin-left: 0.125em }
#tocbot ul.sectlevel0, #tocbot a.toc-link.node-name--H1 + ul{
  padding-left: 0 }
#tocbot a.toc-link{ height:100% }
.is-collapsible{ max-height:3000px; overflow:hidden; }
.is-collapsed{ max-height:0 }
.is-active-link{ font-weight:700 }
}
@media print{
#tocbot a.toc-link.node-name--H4{ display:none }
}

/* Fix scroll to anchor hides title */
h1::before, h2::before, h3::before, h4::before, h5::before, h6::before {
    display: block;
    content: " ";
    height: 70px;
    margin-top: -70px;
}

h1 {
    border-bottom: none !important
}

#toc.toc2 {
    top: 30px;
    bottom: 0px;
    height: unset;
}

body.toc2 {
    padding-top: 30px;
}

@media only screen and (min-width:768px) {
    #toc.toc2 {
        top: 40px;
    }

    body.toc2 {
        padding-top: 40px;
    }
}

@media only screen and (min-width:1280px) {
    #toc.toc2 {
        top: 48px;
    }

    body.toc2 {
        padding-top: 48px;
    }
}


/* General Changes */

h1, h2, h3, #toctitle, .sidebarblock>.content>.title, h4, h5, h6 {
    color: #444444;
    font-weight: 500;
}

a {
    color: #004670;
    text-decoration: none;
}

a:hover {
    color: #7da1dc;
}

body {
    font-family: "Open Sans","DejaVu Sans",sans-serif;
    color: #444444;
}

.subheader, .admonitionblock td.content>.title, .audioblock>.title, .exampleblock>.title, .imageblock>.title, .listingblock>.title, .literalblock>.title, .stemblock>.title, .openblock>.title, .paragraph>.title, .quoteblock>.title, table.tableblock>.title, .verseblock>.title, .videoblock>.title, .dlist>.title, .olist>.title, .ulist>.title, .qlist>.title, .hdlist>.title {
    color: #444444;
}

.admonitionblock td.content>.title, .audioblock>.title, .exampleblock>.title, .imageblock>.title, .listingblock>.title, .literalblock>.title, .stemblock>.title, .openblock>.title, .paragraph>.title, .quoteblock>.title, table.tableblock>.title, .verseblock>.title, .videoblock>.title, .dlist>.title, .olist>.title, .ulist>.title, .qlist>.title, .hdlist>.title {
    font-family: "Open Sans","DejaVu Sans",sans-serif;
    font-style: normal;
}

span.image img {
    border:1px solid #ccc;
    -webkit-box-shadow: 3px 3px 15px 0px rgba(0,0,0,0.5);
    -moz-box-shadow: 3px 3px 15px 0px rgba(0,0,0,0.5);
    box-shadow: 3px 3px 15px 0px rgba(0,0,0,0.5);
}

.sect1+.sect1 {
    border-top: none;
}

.page-links {
    border-bottom: 1px solid #efefed;
    border-top: none;
    background: none;
    position: relative;
    left: 0em;
    width: 100%;
    top: -5em;
    height: 0;
    margin: 0;
    padding: 0;
}

.sect2 .page-links {
    top: -3.5em;
}

.page-links .content {
    background: #f8f8f7;
    border: 1px solid #e0e0dc;
    float: right;
    font-size: 0.8em;
    margin: 0;
    padding: 5px;
}

.page-links a {
    display: block;
    padding: 5px;
}
</style>

</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Authorization Services Guide</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_overview">Authorization services overview</a>
<ul class="sectlevel2">
<li><a href="#_overview_architecture">Architecture</a>
<ul class="sectlevel3">
<li><a href="#the-authorization-process">The authorization process</a></li>
<li><a href="#authorization-services">Authorization services</a></li>
</ul>
</li>
<li><a href="#_overview_terminology">Terminology</a>
<ul class="sectlevel3">
<li><a href="#_overview_terminology_resource_server">Resource Server</a></li>
<li><a href="#resource">Resource</a></li>
<li><a href="#scope">Scope</a></li>
<li><a href="#permission">Permission</a></li>
<li><a href="#policy">Policy</a></li>
<li><a href="#policy-provider">Policy provider</a></li>
<li><a href="#_overview_terminology_permission_ticket">Permission ticket</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_getting_started_overview">Getting Started</a></li>
<li><a href="#_resource_server_overview">Managing resource servers</a>
<ul class="sectlevel2">
<li><a href="#_resource_server_create_client">Creating a client application</a></li>
<li><a href="#_resource_server_enable_authorization">Enabling authorization services</a>
<ul class="sectlevel3">
<li><a href="#resource_server_settings">Resource server settings</a></li>
</ul>
</li>
<li><a href="#_resource_server_default_config">Default Configuration</a>
<ul class="sectlevel3">
<li><a href="#changing-the-default-configuration">Changing the default configuration</a></li>
</ul>
</li>
<li><a href="#_resource_server_import_config">Export and import authorization configuration</a>
<ul class="sectlevel3">
<li><a href="#exporting-a-configuration-file">Exporting a configuration file</a></li>
<li><a href="#importing-a-configuration-file">Importing a configuration file</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_resource_overview">Managing resources and scopes</a>
<ul class="sectlevel2">
<li><a href="#_resource_view">Viewing resources</a></li>
<li><a href="#_resource_create">Creating resources</a>
<ul class="sectlevel3">
<li><a href="#resource-attributes">Resource attributes</a></li>
<li><a href="#typed-resources">Typed resources</a></li>
<li><a href="#resource-owners">Resource owners</a></li>
<li><a href="#managing-resources-remotely">Managing resources remotely</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_policy_overview">Managing policies</a>
<ul class="sectlevel2">
<li><a href="#_policy_user">User-based policy</a>
<ul class="sectlevel3">
<li><a href="#configuration">Configuration</a></li>
</ul>
</li>
<li><a href="#_policy_rbac">Role-based policy</a>
<ul class="sectlevel3">
<li><a href="#configuration-2">Configuration</a></li>
<li><a href="#_policy_rbac_required">Defining a role as required</a></li>
</ul>
</li>
<li><a href="#_policy_js">JavaScript-based policy</a>
<ul class="sectlevel3">
<li><a href="#creating-a-js-policy-from-a-deployed-jar-file">Creating a JS policy from a deployed JAR file</a></li>
<li><a href="#examples">Examples</a></li>
</ul>
</li>
<li><a href="#_policy_time">Time-based policy</a>
<ul class="sectlevel3">
<li><a href="#configuration-3">Configuration</a></li>
</ul>
</li>
<li><a href="#_policy_aggregated">Aggregated policy</a>
<ul class="sectlevel3">
<li><a href="#configuration-4">Configuration</a></li>
<li><a href="#decision-strategy-for-aggregated-policies">Decision strategy for aggregated policies</a></li>
</ul>
</li>
<li><a href="#_policy_client">Client-based policy</a>
<ul class="sectlevel3">
<li><a href="#configuration-5">Configuration</a></li>
</ul>
</li>
<li><a href="#_policy_group">Group-based policy</a>
<ul class="sectlevel3">
<li><a href="#configuration-6">Configuration</a></li>
<li><a href="#_policy_group_extend_access_children">Extending access to child groups</a></li>
</ul>
</li>
<li><a href="#_policy_client_scope">Client scope-based policy</a>
<ul class="sectlevel3">
<li><a href="#configuration-7">Configuration</a></li>
<li><a href="#_policy_client_scope_required">Defining a client scope as required</a></li>
</ul>
</li>
<li><a href="#_policy_regex">Regex-Based Policy</a>
<ul class="sectlevel3">
<li><a href="#configuration-8">Configuration</a></li>
</ul>
</li>
<li><a href="#_policy_logic">Positive and negative logic</a></li>
<li><a href="#_policy_evaluation_api">Policy evaluation API</a>
<ul class="sectlevel3">
<li><a href="#the-evaluation-context">The evaluation context</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_permission_overview">Managing permissions</a>
<ul class="sectlevel2">
<li><a href="#_permission_create_resource">Creating resource-based permission</a>
<ul class="sectlevel3">
<li><a href="#configuration-9">Configuration</a></li>
<li><a href="#_permission_typed_resource">Typed resource permission</a></li>
</ul>
</li>
<li><a href="#_permission_create_scope">Creating scope-based permissions</a>
<ul class="sectlevel3">
<li><a href="#configuration-10">Configuration</a></li>
</ul>
</li>
<li><a href="#_permission_decision_strategies">Policy decision strategies</a></li>
</ul>
</li>
<li><a href="#_policy_evaluation_overview">Evaluating and testing policies</a>
<ul class="sectlevel2">
<li><a href="#providing-identity-information">Providing identity information</a></li>
<li><a href="#providing-contextual-information">Providing contextual information</a></li>
<li><a href="#providing-the-permissions">Providing the permissions</a></li>
</ul>
</li>
<li><a href="#_service_overview">Authorization services</a>
<ul class="sectlevel2">
<li><a href="#_service_authorization_api">Discovering authorization services endpoints and metadata</a></li>
<li><a href="#_service_obtaining_permissions">Obtaining permissions</a>
<ul class="sectlevel3">
<li><a href="#_authentication_methods">Client authentication methods</a></li>
<li><a href="#_service_pushing_claims">Pushing claims</a></li>
</ul>
</li>
<li><a href="#_service_user_managed_access">User-managed access</a>
<ul class="sectlevel3">
<li><a href="#_service_uma_authorization_process">Authorization process</a></li>
<li><a href="#_service_authorization_aat">Submitting permission requests</a></li>
<li><a href="#_service_authorization_my_resources">Managing access to users resources</a></li>
</ul>
</li>
<li><a href="#_service_protection_api">Protection API</a>
<ul class="sectlevel3">
<li><a href="#_service_protection_whatis_obtain_pat">What is a PAT and how to obtain it</a></li>
<li><a href="#_service_protection_resources_api">Managing resources</a></li>
<li><a href="#_service_protection_permission_api_papi">Managing permission requests</a></li>
<li><a href="#_service_authorization_uma_policy_api">Managing resource permissions using the Policy API</a></li>
</ul>
</li>
<li><a href="#_service_rpt_overview">Requesting party token</a>
<ul class="sectlevel3">
<li><a href="#_service_protection_token_introspection">Introspecting a requesting party token</a></li>
<li><a href="#obtaining-information-about-an-rpt">Obtaining Information about an RPT</a></li>
<li><a href="#do-i-need-to-invoke-the-server-every-time-i-want-to-introspect-an-rpt">Do I need to invoke the server every time I want to introspect an RPT?</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_enforcer_js_adapter">JavaScript integration for Policy Enforcer</a>
<ul class="sectlevel2">
<li><a href="#handling-authorization-responses-from-a-uma-protected-resource-server">Handling authorization responses from a UMA-Protected resource server</a></li>
<li><a href="#obtaining-entitlements">Obtaining entitlements</a></li>
<li><a href="#authorization-request">Authorization request</a></li>
<li><a href="#obtaining-the-rpt">Obtaining the RPT</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="exampleblock top-menu-guides">
<div class="content">
<div class="paragraph">
<p><strong>Authorization Services</strong> <span class="icon"><i class="fa fa-angle-down"></i></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.keycloak.org/guides#getting-started">Getting Started</a></p>
</li>
<li>
<p><a href="https://www.keycloak.org/guides#securing-apps">Securing applications</a></p>
</li>
<li>
<p><a href="https://www.keycloak.org/docs/DEV/server_admin/">Server Administration</a></p>
</li>
<li>
<p><a href="https://www.keycloak.org/docs/DEV/server_development/">Server Developer</a></p>
</li>
<li>
<p><a href="https://www.keycloak.org/docs/DEV/upgrading/">Upgrading</a></p>
</li>
<li>
<p><a href="https://www.keycloak.org/docs/DEV/release_notes/">Release Notes</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="exampleblock top-menu-version">
<div class="content">
<div class="paragraph">
<p>Version <strong>DEV</strong></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>Authorization services overview</h2>
<div class="sectionbody">
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/auth-services-overview.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/auth-services-overview.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/auth-services-overview.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>Keycloak supports fine-grained authorization policies and is able to combine different access control
mechanisms such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Attribute-based access control (ABAC)</strong></p>
</li>
<li>
<p><strong>Role-based access control (RBAC)</strong></p>
</li>
<li>
<p><strong>User-based access control (UBAC)</strong></p>
</li>
<li>
<p><strong>Context-based access control (CBAC)</strong></p>
</li>
<li>
<p><strong>Rule-based access control</strong></p>
<div class="ulist">
<ul>
<li>
<p>Using JavaScript</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Time-based access control</strong></p>
</li>
<li>
<p><strong>Support for custom access control mechanisms (ACMs) through a Service Provider Interface (SPI)</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Keycloak is based on a set of administrative UIs and a RESTful API, and provides the necessary means to create permissions
for your protected resources and scopes, associate those permissions with authorization policies, and enforce authorization decisions in your applications and services.</p>
</div>
<div class="paragraph">
<p>Resource servers (applications or services serving protected resources) usually rely on some kind of information to decide if access should be granted to a protected resource. For RESTful-based resource servers, that information is usually obtained from a security token, usually sent as a bearer token on every request to the server. For web applications that rely on a session to authenticate users, that information is usually stored in a user&#8217;s session and retrieved from there for each request.</p>
</div>
<div class="paragraph">
<p>Frequently, resource servers only perform authorization decisions based on role-based access control (RBAC), where the roles granted to the user trying to access protected resources are checked against the roles mapped to these same resources. While roles are very useful and used by applications, they also have a few limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Resources and roles are tightly coupled and changes to roles (such as adding, removing, or changing an access context) can impact multiple resources</p>
</li>
<li>
<p>Changes to your security requirements can imply deep changes to application code to reflect these changes</p>
</li>
<li>
<p>Depending on your application size, role management might become difficult and error-prone</p>
</li>
<li>
<p>It is not the most flexible access control mechanism. Roles do not represent who you are and lack contextual information. If you have been granted a role, you have at least some access.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Considering that today we need to consider heterogeneous environments where users are distributed across different regions, with different local policies,
using different devices, and with a high demand for information sharing, Keycloak Authorization Services can help you improve the authorization capabilities of your applications and services by providing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Resource protection using fine-grained authorization policies and different access control mechanisms</p>
</li>
<li>
<p>Centralized Resource, Permission, and Policy Management</p>
</li>
<li>
<p>Centralized Policy Decision Point</p>
</li>
<li>
<p>REST security based on a set of REST-based authorization services</p>
</li>
<li>
<p>Authorization workflows and User-Managed Access</p>
</li>
<li>
<p>The infrastructure to help avoid code replication across projects (and redeploys) and quickly adapt to changes in your security requirements.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_overview_architecture"><a class="anchor" href="#_overview_architecture"></a>Architecture</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/auth-services-architecture.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/auth-services-architecture.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/auth-services-architecture.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/authz-arch-overview.png" alt="Keycloak AuthZ architecture overview"></span></p>
</div>
<div class="paragraph">
<p>From a design perspective, Authorization Services is based on a well-defined set of authorization patterns providing these capabilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Policy Administration Point (PAP)</strong></p>
<div class="paragraph">
<p>Provides a set of UIs based on the Keycloak Administration Console to manage resource servers, resources, scopes, permissions, and policies.
Part of this is also accomplished remotely through the use of the <a href="#_service_protection_api">Protection API</a>.</p>
</div>
</li>
<li>
<p><strong>Policy Decision Point (PDP)</strong></p>
<div class="paragraph">
<p>Provides a distributable policy decision point to where authorization requests are sent and policies are evaluated accordingly with the permissions being requested.
For more information, see <a href="#_service_obtaining_permissions">Obtaining Permissions</a>.</p>
</div>
</li>
<li>
<p><strong>Policy Enforcement Point (PEP)</strong></p>
<div class="paragraph">
<p>Provides implementations for different environments to actually enforce authorization decisions at the resource server side.
Keycloak provides some built-in Policy Enforcers.</p>
</div>
</li>
<li>
<p><strong>Policy Information Point (PIP)</strong></p>
<div class="paragraph">
<p>Being based on Keycloak Authentication Server, you can obtain attributes from identities and runtime environment during the evaluation of authorization policies.</p>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="the-authorization-process"><a class="anchor" href="#the-authorization-process"></a>The authorization process</h4>
<div class="paragraph">
<p>Three main processes define the necessary steps to understand how to use Keycloak to enable fine-grained authorization to your applications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Resource Management</strong></p>
</li>
<li>
<p><strong>Permission and Policy Management</strong></p>
</li>
<li>
<p><strong>Policy Enforcement</strong></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="resource-management"><a class="anchor" href="#resource-management"></a>Resource management</h5>
<div class="paragraph">
<p><strong>Resource Management</strong> involves all the necessary steps to define what is being protected.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/resource-mgmt-process.png" alt="Resource management overview"></span></p>
</div>
<div class="paragraph">
<p>First, you need to specify Keycloak what are you looking to protect, which usually represents a web application or a set of one or more services. For more information on resource servers see <a href="#_overview_terminology">Terminology</a>.</p>
</div>
<div class="paragraph">
<p>Resource servers are managed using the Keycloak Administration Console. There you can enable any registered client application as a resource server and start managing the resources and scopes you want to protect.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/rs-r-scopes.png" alt="Resource Server overview"></span></p>
</div>
<div class="paragraph">
<p>A resource can be a web page, a RESTFul resource, a file in your file system, an EJB, and so on. They can represent a group of resources (just like a Class in Java) or they can represent a single and specific resource.</p>
</div>
<div class="paragraph">
<p>For instance, you might have a <em>Bank Account</em> resource that represents all banking accounts and use it to define the authorization policies that are common to all banking accounts. However, you might want to define specific policies for <em>Alice Account</em> (a resource instance that belongs to a customer), where only the owner is allowed to access some information or perform an operation.</p>
</div>
<div class="paragraph">
<p>Resources can be managed using the Keycloak Administration Console or the <a href="#_service_protection_api">Protection API</a>. In the latter case, resource servers are able to manage their resources remotely.</p>
</div>
<div class="paragraph">
<p>Scopes usually represent the actions that can be performed on a resource, but they are not limited to that. You can also use scopes to represent one or more attributes within a resource.</p>
</div>
</div>
<div class="sect4">
<h5 id="permission-and-policy-management"><a class="anchor" href="#permission-and-policy-management"></a>Permission and policy management</h5>
<div class="paragraph">
<p>Once you have defined your resource server and all the resources you want to protect, you must set up permissions and policies.</p>
</div>
<div class="paragraph">
<p>This process involves all the necessary steps to actually define the security and access requirements that govern your resources.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/policy-mgmt-process.png" alt="Permission and policy management overview"></span></p>
</div>
<div class="paragraph">
<p>Policies define the conditions that must be satisfied to access or perform operations on something (resource or scope), but they are not tied to what they are protecting. They are generic and can be reused to build permissions or even more complex policies.</p>
</div>
<div class="paragraph">
<p>For instance, to allow access to a group of resources only for users granted with a role "User Premium", you can use RBAC (Role-based Access Control).</p>
</div>
<div class="paragraph">
<p>Keycloak provides a few built-in policy types (and their respective policy providers) covering the most common access control mechanisms. You can even create policies based on rules written using JavaScript.</p>
</div>
<div class="paragraph">
<p>Once you have your policies defined, you can start defining your permissions. Permissions are coupled with the resource they are protecting. Here you specify
what you want to protect (resource or scope) and the policies that must be satisfied to grant or deny permission.</p>
</div>
</div>
<div class="sect4">
<h5 id="policy-enforcement"><a class="anchor" href="#policy-enforcement"></a>Policy enforcement</h5>
<div class="paragraph">
<p><strong>Policy Enforcement</strong> involves the necessary steps to actually enforce authorization decisions to a resource server. This is achieved by enabling a <strong>Policy Enforcement Point</strong> or PEP at the resource server that is capable of communicating with the authorization server, ask for authorization data and control access to protected resources based on the decisions and permissions returned by the server.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/pep-pattern-diagram.png" alt="PEP overview"></span></p>
</div>
<div class="paragraph">
<p>Keycloak provides some built-in Policy Enforcers implementations that you can use to protect your applications depending on the platform they are running on.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="authorization-services"><a class="anchor" href="#authorization-services"></a>Authorization services</h4>
<div class="paragraph">
<p>Authorization services consist of the following RESTFul endpoints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Token Endpoint</strong></p>
</li>
<li>
<p><strong>Resource Management Endpoint</strong></p>
</li>
<li>
<p><strong>Permission Management Endpoint</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each of these services provides a specific API covering the different steps involved in the authorization process.</p>
</div>
<div class="sect4">
<h5 id="token-endpoint"><a class="anchor" href="#token-endpoint"></a>Token endpoint</h5>
<div class="paragraph">
<p>OAuth2 clients (such as front end applications) can obtain access tokens from the server using the token endpoint and use
these same tokens to access resources protected by a resource server (such as back end services). In the same way,
Keycloak Authorization Services provide extensions to OAuth2 to allow access tokens to be issued based on the processing
of all policies associated with the resource(s) or scope(s) being requested. This means that resource servers can enforce access
to their protected resources based on the permissions granted by the server and held by an access token. In Keycloak Authorization Services
the access token with permissions is called a Requesting Party Token or RPT for short.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#_service_obtaining_permissions">Obtaining Permissions</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="protection-api"><a class="anchor" href="#protection-api"></a>Protection API</h5>
<div class="paragraph">
<p>The <strong>Protection API</strong> is a set of <a href="https://docs.kantarainitiative.org/uma/wg/oauth-uma-federated-authz-2.0-09.html">UMA-compliant</a> endpoint-providing operations
for resource servers to help them manage their resources, scopes, permissions, and policies associated with them. Only resource servers are allowed to access this API, which also requires a
<strong>uma_protection</strong> scope.</p>
</div>
<div class="paragraph">
<p>The operations provided by the Protection API can be organized in two main groups:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Resource Management</strong></p>
<div class="ulist">
<ul>
<li>
<p>Create Resource</p>
</li>
<li>
<p>Delete Resource</p>
</li>
<li>
<p>Find by Id</p>
</li>
<li>
<p>Query</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Permission Management</strong></p>
<div class="ulist">
<ul>
<li>
<p>Issue Permission Tickets</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, Remote Resource Management is enabled. You can change that using the Keycloak Administration Console and only allow resource management through the console.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When using the UMA protocol, the issuance of Permission Tickets by the Protection API is an important part of the whole authorization process. As described in a subsequent section, they represent the permissions being requested by the client and that are sent to the server to obtain a final token with all permissions granted during the evaluation of the permissions and policies associated with the resources and scopes being requested.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#_service_protection_api">Protection API</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_overview_terminology"><a class="anchor" href="#_overview_terminology"></a>Terminology</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/auth-services-terminology.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/auth-services-terminology.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/auth-services-terminology.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>Before going further, it is important to understand these terms and concepts introduced by Keycloak Authorization Services.</p>
</div>
<div class="sect3">
<h4 id="_overview_terminology_resource_server"><a class="anchor" href="#_overview_terminology_resource_server"></a>Resource Server</h4>
<div class="paragraph">
<p>Per OAuth2 terminology, a resource server is the server hosting the protected resources and capable of accepting and responding to protected resource requests.</p>
</div>
<div class="paragraph">
<p>Resource servers usually rely on some kind of information to decide whether access to a protected resource should be granted. For RESTful-based resource servers,
that information is usually carried in a security token, typically sent as a bearer token along with every request to the server. Web applications that rely on a session to
authenticate users usually store that information in the user&#8217;s session and retrieve it from there for each request.</p>
</div>
<div class="paragraph">
<p>In Keycloak, any <strong>confidential</strong> client application can act as a resource server. This client&#8217;s resources and their respective scopes are protected and governed by a set of authorization policies.</p>
</div>
</div>
<div class="sect3">
<h4 id="resource"><a class="anchor" href="#resource"></a>Resource</h4>
<div class="paragraph">
<p>A resource is part of the assets of an application and the organization. It can be a set of one or more endpoints, a classic web resource such as an HTML page, and so on.
In authorization policy terminology, a resource is the <em>object</em> being protected.</p>
</div>
<div class="paragraph">
<p>Every resource has a unique identifier that can represent a single resource or a set of resources. For instance, you can manage a <em>Banking Account Resource</em> that represents and defines a set of authorization policies for all banking accounts. But you can also have a different resource named <em>Alice&#8217;s Banking Account</em>, which represents a single resource owned by a single customer, which can have its own set of authorization policies.</p>
</div>
</div>
<div class="sect3">
<h4 id="scope"><a class="anchor" href="#scope"></a>Scope</h4>
<div class="paragraph">
<p>A resource&#8217;s scope is a bounded extent of access that is possible to perform on a resource. In authorization policy terminology, a scope is one of the potentially many <em>verbs</em> that can logically apply to a resource.</p>
</div>
<div class="paragraph">
<p>It usually indicates what can be done with a given resource. Example of scopes are view, edit, delete, and so on. However, scope can also be related to specific information provided by a resource. In this case, you can have a project resource and a cost scope, where the cost scope is used to define specific policies and permissions for users to access a project&#8217;s cost.</p>
</div>
</div>
<div class="sect3">
<h4 id="permission"><a class="anchor" href="#permission"></a>Permission</h4>
<div class="paragraph">
<p>Consider this simple and very common permission:</p>
</div>
<div class="paragraph">
<p>A permission associates the object being protected with the policies that must be evaluated to determine whether access is granted.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>X</strong> CAN DO <strong>Y</strong> ON RESOURCE <strong>Z</strong></p>
<div class="ulist">
<ul>
<li>
<p>where &#8230;&#8203;</p>
<div class="ulist">
<ul>
<li>
<p><strong>X</strong> represents one or more users, roles, or groups, or a combination of them. You can also use claims and context here.</p>
</li>
<li>
<p><strong>Y</strong> represents an action to be performed, for example, write, view, and so on.</p>
</li>
<li>
<p><strong>Z</strong> represents a protected resource, for example, "/accounts".</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Keycloak provides a rich platform for building a range of permission strategies ranging from simple to very complex, rule-based dynamic permissions. It provides flexibility and helps to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reduce code refactoring and permission management costs</p>
</li>
<li>
<p>Support a more flexible security model, helping you to easily adapt to changes in your security requirements</p>
</li>
<li>
<p>Make changes at runtime; applications are only concerned about the resources and scopes being protected and not how they are protected.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="policy"><a class="anchor" href="#policy"></a>Policy</h4>
<div class="paragraph">
<p>A policy defines the conditions that must be satisfied to grant access to an object. Unlike permissions, you do not specify the object being protected
but rather the conditions that must be satisfied for access to a given object (for example, resource, scope, or both).
Policies are strongly related to the different access control mechanisms (ACMs) that you can use to protect your resources.
With policies, you can implement strategies for attribute-based access control (ABAC), role-based access control (RBAC), context-based access control, or any combination of these.</p>
</div>
<div class="paragraph">
<p>Keycloak leverages the concept of policies and how you define them by providing the concept of aggregated policies, where you can build a "policy of policies" and still control the behavior of the evaluation.
Instead of writing one large policy with all the conditions that must be satisfied for access to a given resource, the policies implementation in Keycloak Authorization Services follows the divide-and-conquer technique.
That is, you can create individual policies, then reuse them with different permissions and build more complex policies by combining individual policies.</p>
</div>
</div>
<div class="sect3">
<h4 id="policy-provider"><a class="anchor" href="#policy-provider"></a>Policy provider</h4>
<div class="paragraph">
<p>Policy providers are implementations of specific policy types. Keycloak provides built-in policies, backed by their corresponding
policy providers, and you can create your own policy types to support your specific requirements.</p>
</div>
<div class="paragraph">
<p>Keycloak provides an SPI (Service Provider Interface) that you can use to plug in your own policy provider implementations.</p>
</div>
</div>
<div class="sect3">
<h4 id="_overview_terminology_permission_ticket"><a class="anchor" href="#_overview_terminology_permission_ticket"></a>Permission ticket</h4>
<div class="paragraph">
<p>A permission ticket is a special type of token defined by the User-Managed Access (UMA) specification that provides an opaque structure whose form is determined by the authorization server. This
structure represents the resources and/or scopes being requested by a client, the access context, as well as the policies that must be applied to a request for authorization data (requesting party token [RPT]).</p>
</div>
<div class="paragraph">
<p>In UMA, permission tickets are crucial to support person-to-person sharing and also person-to-organization sharing. Using permission tickets for authorization workflows enables a range of scenarios from simple to complex, where resource owners and resource servers have complete control over their resources based on fine-grained policies that govern the access to these resources.</p>
</div>
<div class="paragraph">
<p>In the UMA workflow, permission tickets are issued by the authorization server to a resource server, which returns the permission ticket to the client trying to access a protected resource. Once the client receives the ticket, it can make a request for an RPT (a final token holding authorization data) by sending the ticket back to the authorization server.</p>
</div>
<div class="paragraph">
<p>For more information on permission tickets, see <a href="#_service_user_managed_access">User-Managed Access</a> and the <a href="https://docs.kantarainitiative.org/uma/wg/oauth-uma-grant-2.0-09.html">UMA</a> specification.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started_overview"><a class="anchor" href="#_getting_started_overview"></a>Getting Started</h2>
<div class="sectionbody">
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/getting-started-overview.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/getting-started-overview.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/getting-started-overview.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>For certain applications, you can look at the following resources to quickly
get started with Keycloak Authorization Services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/keycloak/keycloak-quickstarts/tree/latest/jakarta/servlet-authz-client">Securing a JakartaEE Application in Wildfly</a></p>
</li>
<li>
<p><a href="https://github.com/keycloak/keycloak-quickstarts/tree/latest/spring/rest-authz-resource-server">Securing a Spring Boot Application</a></p>
</li>
<li>
<p><a href="https://quarkus.io/guides/security-keycloak-authorization">Securing Quarkus Applications</a></p>
</li>
<li>
<p><strong>Keycloak Node.js adapter</strong> in the <a href="https://www.keycloak.org/guides#securing-apps">securing apps</a> section</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resource_server_overview"><a class="anchor" href="#_resource_server_overview"></a>Managing resource servers</h2>
<div class="sectionbody">
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/resource-server-overview.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/resource-server-overview.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/resource-server-overview.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>According to the OAuth2 specification, a resource server is a server hosting the protected resources and capable of accepting and responding to protected resource requests.</p>
</div>
<div class="paragraph">
<p>In Keycloak, resource servers are provided with a rich platform for enabling fine-grained authorization for their protected resources, where authorization decisions can be made based on different access control mechanisms.</p>
</div>
<div class="paragraph">
<p>Any client application can be configured to support fine-grained permissions. In doing so, you are conceptually turning the client application into a resource server.</p>
</div>
<div class="sect2">
<h3 id="_resource_server_create_client"><a class="anchor" href="#_resource_server_create_client"></a>Creating a client application</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/resource-server-create-client.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/resource-server-create-client.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/resource-server-create-client.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>The first step to enable Keycloak Authorization Services is to create the client application that you want to turn into a resource server.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <strong>Clients</strong>.</p>
<div class="paragraph">
<div class="title">Clients</div>
<p><span class="image"><img src="./images/resource-server/client-list.png" alt="Clients"></span></p>
</div>
</li>
<li>
<p>On this page, click <strong>Create client</strong>.</p>
<div class="paragraph">
<div class="title">Add Client</div>
<p><span class="image"><img src="./images/resource-server/client-create.png" alt="Add Client"></span></p>
</div>
</li>
<li>
<p>Type the <code>Client ID</code> of the client. For example, <em>my-resource-server</em>.</p>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>Toggle <strong>Client authentication</strong> to ON.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
<li>
<p>Type the <code>Root URL</code> for your application. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://${host}:${port}/my-resource-server</code></pre>
</div>
</div>
</li>
<li>
<p>Click <strong>Save</strong>. The client is created and the client Settings page opens. A page similar to the following is displayed:</p>
<div class="paragraph">
<div class="title">Client Settings</div>
<p><span class="image"><img src="./images/resource-server/client-enable-authz.png" alt="Client Settings"></span></p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_resource_server_enable_authorization"><a class="anchor" href="#_resource_server_enable_authorization"></a>Enabling authorization services</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/resource-server-enable-authorization.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/resource-server-enable-authorization.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/resource-server-enable-authorization.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>You can turn your OIDC client into a resource server and enable fine-grained authorization.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Toggle <strong>Authorization Enabled</strong> to <strong>`On</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
<div class="paragraph">
<div class="title">Enabling authorization services</div>
<p><span class="image"><img src="./images/resource-server/client-enable-authz.png" alt="Enabling authorization services"></span></p>
</div>
<div class="paragraph">
<p>A new Authorization tab is displayed for this client. Click the <strong>Authorization</strong> tab and a page similar to the following is displayed:</p>
</div>
<div class="paragraph">
<div class="title">Resource server settings</div>
<p><span class="image"><img src="./images/resource-server/authz-settings.png" alt="Resource server settings"></span></p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Authorization tab contains additional sub-tabs covering the different steps that you must follow to actually protect your application&#8217;s resources. Each tab is covered separately by a specific topic in this documentation. But here is a quick description about each one:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Settings</strong></p>
<div class="paragraph">
<p>General settings for your resource server. For more details about this page see the <a href="#resource_server_settings">Resource Server Settings</a> section.</p>
</div>
</li>
<li>
<p><strong>Resource</strong></p>
<div class="paragraph">
<p>From this page, you can manage your application&#8217;s <a href="#_resource_overview">resources</a>.</p>
</div>
</li>
<li>
<p><strong>Authorization Scopes</strong></p>
<div class="paragraph">
<p>From this page, you can manage <a href="#_resource_overview">scopes</a>.</p>
</div>
</li>
<li>
<p><strong>Policies</strong></p>
<div class="paragraph">
<p>From this page, you can manage <a href="#_policy_overview">authorization policies</a> and define the conditions that must be met to grant a permission.</p>
</div>
</li>
<li>
<p><strong>Permissions</strong></p>
<div class="paragraph">
<p>From this page, you can manage the <a href="#_permission_overview">permissions</a> for your protected resources and scopes by linking them with the policies you created.</p>
</div>
</li>
<li>
<p><strong>Evaluate</strong></p>
<div class="paragraph">
<p>From this page, you can <a href="#_policy_evaluation_overview">simulate authorization requests</a> and view the result of the evaluation of the permissions and authorization policies you have defined.</p>
</div>
</li>
<li>
<p><strong>Export Settings</strong></p>
<div class="paragraph">
<p>From this page, you can <a href="#_resource_server_import_config">export</a> the authorization settings to a JSON file.</p>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="resource_server_settings"><a class="anchor" href="#resource_server_settings"></a>Resource server settings</h4>
<div class="paragraph">
<p>On the Resource Server Settings page, you can configure the policy enforcement mode, allow remote resource management, and export the authorization configuration settings.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Policy Enforcement Mode</strong></p>
<div class="paragraph">
<p>Specifies how policies are enforced when processing authorization requests sent to the server.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Enforcing</strong></p>
<div class="paragraph">
<p>(default mode) Requests are denied by default even when there is no policy associated with a given resource.</p>
</div>
</li>
<li>
<p><strong>Permissive</strong></p>
<div class="paragraph">
<p>Requests are allowed even when there is no policy associated with a given resource.</p>
</div>
</li>
<li>
<p><strong>Disabled</strong></p>
<div class="paragraph">
<p>Disables the evaluation of all policies and allows access to all resources.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Decision Strategy</strong></p>
<div class="paragraph">
<p>This configurations changes how the policy evaluation engine decides whether or not a resource or scope should be granted based on the outcome from all evaluated permissions. <code>Affirmative</code> means that at least one permission must evaluate to a positive decision in order grant access to a resource and its scopes. <code>Unanimous</code> means that all permissions must evaluate to a positive decision in order for the final decision to be also positive. As an example, if two permissions for a same resource or scope are in conflict (one of them is granting access and the other is denying access), the permission to the resource or scope will be granted if the chosen strategy is <code>Affirmative</code>. Otherwise, a single deny from any permission will also deny access to the resource or scope.</p>
</div>
</li>
<li>
<p><strong>Remote Resource Management</strong></p>
<div class="paragraph">
<p>Specifies whether resources can be managed remotely by the resource server. If false, resources can be managed only from the administration console.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_resource_server_default_config"><a class="anchor" href="#_resource_server_default_config"></a>Default Configuration</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/resource-server-default-config.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/resource-server-default-config.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/resource-server-default-config.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>When you create a resource server, Keycloak creates a default configuration for your newly created resource server.</p>
</div>
<div class="paragraph">
<p>The default configuration consists of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A default protected resource representing all resources in your application.</p>
</li>
<li>
<p>A policy that always grants access to the resources protected by this policy.</p>
</li>
<li>
<p>A permission that governs access to all resources based on the default policy.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default protected resource is referred to as the <strong>default resource</strong> and you can view it if you navigate to the <strong>Resources</strong> tab.</p>
</div>
<div class="paragraph">
<div class="title">Default resource</div>
<p><span class="image"><img src="./images/resource-server/default-resource.png" alt="Default resource"></span></p>
</div>
<div class="paragraph">
<p>This resource defines a <code>Type</code>, namely <code>urn:my-resource-server:resources:default</code> and a <code>URI</code> <code>/*</code>. Here, the <code>URI</code> field defines a
wildcard pattern that indicates to Keycloak that this resource represents all the paths in your application. In other words,
when enabling policy enforcement for your application, all the permissions associated with the resource
will be examined before granting access.</p>
</div>
<div class="paragraph">
<p>The <code>Type</code> mentioned previously defines a value that can be used to create <a href="#_permission_typed_resource">typed resource permissions</a> that must be applied
to the default resource or any other resource you create using the same type.</p>
</div>
<div class="paragraph">
<p>The default policy is referred to as the <strong>only from realm policy</strong> and you can view it if you navigate to the <strong>Policies</strong> tab.</p>
</div>
<div class="paragraph">
<div class="title">Default policy</div>
<p><span class="image"><img src="./images/resource-server/default-policy.png" alt="Default policy"></span></p>
</div>
<div class="paragraph">
<p>This policy is a <a href="#_policy_js">JavaScript-based policy</a> defining a condition that always grants access to the resources protected by this policy. If you click this policy you can see that it defines a rule as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js"><span class="comment">// by default, grants any permission associated with this policy</span>
<span class="predefined">$evaluation</span>.grant();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lastly, the default permission is referred to as the <strong>default permission</strong> and you can view it if you navigate to the <strong>Permissions</strong> tab.</p>
</div>
<div class="paragraph">
<div class="title">Default Permission</div>
<p><span class="image"><img src="./images/resource-server/default-permission.png" alt="Default Permission"></span></p>
</div>
<div class="paragraph">
<p>This permission is a <a href="#_permission_create_resource">resource-based permission</a>, defining a set of one or more policies that are applied to all resources with a given type.</p>
</div>
<div class="sect3">
<h4 id="changing-the-default-configuration"><a class="anchor" href="#changing-the-default-configuration"></a>Changing the default configuration</h4>
<div class="paragraph">
<p>You can change the default configuration by removing the default resource, policy, or permission definitions and creating your own.</p>
</div>
<div class="paragraph">
<p>The default resource is created with a <strong>URI</strong> that maps to any resource or path in your application using a <strong>/</strong>* pattern. Before creating your own resources, permissions and policies, make
sure the default configuration doesn&#8217;t conflict with your own settings.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default configuration defines a resource that maps to all paths in your application. If you are about to write permissions to your own resources, be sure to remove the <strong>Default Resource</strong> or change its <code><code>URIS</code></code> fields to a more specific paths in your application. Otherwise, the policy associated with the default resource (which by default always grants access) will allow Keycloak to grant access to any protected resource.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_resource_server_import_config"><a class="anchor" href="#_resource_server_import_config"></a>Export and import authorization configuration</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/resource-server-import-config.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/resource-server-import-config.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/resource-server-import-config.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>The configuration settings for a resource server (or client) can be exported and downloaded. You can also import an existing configuration file for a resource server. Importing and exporting a configuration file is helpful when you want to create an initial configuration for a resource server or to update an existing configuration. The configuration file contains definitions for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Protected resources and scopes</p>
</li>
<li>
<p>Policies</p>
</li>
<li>
<p>Permissions</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="exporting-a-configuration-file"><a class="anchor" href="#exporting-a-configuration-file"></a>Exporting a configuration file</h4>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <strong>Clients</strong> in the menu.</p>
</li>
<li>
<p>Click the client you created as a resource server.</p>
</li>
<li>
<p>Click the <strong>Export</strong> tab.</p>
<div class="paragraph">
<div class="title">Export Settings</div>
<p><span class="image"><img src="./images/resource-server/authz-export.png" alt="Export Settings"></span></p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The configuration file is exported in JSON format and displayed in a text area, from which you can copy and paste. You can also click <strong>Download</strong> to download the configuration file and save it.</p>
</div>
</div>
<div class="sect3">
<h4 id="importing-a-configuration-file"><a class="anchor" href="#importing-a-configuration-file"></a>Importing a configuration file</h4>
<div class="paragraph">
<p>You can import a configuration file for a resource server.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to the <strong>Resource Server Settings</strong> page.</p>
<div class="paragraph">
<div class="title">Import Settings</div>
<p><span class="image"><img src="./images/resource-server/authz-settings.png" alt="Import Settings"></span></p>
</div>
</li>
<li>
<p>Click <strong>Import</strong> and choose a file containing the configuration that you want to import.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resource_overview"><a class="anchor" href="#_resource_overview"></a>Managing resources and scopes</h2>
<div class="sectionbody">
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/resource-overview.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/resource-overview.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/resource-overview.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>Resource management is straightforward and generic. After creating a resource server, you can start creating the resources and scopes that you want to protect.
Resources and scopes can be managed by navigating to the <strong>Resource</strong> and <strong>Authorization Scopes</strong> tabs, respectively.</p>
</div>
<div class="sect2">
<h3 id="_resource_view"><a class="anchor" href="#_resource_view"></a>Viewing resources</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/resource-view.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/resource-view.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/resource-view.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>On the <strong>Resource</strong> page, you see a list of the resources associated with a resource server.</p>
</div>
<div class="paragraph">
<div class="title">Resources</div>
<p><span class="image"><img src="./images/resource/view.png" alt="Resources"></span></p>
</div>
<div class="paragraph">
<p>The resource list provides information about the protected resources, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Type</p>
</li>
<li>
<p>URIS</p>
</li>
<li>
<p>Owner</p>
</li>
<li>
<p>Associated scopes, if any</p>
</li>
<li>
<p>Associated permissions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>From this list, you can also directly create a permission by clicking <strong>Create Permission</strong> for the resource for which you want to create the permission.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Before creating permissions for your resources, be sure you have already defined the policies that you want to associate with the permission.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_resource_create"><a class="anchor" href="#_resource_create"></a>Creating resources</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/resource-create.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/resource-create.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/resource-create.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>Creating a resource is straightforward and generic. Your main concern is the granularity of the resources you create. In other words, resources can
be created to represent a set of one or more resources and the way you define them is crucial to managing permissions.</p>
</div>
<div class="paragraph">
<p>To create a new resource, click <strong>Create resource</strong>.</p>
</div>
<div class="paragraph">
<div class="title">Add resource</div>
<p><span class="image"><img src="./images/resource/create.png" alt="Add resource"></span></p>
</div>
<div class="paragraph">
<p>In Keycloak, a resource defines a small set of information that is common to different types of resources, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Name</strong></p>
<div class="paragraph">
<p>A human-readable and unique string describing this resource.</p>
</div>
</li>
</ul>
</div>
<div id="_resource_create_type" class="ulist">
<ul>
<li>
<p><strong>Type</strong></p>
<div class="paragraph">
<p>A string uniquely identifying the type of a set of one or more resources. The type is a <em>string</em> used to group different resource instances.
For example, the default type for the default resource that is automatically created is <code>urn:resource-server-name:resources:default</code></p>
</div>
</li>
</ul>
</div>
<div id="_resource_create_uri" class="ulist">
<ul>
<li>
<p><strong>URIS</strong></p>
<div class="paragraph">
<p>URIS that provides the locations/addresses for the resource. For HTTP resources, the URIS
are usually the relative paths used to serve these resources.</p>
</div>
</li>
<li>
<p><strong>Scopes</strong></p>
<div class="paragraph">
<p>One or more scopes to associate with the resource.</p>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="resource-attributes"><a class="anchor" href="#resource-attributes"></a>Resource attributes</h4>
<div class="paragraph">
<p>Resources may have attributes associated with them. These attributes can be used to provide additional information about
a resource and to provide additional information to policies when evaluating permissions associated with a resource.</p>
</div>
<div class="paragraph">
<p>Each attribute is a key and value pair where the value can be a set of one or many strings. Multiple values can be defined for an attribute by separating each value with a comma.</p>
</div>
</div>
<div class="sect3">
<h4 id="typed-resources"><a class="anchor" href="#typed-resources"></a>Typed resources</h4>
<div class="paragraph">
<p>The type field of a resource can be used to group different resources together, so they can be protected using a common set of permissions.</p>
</div>
</div>
<div class="sect3">
<h4 id="resource-owners"><a class="anchor" href="#resource-owners"></a>Resource owners</h4>
<div class="paragraph">
<p>Resources also have an owner. By default, resources are owned by the resource server.</p>
</div>
<div class="paragraph">
<p>However, resources can also be associated with users, so you can create permissions based on the resource owner. For example, only the resource owner is allowed to delete or update a given resource.</p>
</div>
</div>
<div class="sect3">
<h4 id="managing-resources-remotely"><a class="anchor" href="#managing-resources-remotely"></a>Managing resources remotely</h4>
<div class="paragraph">
<p>Resource management is also exposed through the <a href="#_service_protection_api">Protection API</a> to allow resource servers to remotely manage their resources.</p>
</div>
<div class="paragraph">
<p>When using the Protection API, resource servers can be implemented to manage resources owned by their users. In this case, you can
specify the user identifier to configure a resource as belonging to a specific user.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Keycloak provides resource servers complete control over their resources. In the future, we should be able to
allow users to control their own resources as well as approve authorization requests and manage permissions, especially when using the UMA protocol.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_policy_overview"><a class="anchor" href="#_policy_overview"></a>Managing policies</h2>
<div class="sectionbody">
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/policy-overview.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/policy-overview.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/policy-overview.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>As mentioned previously, policies define the conditions that must be satisfied before granting access to an object.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click the <strong>Policy</strong> tab to view all policies associated with a resource server.</p>
<div class="paragraph">
<div class="title">Policies</div>
<p><span class="image"><img src="./images/policy/view.png" alt="Policies"></span></p>
</div>
<div class="paragraph">
<p>On this tab, you can view the list of previously created policies as well as create and edit a policy.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>To create a new policy, click <strong>Create policy</strong>, then select a policy type from the list.</p>
</div>
<div class="paragraph">
<p>Details about each policy type are described in this section.</p>
</div>
<div class="sect2">
<h3 id="_policy_user"><a class="anchor" href="#_policy_user"></a>User-based policy</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/policy-user-policy.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/policy-user-policy.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/policy-user-policy.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>You can use this type of policy to define conditions for your permissions where a set of one or more users is permitted to access an object.</p>
</div>
<div class="paragraph">
<p>To create a new user-based policy, select <strong>User</strong> in the item list in the upper right corner of the policy listing.</p>
</div>
<div class="paragraph">
<div class="title">Add a User Policy</div>
<p><span class="image"><img src="./images/policy/create-user.png" alt="Add User Policy"></span></p>
</div>
<div class="sect3">
<h4 id="configuration"><a class="anchor" href="#configuration"></a>Configuration</h4>
<div class="ulist">
<ul>
<li>
<p><strong>Name</strong></p>
<div class="paragraph">
<p>A human-readable and unique string identifying the policy. A best practice is to use names that are closely related to your business and security requirements, so you
can identify them more easily.</p>
</div>
</li>
<li>
<p><strong>Description</strong></p>
<div class="paragraph">
<p>A string containing details about this policy.</p>
</div>
</li>
<li>
<p><strong>Users</strong></p>
<div class="paragraph">
<p>Specifies which users are given access by this policy.</p>
</div>
</li>
<li>
<p><strong>Logic</strong></p>
<div class="paragraph">
<p>The logic of this policy to apply after the other conditions have been evaluated.</p>
</div>
</li>
</ul>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#_policy_logic">Positive and negative logic</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_policy_rbac"><a class="anchor" href="#_policy_rbac"></a>Role-based policy</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/policy-role-policy.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/policy-role-policy.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/policy-role-policy.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>You can use this type of policy to define conditions for your permissions where a set of one or more roles is permitted to access an object.</p>
</div>
<div class="paragraph">
<p>By default, roles added to this policy are not specified as required and the policy will grant access if the user requesting access has been granted any of these roles. However, you can specify a specific role as <a href="#_policy_rbac_required">required</a> if you want to enforce a specific role. You can also combine required and non-required roles, regardless of whether they are realm or client roles.</p>
</div>
<div class="paragraph">
<p>Role policies can be useful when you need more restricted role-based access control (RBAC), where specific roles must be enforced to grant access to an object. For instance, you can enforce that a user must consent to allowing a client application (which is acting on the user&#8217;s behalf) to access the user&#8217;s resources. You can use Keycloak Client Scope Mapping to enable consent pages or even enforce clients to explicitly provide a scope when obtaining access tokens from a Keycloak server.</p>
</div>
<div class="paragraph">
<p>To create a new role-based policy, select <strong>Role</strong> from the policy type list.</p>
</div>
<div class="paragraph">
<div class="title">Add Role Policy</div>
<p><span class="image"><img src="./images/policy/create-role.png" alt="Add Role Policy"></span></p>
</div>
<div class="sect3">
<h4 id="configuration-2"><a class="anchor" href="#configuration-2"></a>Configuration</h4>
<div class="ulist">
<ul>
<li>
<p><strong>Name</strong></p>
<div class="paragraph">
<p>A human-readable and unique string describing the policy. A best practice is to use names that are closely related to your business and security requirements, so you
can identify them more easily.</p>
</div>
</li>
<li>
<p><strong>Description</strong></p>
<div class="paragraph">
<p>A string containing details about this policy.</p>
</div>
</li>
<li>
<p><strong>Realm Roles</strong></p>
<div class="paragraph">
<p>Specifies which <strong>realm</strong> roles are permitted by this policy.</p>
</div>
</li>
<li>
<p><strong>Client Roles</strong></p>
<div class="paragraph">
<p>Specifies which <strong>client</strong> roles are permitted by this policy. To enable this field must first select a <code>Client</code>.</p>
</div>
</li>
<li>
<p><strong>Fetch Roles</strong></p>
<div class="paragraph">
<p>By default, only the roles available from the token sent with the authorization requests are used to check if the user is granted with a role. If this setting is enabled, the policy will ignore roles from the token and check any role associated with the user instead.</p>
</div>
</li>
<li>
<p><strong>Logic</strong></p>
<div class="paragraph">
<p>The logic of this policy to apply after the other conditions have been evaluated.</p>
</div>
</li>
</ul>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#_policy_logic">Positive and negative logic</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_policy_rbac_required"><a class="anchor" href="#_policy_rbac_required"></a>Defining a role as required</h4>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/policy-role-policy-required-role.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/policy-role-policy-required-role.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/policy-role-policy-required-role.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>When creating a role-based policy, you can specify a specific role as <code>Required</code>. When you do that, the policy will grant access
only if the user requesting access has been granted <strong>all</strong> the <strong>required</strong> roles. Both realm and client roles can be configured as such.</p>
</div>
<div class="paragraph">
<div class="title">Example of a required role</div>
<p><span class="image"><img src="./images/policy/create-role.png" alt="Example of a required role"></span></p>
</div>
<div class="paragraph">
<p>To specify a role as required, select the <code>Required</code> checkbox for the role you want to configure as required.</p>
</div>
<div class="paragraph">
<p>Required roles can be useful when your policy defines multiple roles but only a subset of them are mandatory. In this case, you can combine realm and client roles to enable an
even more fine-grained role-based access control (RBAC) model for your application. For example, you can have policies specific for a client and require a specific client role associated with that client. Or you can enforce that access is granted only in the presence of a specific realm role. You can also combine both approaches within the same policy.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_policy_js"><a class="anchor" href="#_policy_js"></a>JavaScript-based policy</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/policy-js-policy.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/policy-js-policy.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/policy-js-policy.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If your policy implementation is using Attribute based access control (ABAC) as in the examples below, then please make sure that
users are not able to edit the protected attributes and the corresponding attributes are read-only. See the details in the <a href="https://www.keycloak.org/docs/DEV/server_admin/#mitigating_security_threats">Threat model mitigation</a> chapter.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can use this type of policy to define conditions for your permissions using JavaScript. It is one of the rule-based policy types
supported by Keycloak, and provides flexibility to write any policy based on the <a href="#_policy_evaluation_api">Evaluation API</a>.</p>
</div>
<div class="paragraph">
<p>To create a new JavaScript-based policy, select <strong>JavaScript</strong> in the item list in the upper right corner of the policy listing.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, JavaScript Policies can not be uploaded to the server. You should prefer deploying your JS Policies directly to
the server as described in <a href="https://www.keycloak.org/docs/DEV/server_development/#_script_providers">JavaScript Providers</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="creating-a-js-policy-from-a-deployed-jar-file"><a class="anchor" href="#creating-a-js-policy-from-a-deployed-jar-file"></a>Creating a JS policy from a deployed JAR file</h4>
<div class="paragraph">
<p>Keycloak allows you to deploy a JAR file in order to deploy scripts to the server. Please, take a look at <a href="https://www.keycloak.org/docs/DEV/server_development/#_script_providers">JavaScript Providers</a>
for more details.</p>
</div>
<div class="paragraph">
<p>Once you have your scripts deployed, you should be able to select the scripts you deployed from the list of available policy providers.</p>
</div>
</div>
<div class="sect3">
<h4 id="examples"><a class="anchor" href="#examples"></a>Examples</h4>
<div class="sect4">
<h5 id="checking-for-attributes-from-the-evaluation-context"><a class="anchor" href="#checking-for-attributes-from-the-evaluation-context"></a>Checking for attributes from the evaluation context</h5>
<div class="paragraph">
<p>Here is a simple example of a JavaScript-based policy that uses attribute-based access control (ABAC) to define a condition based on an attribute
obtained from the execution context:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">const context = <span class="predefined">$evaluation</span>.getContext();
const contextAttributes = context.getAttributes();

<span class="keyword">if</span> (contextAttributes.containsValue(<span class="string"><span class="delimiter">'</span><span class="content">kc.client.network.ip_address</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">127.0.0.1</span><span class="delimiter">'</span></span>)) {
    <span class="predefined">$evaluation</span>.grant();
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="checking-for-attributes-from-the-current-identity"><a class="anchor" href="#checking-for-attributes-from-the-current-identity"></a>Checking for attributes from the current identity</h5>
<div class="paragraph">
<p>Here is a simple example of a JavaScript-based policy that uses attribute-based access control (ABAC) to define a condition based on an attribute
obtained associated with the current identity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">const context = <span class="predefined">$evaluation</span>.getContext();
const identity = context.getIdentity();
const attributes = identity.getAttributes();
const email = attributes.getValue(<span class="string"><span class="delimiter">'</span><span class="content">email</span><span class="delimiter">'</span></span>).asString(<span class="integer">0</span>);

<span class="keyword">if</span> (email.endsWith(<span class="string"><span class="delimiter">'</span><span class="content">@keycloak.org</span><span class="delimiter">'</span></span>)) {
    <span class="predefined">$evaluation</span>.grant();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where these attributes are mapped from whatever claim is defined in the token that was used in the authorization request.</p>
</div>
</div>
<div class="sect4">
<h5 id="checking-for-roles-granted-to-the-current-identity"><a class="anchor" href="#checking-for-roles-granted-to-the-current-identity"></a>Checking for roles granted to the current identity</h5>
<div class="paragraph">
<p>You can also use Role-Based Access Control (RBAC) in your policies. In the example below, we check if a user is granted with a <code>keycloak_user</code> <strong>realm</strong> role:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">const context = <span class="predefined">$evaluation</span>.getContext();
const identity = context.getIdentity();

<span class="keyword">if</span> (identity.hasRealmRole(<span class="string"><span class="delimiter">'</span><span class="content">keycloak_user</span><span class="delimiter">'</span></span>)) {
    <span class="predefined">$evaluation</span>.grant();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or you can check if a user is granted with a <code>my-client-role</code> <strong>client</strong> role, where <code>my-client</code> is the client id of the client application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">const context = <span class="predefined">$evaluation</span>.getContext();
const identity = context.getIdentity();

<span class="keyword">if</span> (identity.hasClientRole(<span class="string"><span class="delimiter">'</span><span class="content">my-client</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">my-client-role</span><span class="delimiter">'</span></span>)) {
    <span class="predefined">$evaluation</span>.grant();
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="checking-for-roles-granted-to-a-user"><a class="anchor" href="#checking-for-roles-granted-to-a-user"></a>Checking for roles granted to a user</h5>
<div class="paragraph">
<p>To check for realm roles granted to a user:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">const realm = <span class="predefined">$evaluation</span>.getRealm();

<span class="keyword">if</span> (realm.isUserInRealmRole(<span class="string"><span class="delimiter">'</span><span class="content">marta</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">role-a</span><span class="delimiter">'</span></span>)) {
    <span class="predefined">$evaluation</span>.grant();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or for client roles granted to a user:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">const realm = <span class="predefined">$evaluation</span>.getRealm();

<span class="keyword">if</span> (realm.isUserInClientRole(<span class="string"><span class="delimiter">'</span><span class="content">marta</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">my-client</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">some-client-role</span><span class="delimiter">'</span></span>)) {
    <span class="predefined">$evaluation</span>.grant();
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="checking-for-roles-granted-to-a-group"><a class="anchor" href="#checking-for-roles-granted-to-a-group"></a>Checking for roles granted to a group</h5>
<div class="paragraph">
<p>To check for realm roles granted to a group:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">const realm = <span class="predefined">$evaluation</span>.getRealm();

<span class="keyword">if</span> (realm.isGroupInRole(<span class="string"><span class="delimiter">'</span><span class="content">/Group A/Group D</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">role-a</span><span class="delimiter">'</span></span>)) {
    <span class="predefined">$evaluation</span>.grant();
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="pushing-arbitrary-claims-to-the-resource-server"><a class="anchor" href="#pushing-arbitrary-claims-to-the-resource-server"></a>Pushing arbitrary claims to the resource server</h5>
<div class="paragraph">
<p>To push arbitrary claims to the resource server in order to provide additional information on how permissions should be
enforced:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">const permission = <span class="predefined">$evaluation</span>.getPermission();

<span class="comment">// decide if permission should be granted</span>

<span class="keyword">if</span> (granted) {
    permission.addClaim(<span class="string"><span class="delimiter">'</span><span class="content">claim-a</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">claim-a</span><span class="delimiter">'</span></span>);
    permission.addClaim(<span class="string"><span class="delimiter">'</span><span class="content">claim-a</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">claim-a1</span><span class="delimiter">'</span></span>);
    permission.addClaim(<span class="string"><span class="delimiter">'</span><span class="content">claim-b</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">claim-b</span><span class="delimiter">'</span></span>);
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="checking-for-group-membership"><a class="anchor" href="#checking-for-group-membership"></a>Checking for group membership</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">const realm = <span class="predefined">$evaluation</span>.getRealm();

<span class="keyword">if</span> (realm.isUserInGroup(<span class="string"><span class="delimiter">'</span><span class="content">marta</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">/Group A/Group B</span><span class="delimiter">'</span></span>)) {
    <span class="predefined">$evaluation</span>.grant();
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="mixing-different-access-control-mechanisms"><a class="anchor" href="#mixing-different-access-control-mechanisms"></a>Mixing different access control mechanisms</h5>
<div class="paragraph">
<p>You can also use a combination of several access control mechanisms. The example below shows how roles(RBAC) and
claims/attributes(ABAC) checks can be used within the same policy. In this case we check if user is granted with <code>admin</code> role
or has an e-mail from <code>keycloak.org</code> domain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">const context = <span class="predefined">$evaluation</span>.getContext();
const identity = context.getIdentity();
const attributes = identity.getAttributes();
const email = attributes.getValue(<span class="string"><span class="delimiter">'</span><span class="content">email</span><span class="delimiter">'</span></span>).asString(<span class="integer">0</span>);

<span class="keyword">if</span> (identity.hasRealmRole(<span class="string"><span class="delimiter">'</span><span class="content">admin</span><span class="delimiter">'</span></span>) || email.endsWith(<span class="string"><span class="delimiter">'</span><span class="content">@keycloak.org</span><span class="delimiter">'</span></span>)) {
    <span class="predefined">$evaluation</span>.grant();
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When writing your own rules, keep in mind that the <strong>$evaluation</strong> object is an object implementing <strong>org.keycloak.authorization.policy.evaluation.Evaluation</strong>. For more information about what you can access from this interface, see the <a href="#_policy_evaluation_api">Evaluation API</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_policy_time"><a class="anchor" href="#_policy_time"></a>Time-based policy</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/policy-time-policy.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/policy-time-policy.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/policy-time-policy.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>You can use this type of policy to define time conditions for your permissions.</p>
</div>
<div class="paragraph">
<p>To create a new time-based policy, select <strong>Time</strong> in the item list in the upper right corner of the policy listing.</p>
</div>
<div class="paragraph">
<div class="title">Add Time Policy</div>
<p><span class="image"><img src="./images/policy/create-time.png" alt="Add Time Policy"></span></p>
</div>
<div class="sect3">
<h4 id="configuration-3"><a class="anchor" href="#configuration-3"></a>Configuration</h4>
<div class="ulist">
<ul>
<li>
<p><strong>Name</strong></p>
<div class="paragraph">
<p>A human-readable and unique string describing the policy. A best practice is to use names that are closely related to your business and security requirements, so you
can identify them more easily.</p>
</div>
</li>
<li>
<p><strong>Description</strong></p>
<div class="paragraph">
<p>A string containing details about this policy.</p>
</div>
</li>
<li>
<p><strong>Start time</strong></p>
<div class="paragraph">
<p>Defines the time before which access must <strong>not</strong> be granted. Permission is granted only if the current date/time is later than or equal to this value.</p>
</div>
</li>
<li>
<p><strong>Expire time</strong></p>
<div class="paragraph">
<p>Defines the time after which access must <strong>not</strong> be granted. Permission is granted only if the current date/time is earlier than or equal to this value. Select <strong>Repeat</strong> to repeat access being granted on a specific <strong>Day of Month</strong>, <strong>Month</strong>, <strong>Year</strong>, <strong>Hour</strong> or <strong>Minute</strong>.</p>
</div>
</li>
<li>
<p><strong>Day of Month</strong></p>
<div class="paragraph">
<p>Defines the day of month that access must be granted. You can also specify a range of dates. In this case, permission is granted only if the current day of the month is between or equal to the two values specified.</p>
</div>
</li>
<li>
<p><strong>Month</strong></p>
<div class="paragraph">
<p>Defines the month that access must be granted. You can also specify a range of months. In this case, permission is granted only if the current month is between or equal to the two values specified.</p>
</div>
</li>
<li>
<p><strong>Year</strong></p>
<div class="paragraph">
<p>Defines the year that access must be granted. You can also specify a range of years. In this case, permission is granted only if the current year is between or equal to the two values specified.</p>
</div>
</li>
<li>
<p><strong>Hour</strong></p>
<div class="paragraph">
<p>Defines the hour that access must be granted. You can also specify a range of hours. In this case, permission is granted only if current hour is between or equal to the two values specified.</p>
</div>
</li>
<li>
<p><strong>Minute</strong></p>
<div class="paragraph">
<p>Defines the minute that access must be granted. You can also specify a range of minutes. In this case, permission is granted only if the current minute is between or equal to the two values specified.</p>
</div>
</li>
<li>
<p><strong>Logic</strong></p>
<div class="paragraph">
<p>The logic of this policy to apply after the other conditions have been evaluated.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Access is only granted if all conditions are satisfied. Keycloak will perform an <em>AND</em> based on the outcome of each condition.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#_policy_logic">Positive and negative logic</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_policy_aggregated"><a class="anchor" href="#_policy_aggregated"></a>Aggregated policy</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/policy-aggregated-policy.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/policy-aggregated-policy.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/policy-aggregated-policy.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>As mentioned previously, Keycloak allows you to build a policy of policies, a concept referred to as policy aggregation. You can use policy aggregation to reuse existing policies to build more complex ones and keep your permissions even more decoupled from the policies that are evaluated during the processing of authorization requests.</p>
</div>
<div class="paragraph">
<p>To create a new aggregated policy, select <strong>Aggregated</strong> from the policy type list.</p>
</div>
<div class="paragraph">
<div class="title">Add an aggregated policy</div>
<p><span class="image"><img src="./images/policy/create-aggregated.png" alt="Add aggregated policy"></span></p>
</div>
<div class="paragraph">
<p>Let&#8217;s suppose you have a resource called <em>Confidential Resource</em> that can be accessed only by users from the <em>keycloak.org</em> domain and from a certain range of IP addresses.
You can create a single policy with both conditions. However, you want to reuse the domain part of this policy to apply to permissions that operates regardless of the originating network.</p>
</div>
<div class="paragraph">
<p>You can create separate policies for both domain and network conditions and create a third policy based on the combination of these two policies. With an aggregated policy, you can freely combine other policies and then apply the new aggregated policy to any permission you want.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When creating aggregated policies, be mindful that you are not introducing a circular reference or dependency between policies. If a circular dependency is detected, you cannot create or update the policy.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="configuration-4"><a class="anchor" href="#configuration-4"></a>Configuration</h4>
<div class="ulist">
<ul>
<li>
<p><strong>Name</strong></p>
<div class="paragraph">
<p>A human-readable and unique string describing the policy. We strongly suggest that you use names that are closely related with your business and security requirements, so you
can identify them more easily and also know what they mean.</p>
</div>
</li>
<li>
<p><strong>Description</strong></p>
<div class="paragraph">
<p>A string with more details about this policy.</p>
</div>
</li>
<li>
<p><strong>Apply Policy</strong></p>
<div class="paragraph">
<p>Defines a set of one or more policies to associate with the aggregated policy. To associate a policy you can either select an existing policy
or create a new one by selecting the type of the policy you want to create.</p>
</div>
</li>
<li>
<p><strong>Decision Strategy</strong></p>
<div class="paragraph">
<p>The decision strategy for this permission.</p>
</div>
</li>
<li>
<p><strong>Logic</strong></p>
<div class="paragraph">
<p>The logic of this policy to apply after the other conditions have been evaluated.</p>
</div>
</li>
</ul>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#_policy_logic">Positive and negative logic</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="decision-strategy-for-aggregated-policies"><a class="anchor" href="#decision-strategy-for-aggregated-policies"></a>Decision strategy for aggregated policies</h4>
<div class="paragraph">
<p>When creating aggregated policies, you can also define the decision strategy that will be used to determine the final decision based on the outcome from each policy.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Unanimous</strong></p>
<div class="paragraph">
<p>The default strategy if none is provided. In this case, <em>all</em> policies must evaluate to a positive decision for the final decision to be also positive.</p>
</div>
</li>
<li>
<p><strong>Affirmative</strong></p>
<div class="paragraph">
<p>In this case, <em>at least one</em> policy must evaluate to a positive decision in order for the final decision to be also positive.</p>
</div>
</li>
<li>
<p><strong>Consensus</strong></p>
<div class="paragraph">
<p>In this case, the number of positive decisions must be greater than the number of negative decisions. If the number of positive and negative decisions is the same, the final decision will be negative.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_policy_client"><a class="anchor" href="#_policy_client"></a>Client-based policy</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/policy-client-policy.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/policy-client-policy.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/policy-client-policy.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>You can use this type of policy to define conditions for your permissions where a set of one or more clients is permitted to access an object.</p>
</div>
<div class="paragraph">
<p>To create a new client-based policy, select <strong>Client</strong> from the policy type list.</p>
</div>
<div class="paragraph">
<div class="title">Add a Client Policy</div>
<p><span class="image"><img src="./images/policy/create-client.png" alt="Add a Client Policy"></span></p>
</div>
<div class="sect3">
<h4 id="configuration-5"><a class="anchor" href="#configuration-5"></a>Configuration</h4>
<div class="ulist">
<ul>
<li>
<p><strong>Name</strong></p>
<div class="paragraph">
<p>A human-readable and unique string identifying the policy. A best practice is to use names that are closely related to your business and security requirements, so you
can identify them more easily.</p>
</div>
</li>
<li>
<p><strong>Description</strong></p>
<div class="paragraph">
<p>A string containing details about this policy.</p>
</div>
</li>
<li>
<p><strong>Clients</strong></p>
<div class="paragraph">
<p>Specifies which clients have givenGroup-based policy access by this policy.</p>
</div>
</li>
<li>
<p><strong>Logic</strong></p>
<div class="paragraph">
<p>The logic of this policy to apply after the other conditions have been evaluated.</p>
</div>
</li>
</ul>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#_policy_logic">Positive and negative logic</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_policy_group"><a class="anchor" href="#_policy_group"></a>Group-based policy</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/policy-group-policy.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/policy-group-policy.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/policy-group-policy.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>You can use this type of policy to define conditions for your permissions where a set of one or more groups (and their hierarchies) is permitted to access an object.</p>
</div>
<div class="paragraph">
<p>To create a new group-based policy, select <strong>Group</strong> from the policy type list.</p>
</div>
<div class="paragraph">
<div class="title">Group Policy</div>
<p><span class="image"><img src="./images/policy/create-group.png" alt="Add Group Policy"></span></p>
</div>
<div class="sect3">
<h4 id="configuration-6"><a class="anchor" href="#configuration-6"></a>Configuration</h4>
<div class="ulist">
<ul>
<li>
<p><strong>Name</strong></p>
<div class="paragraph">
<p>A human-readable and unique string describing the policy. A best practice is to use names that are closely related to your business and security requirements, so you
can identify them more easily.</p>
</div>
</li>
<li>
<p><strong>Description</strong></p>
<div class="paragraph">
<p>A string containing details about this policy.</p>
</div>
</li>
<li>
<p><strong>Groups Claim</strong></p>
<div class="paragraph">
<p>Specifies the name of the claim in the token holding the group names and/or paths. Usually, authorization requests are processed based on an ID Token or Access Token
previously issued to a client acting on behalf of some user. If defined, the token must include a claim from where this policy is going to obtain the groups
the user is a member of. If not defined, user&#8217;s groups are obtained from your realm configuration.</p>
</div>
</li>
<li>
<p><strong>Groups</strong></p>
<div class="paragraph">
<p>Allows you to select the groups that should be enforced by this policy when evaluating permissions. After adding a group, you can extend access to children of the group
by marking the checkbox <strong>Extend to Children</strong>. If left unmarked, access restrictions only applies to the selected group.</p>
</div>
</li>
<li>
<p><strong>Logic</strong></p>
<div class="paragraph">
<p>The logic of this policy to apply after the other conditions have been evaluated.</p>
</div>
</li>
</ul>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#_policy_logic">Positive and negative logic</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_policy_group_extend_access_children"><a class="anchor" href="#_policy_group_extend_access_children"></a>Extending access to child groups</h4>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/policy-group-policy-extend-children.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/policy-group-policy-extend-children.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/policy-group-policy-extend-children.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>By default, when you add a group to this policy, access restrictions will only apply to members of the selected group.</p>
</div>
<div class="paragraph">
<p>Under some circumstances, it might be necessary to allow access not only to the group itself but to any child group in the hierarchy. For any group
added you can mark a checkbox <strong>Extend to Children</strong> in order to extend access to child groups.</p>
</div>
<div class="paragraph">
<div class="title">Extending access to child groups</div>
<p><span class="image"><img src="./images/policy/create-group-extend-children.png" alt="Extending access to child groups"></span></p>
</div>
<div class="paragraph">
<p>In the example above, the policy is granting access for any user member of <strong>IT</strong> or any of its children.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_policy_client_scope"><a class="anchor" href="#_policy_client_scope"></a>Client scope-based policy</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/policy-client-scope-policy.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/policy-client-scope-policy.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/policy-client-scope-policy.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>You can use this type of policy to define conditions for your permissions where a set of one or more client scopes is permitted to access an object.</p>
</div>
<div class="paragraph">
<p>By default, client scopes added to this policy are not specified as required and the policy will grant access if the client requesting access has been granted any of these client scopes. However, you can specify a specific client scope as <a href="#_policy_client_scope_required">required</a> if you want to enforce a specific client scope.</p>
</div>
<div class="paragraph">
<p>To create a new client scope-based policy, select <strong>Client Scope</strong> from the policy type list.</p>
</div>
<div class="paragraph">
<div class="title">Add Client Scope Policy</div>
<p><span class="image"><img src="./images/policy/create-client-scope.png" alt="Add Client Scope Policy"></span></p>
</div>
<div class="sect3">
<h4 id="configuration-7"><a class="anchor" href="#configuration-7"></a>Configuration</h4>
<div class="ulist">
<ul>
<li>
<p><strong>Name</strong></p>
<div class="paragraph">
<p>A human-readable and unique string describing the policy. A best practice is to use names that are closely related to your business and security requirements, so you can identify them more easily.</p>
</div>
</li>
<li>
<p><strong>Description</strong></p>
<div class="paragraph">
<p>A string containing details about this policy.</p>
</div>
</li>
<li>
<p><strong>Client Scopes</strong></p>
<div class="paragraph">
<p>Specifies which client scopes are permitted by this policy.</p>
</div>
</li>
<li>
<p><strong>Logic</strong></p>
<div class="paragraph">
<p>The logic of this policy to apply after the other conditions have been evaluated.</p>
</div>
</li>
</ul>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#_policy_logic">Positive and negative logic</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_policy_client_scope_required"><a class="anchor" href="#_policy_client_scope_required"></a>Defining a client scope as required</h4>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/policy-client-scope-policy-required-client-scope.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/policy-client-scope-policy-required-client-scope.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/policy-client-scope-policy-required-client-scope.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>When creating a client scope-based policy, you can specify a specific client scope as <code>Required</code>. When you do that, the policy will grant access only if the client requesting access has been granted <strong>all</strong> the <strong>required</strong> client scopes.</p>
</div>
<div class="paragraph">
<div class="title">Example of required client scope</div>
<p><span class="image"><img src="./images/policy/create-client-scope.png" alt="Example of required client scope"></span></p>
</div>
<div class="paragraph">
<p>To specify a client scope as required, select the <code>Required</code> checkbox for the client scope you want to configure as required.</p>
</div>
<div class="paragraph">
<p>Required client scopes can be useful when your policy defines multiple client scopes but only a subset of them are mandatory.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_policy_regex"><a class="anchor" href="#_policy_regex"></a>Regex-Based Policy</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/policy-regex-policy.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/policy-regex-policy.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/policy-regex-policy.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>You can use this type of policy to define regex conditions for your permissions.</p>
</div>
<div class="paragraph">
<p>To create a new regex-based policy, select <strong>Regex</strong> from the policy type list.</p>
</div>
<div class="paragraph">
<p>This policy resolves attributes available from the current identity.</p>
</div>
<div class="paragraph">
<div class="title">Add Regex Policy</div>
<p><span class="image"><img src="./images/policy/create-regex.png" alt="Add Regex Policy"></span></p>
</div>
<div class="sect3">
<h4 id="configuration-8"><a class="anchor" href="#configuration-8"></a>Configuration</h4>
<div class="ulist">
<ul>
<li>
<p><strong>Name</strong></p>
<div class="paragraph">
<p>A human-readable and unique string describing the policy. A best practice is to use names that are closely related to your business and security requirements, so you can identify them more easily.</p>
</div>
</li>
<li>
<p><strong>Description</strong></p>
<div class="paragraph">
<p>A string containing details about this policy.</p>
</div>
</li>
<li>
<p><strong>Target Claim</strong></p>
<div class="paragraph">
<p>Specifies the name of the target claim in the token. For JSON-based claims, you can use dot notation for nesting and square brackets to access array fields by index. For example, contact.address[0].country. If the target claim references a JSON
object, the first path (for example, <code>contact</code>) should map to the attribute name holding the JSON object.</p>
</div>
</li>
<li>
<p><strong>Regex Pattern</strong></p>
<div class="paragraph">
<p>Specifies the regex pattern.</p>
</div>
</li>
<li>
<p><strong>Logic</strong></p>
<div class="paragraph">
<p>The <a href="#_policy_logic">Logic</a> of this policy to apply after the other conditions have been evaluated.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_policy_logic"><a class="anchor" href="#_policy_logic"></a>Positive and negative logic</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/policy-logic.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/policy-logic.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/policy-logic.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>Policies can be configured with positive or negative logic. Briefly, you can use this option to define whether the policy result should be kept as it is or be negated.</p>
</div>
<div class="paragraph">
<p>For example, suppose you want to create a policy where only users <strong>not</strong> granted with a specific role should be given access. In this case,
you can create a role-based policy using that role and set its <strong>Logic</strong> field to <strong>Negative</strong>. If you keep <strong>Positive</strong>, which
is the default behavior, the policy result will be kept as it is.</p>
</div>
</div>
<div class="sect2">
<h3 id="_policy_evaluation_api"><a class="anchor" href="#_policy_evaluation_api"></a>Policy evaluation API</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/policy-evaluation-api.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/policy-evaluation-api.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/policy-evaluation-api.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>When writing rule-based policies using JavaScript, Keycloak provides an Evaluation API that provides useful information to help determine whether a permission should be granted.</p>
</div>
<div class="paragraph">
<p>This API consists of a few interfaces that provide you access to information, such as</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The permission being evaluated, representing both the resource and scopes being requested.</p>
</li>
<li>
<p>The attributes associated with the resource being requested</p>
</li>
<li>
<p>Runtime environment and any other attribute associated with the execution context</p>
</li>
<li>
<p>Information about users such as group membership and roles</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The main interface is <strong>org.keycloak.authorization.policy.evaluation.Evaluation</strong>, which defines the following contract:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Evaluation</span> {

    <span class="comment">/**
     * Returns the {@link ResourcePermission} to be evaluated.
     *
     * @return the permission to be evaluated
     */</span>
    ResourcePermission getPermission();

    <span class="comment">/**
     * Returns the {@link EvaluationContext}. Which provides access to the whole evaluation runtime context.
     *
     * @return the evaluation context
     */</span>
    EvaluationContext getContext();

    <span class="comment">/**
     * Returns a {@link Realm} that can be used by policies to query information.
     *
     * @return a {@link Realm} instance
     */</span>
    Realm getRealm();

    <span class="comment">/**
     * Grants the requested permission to the caller.
     */</span>
    <span class="type">void</span> grant();

    <span class="comment">/**
     * Denies the requested permission.
     */</span>
    <span class="type">void</span> deny();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When processing an authorization request, Keycloak creates an <code>Evaluation</code> instance before evaluating any policy. This instance is then passed to each policy to determine whether access is <strong>GRANT</strong> or <strong>DENY</strong>.</p>
</div>
<div class="paragraph">
<p>Policies determine this by invoking the <code>grant()</code> or <code>deny()</code> methods on an <code>Evaluation</code> instance. By default, the state of the <code>Evaluation</code> instance is denied, which means that your policies must explicitly invoke the <code>grant()</code> method to indicate to the policy evaluation engine that permission should be granted.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://www.keycloak.org/docs/DEV/api_documentation/">JavaDocs Documentation</a>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="the-evaluation-context"><a class="anchor" href="#the-evaluation-context"></a>The evaluation context</h4>
<div class="paragraph">
<p>The evaluation context provides useful information to policies during their evaluation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">EvaluationContext</span> {

    <span class="comment">/**
     * Returns the {@link Identity} that represents an entity (person or non-person) to which the permissions must be granted, or not.
     *
     * @return the identity to which the permissions must be granted, or not
     */</span>
    <span class="predefined-type">Identity</span> getIdentity();

    <span class="comment">/**
     * Returns all attributes within the current execution and runtime environment.
     *
     * @return the attributes within the current execution and runtime environment
     */</span>
    <span class="predefined-type">Attributes</span> getAttributes();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>From this interface, policies can obtain:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The authenticated <code>Identity</code></p>
</li>
<li>
<p>Information about the execution context and runtime environment</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>Identity</code> is built based on the OAuth2 Access Token that was sent along with the authorization request, and this construct has access to all claims
extracted from the original token. For example, if you are using a <em>Protocol Mapper</em> to include a custom claim in an OAuth2 Access Token you can also access this claim
from a policy and use it to build your conditions.</p>
</div>
<div class="paragraph">
<p>The <code>EvaluationContext</code> also gives you access to attributes related to both the execution and runtime environments. For now, there only a few built-in attributes.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Execution and Runtime Attributes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kc.time.date_time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current date and time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String. Format <code>MM/dd/yyyy hh:mm:ss</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kc.client.network.ip_address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IPv4 address of the client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kc.client.network.host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client&#8217;s host name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kc.client.id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The client id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kc.client.user_agent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the 'User-Agent' HTTP header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String[]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kc.realm.name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_permission_overview"><a class="anchor" href="#_permission_overview"></a>Managing permissions</h2>
<div class="sectionbody">
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/permission-overview.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/permission-overview.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/permission-overview.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>A permission associates the object being protected and the policies that must be evaluated to decide whether access should be granted.</p>
</div>
<div class="paragraph">
<p>After creating the resources you want to protect and the policies you want to use to protect these resources,
you can start managing permissions. To manage permissions, click the <strong>Permissions</strong> tab when editing a resource server.</p>
</div>
<div class="paragraph">
<div class="title">Permissions</div>
<p><span class="image"><img src="./images/permission/view.png" alt="Permissions"></span></p>
</div>
<div class="paragraph">
<p>Permissions can be created to protect two main types of objects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Resources</strong></p>
</li>
<li>
<p><strong>Scopes</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To create a permission, select the permission type you want to create from the item list in the upper right corner of the permission listing. The following sections describe these two types of objects in more detail.</p>
</div>
<div class="sect2">
<h3 id="_permission_create_resource"><a class="anchor" href="#_permission_create_resource"></a>Creating resource-based permission</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/permission-create-resource.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/permission-create-resource.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/permission-create-resource.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>A resource-based permission defines a set of one or more resources to protect using a set of one or more authorization policies.</p>
</div>
<div class="paragraph">
<p>To create a new resource-based permission, select <strong>Create resource-based permission</strong> from the <strong>Create permission</strong> dropdown.</p>
</div>
<div class="paragraph">
<div class="title">Add Resource Permission</div>
<p><span class="image"><img src="./images/permission/create-resource.png" alt="Add Resource Permission"></span></p>
</div>
<div class="sect3">
<h4 id="configuration-9"><a class="anchor" href="#configuration-9"></a>Configuration</h4>
<div class="ulist">
<ul>
<li>
<p><strong>Name</strong></p>
<div class="paragraph">
<p>A human-readable and unique string describing the permission. A best practice is to use names that are closely related to your business and security requirements, so you
can identify them more easily.</p>
</div>
</li>
<li>
<p><strong>Description</strong></p>
<div class="paragraph">
<p>A string containing details about this permission.</p>
</div>
</li>
</ul>
</div>
<div id="_permission_create_resource_apply_resource_type" class="ulist">
<ul>
<li>
<p><strong>Apply To Resource Type</strong></p>
<div class="paragraph">
<p>Specifies if the permission is applied to all resources with a given type. When selecting this field, you are prompted to enter the resource type to protect.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Resource Type</p>
<div class="paragraph">
<p>Defines the resource type to protect. When defined, this permission is evaluated for all resources matching that type.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Resources</strong></p>
<div class="paragraph">
<p>Defines a set of one or more resources to protect.</p>
</div>
</li>
<li>
<p><strong>Policy</strong></p>
<div class="paragraph">
<p>Defines a set of one or more policies to associate with a permission. To associate a policy you can either select an existing policy
or create a new one by selecting the type of the policy you want to create.</p>
</div>
</li>
<li>
<p><strong>Decision Strategy</strong></p>
<div class="paragraph">
<p>The <a href="#_permission_decision_strategies">Decision Strategy</a> for this permission.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_permission_typed_resource"><a class="anchor" href="#_permission_typed_resource"></a>Typed resource permission</h4>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/permission-typed-resource-permission.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/permission-typed-resource-permission.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/permission-typed-resource-permission.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>Resource permissions can also be used to define policies that are to be applied to all resources with a given <a href="#_resource_create_type">type</a>. This form of resource-based permission can be useful when you have resources sharing common access requirements and constraints.</p>
</div>
<div class="paragraph">
<p>Frequently, resources within an application can be categorized (or typed) based on the data they encapsulate or the functionality they provide. For example, a financial application can manage different banking accounts where each one belongs to a specific customer. Although they are different banking accounts, they share common security requirements and constraints that are globally defined by the banking organization. With typed resource permissions, you can define common policies to apply to all banking accounts, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only the owner can manage his account</p>
</li>
<li>
<p>Only allow access from the owner&#8217;s country and/or region</p>
</li>
<li>
<p>Enforce a specific authentication method</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To create a typed resource permission, click <a href="#_permission_create_resource_apply_resource_type">Apply to Resource Type</a> when creating a new resource-based permission. With <code>Apply to Resource Type</code> set to <code>On</code>,
you can specify the type that you want to protect as well as the policies that are to be applied to govern access to all resources with type you have specified.</p>
</div>
<div class="paragraph">
<div class="title">Example of a typed resource permission</div>
<p><span class="image"><img src="./images/permission/typed-resource-perm-example.png" alt="Example of a typed resource permission"></span></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_permission_create_scope"><a class="anchor" href="#_permission_create_scope"></a>Creating scope-based permissions</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/permission-create-scope.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/permission-create-scope.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/permission-create-scope.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>A scope-based permission defines a set of one or more scopes to protect using a set of one or more authorization policies. Unlike resource-based permissions, you can use this permission type to create permissions not only for a resource, but also for the scopes associated with it, providing more granularity when defining the permissions that govern your resources and the actions that can be performed on them.</p>
</div>
<div class="paragraph">
<p>To create a new scope-based permission, select <strong>Create scope-based permission</strong> from the <strong>Create permission</strong> dropdown.</p>
</div>
<div class="paragraph">
<div class="title">Add Scope Permission</div>
<p><span class="image"><img src="./images/permission/create-scope.png" alt="Add Scope Permission"></span></p>
</div>
<div class="sect3">
<h4 id="configuration-10"><a class="anchor" href="#configuration-10"></a>Configuration</h4>
<div class="ulist">
<ul>
<li>
<p><strong>Name</strong></p>
<div class="paragraph">
<p>A human-readable and unique string describing the permission. A best practice is to use names that are closely related to your business and security requirements, so you
can identify them more easily.</p>
</div>
</li>
<li>
<p><strong>Description</strong></p>
<div class="paragraph">
<p>A string containing details about this permission.</p>
</div>
</li>
<li>
<p><strong>Resource</strong></p>
<div class="paragraph">
<p>Restricts the scopes to those associated with the selected resource. If none is selected, all scopes are available.</p>
</div>
</li>
<li>
<p><strong>Scopes</strong></p>
<div class="paragraph">
<p>Defines a set of one or more scopes to protect.</p>
</div>
</li>
<li>
<p><strong>Policy</strong></p>
<div class="paragraph">
<p>Defines a set of one or more policies to associate with a permission. To associate a policy you can either select an existing policy
or create a new one by selecting the type of the policy you want to create.</p>
</div>
</li>
<li>
<p><strong>Decision Strategy</strong></p>
<div class="paragraph">
<p>The <a href="#_permission_decision_strategies">Decision Strategy</a> for this permission.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_permission_decision_strategies"><a class="anchor" href="#_permission_decision_strategies"></a>Policy decision strategies</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/permission-decision-strategy.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/permission-decision-strategy.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/permission-decision-strategy.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>When associating policies with a permission, you can also define a decision strategy to specify how to evaluate the outcome of the associated policies to determine access.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Unanimous</strong></p>
<div class="paragraph">
<p>The default strategy if none is provided. In this case, <em>all</em> policies must evaluate to a positive decision for the final decision to be also positive.</p>
</div>
</li>
<li>
<p><strong>Affirmative</strong></p>
<div class="paragraph">
<p>In this case, <em>at least one</em> policy must evaluate to a positive decision for the final decision to be also positive.</p>
</div>
</li>
<li>
<p><strong>Consensus</strong></p>
<div class="paragraph">
<p>In this case, the number of positive decisions must be greater than the number of negative decisions. If the number of positive and negative decisions is equal, the final decision will be negative.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_policy_evaluation_overview"><a class="anchor" href="#_policy_evaluation_overview"></a>Evaluating and testing policies</h2>
<div class="sectionbody">
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/policy-evaluation-tool-overview.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/policy-evaluation-tool-overview.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/policy-evaluation-tool-overview.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>When designing your policies, you can simulate authorization requests to test how your policies are being evaluated.</p>
</div>
<div class="paragraph">
<p>You can access the Policy Evaluation Tool by clicking the <code>Evaluate</code> tab when editing a resource server. There you can specify different inputs to simulate real authorization requests and test the effect of your policies.</p>
</div>
<div class="paragraph">
<div class="title">Policy evaluation tool</div>
<p><span class="image"><img src="./images/policy-evaluation-tool/policy-evaluation-tool.png" alt="Policy evaluation tool"></span></p>
</div>
<div class="sect2">
<h3 id="providing-identity-information"><a class="anchor" href="#providing-identity-information"></a>Providing identity information</h3>
<div class="paragraph">
<p>The <strong>Identity Information</strong> filters can be used to specify the user requesting permissions.</p>
</div>
</div>
<div class="sect2">
<h3 id="providing-contextual-information"><a class="anchor" href="#providing-contextual-information"></a>Providing contextual information</h3>
<div class="paragraph">
<p>The <strong>Contextual Information</strong> filters can be used to define additional attributes to the evaluation context, so that policies can obtain these same attributes.</p>
</div>
</div>
<div class="sect2">
<h3 id="providing-the-permissions"><a class="anchor" href="#providing-the-permissions"></a>Providing the permissions</h3>
<div class="paragraph">
<p>The <strong>Permissions</strong> filters can be used to build an authorization request. You can request permissions for a set of one or more resources and scopes. If you want
to simulate authorization requests based on all protected resources and scopes, click <strong>Add</strong> without specifying any <code>Resources</code> or <code>Scopes</code>.</p>
</div>
<div class="paragraph">
<p>When you&#8217;ve specified your desired values, click <strong>Evaluate</strong>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_service_overview"><a class="anchor" href="#_service_overview"></a>Authorization services</h2>
<div class="sectionbody">
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/service-overview.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/service-overview.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/service-overview.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>Keycloak Authorization Services are built on top of well-known standards such as the OAuth2 and User-Managed Access specifications.</p>
</div>
<div class="paragraph">
<p>OAuth2 clients (such as front end applications) can obtain access tokens from the server using the token endpoint and use
these same tokens to access resources protected by a resource server (such as back end services). In the same way,
Keycloak Authorization Services provide extensions to OAuth2 to allow access tokens to be issued based on the processing
of all policies associated with the resource(s) or scope(s) being requested. This means that resource servers can enforce access
to their protected resources based on the permissions granted by the server and held by an access token. In Keycloak Authorization Services
the access token with permissions is called a Requesting Party Token or RPT for short.</p>
</div>
<div class="paragraph">
<p>In addition to the issuance of RPTs, Keycloak Authorization Services also provides a set of RESTful endpoints that allow resources servers to manage their protected
resources, scopes, permissions and policies, helping developers to extend or integrate these capabilities into their applications in order to support fine-grained authorization.</p>
</div>
<div class="sect2">
<h3 id="_service_authorization_api"><a class="anchor" href="#_service_authorization_api"></a>Discovering authorization services endpoints and metadata</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/service-authorization-discovery-document.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/service-authorization-discovery-document.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/service-authorization-discovery-document.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>Keycloak provides a discovery document from which clients can obtain all necessary information to interact with
Keycloak Authorization Services, including endpoint locations and capabilities.</p>
</div>
<div class="paragraph">
<p>The discovery document can be obtained from:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X GET \
  http://${host}:${port}/realms/${realm}/.well-known/uma2-configuration</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>${host}:${port}</code> is the hostname (or IP address) and port where Keycloak is running and <code>${realm}</code> is the name of
a realm in Keycloak.</p>
</div>
<div class="paragraph">
<p>As a result, you should get a response as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{

    <span class="error">/</span><span class="error">/</span> <span class="error">s</span><span class="error">o</span><span class="error">m</span><span class="error">e</span> <span class="error">c</span><span class="error">l</span><span class="error">a</span><span class="error">i</span><span class="error">m</span><span class="error">s</span> <span class="error">a</span><span class="error">r</span><span class="error">e</span> <span class="error">e</span><span class="error">x</span><span class="error">p</span><span class="error">e</span><span class="error">c</span><span class="error">t</span><span class="error">e</span><span class="error">d</span> <span class="error">h</span><span class="error">e</span><span class="error">r</span><span class="error">e</span>

    <span class="error">/</span><span class="error">/</span> <span class="error">t</span><span class="error">h</span><span class="error">e</span><span class="error">s</span><span class="error">e</span> <span class="error">a</span><span class="error">r</span><span class="error">e</span> <span class="error">t</span><span class="error">h</span><span class="error">e</span> <span class="error">m</span><span class="error">a</span><span class="error">i</span><span class="error">n</span> <span class="error">c</span><span class="error">l</span><span class="error">a</span><span class="error">i</span><span class="error">m</span><span class="error">s</span> <span class="error">i</span><span class="error">n</span> <span class="error">t</span><span class="error">h</span><span class="error">e</span> <span class="error">d</span><span class="error">i</span><span class="error">s</span><span class="error">c</span><span class="error">o</span><span class="error">v</span><span class="error">e</span><span class="error">r</span><span class="error">y</span> <span class="error">d</span><span class="error">o</span><span class="error">c</span><span class="error">u</span><span class="error">m</span><span class="error">e</span><span class="error">n</span><span class="error">t</span> <span class="error">a</span><span class="error">b</span><span class="error">o</span><span class="error">u</span><span class="error">t</span> <span class="error">A</span><span class="error">u</span><span class="error">t</span><span class="error">h</span><span class="error">o</span><span class="error">r</span><span class="error">i</span><span class="error">z</span><span class="error">a</span><span class="error">t</span><span class="error">i</span><span class="error">o</span><span class="error">n</span> <span class="error">S</span><span class="error">e</span><span class="error">r</span><span class="error">v</span><span class="error">i</span><span class="error">c</span><span class="error">e</span><span class="error">s</span> <span class="error">e</span><span class="error">n</span><span class="error">d</span><span class="error">p</span><span class="error">o</span><span class="error">i</span><span class="error">n</span><span class="error">t</span><span class="error">s</span> <span class="error">l</span><span class="error">o</span><span class="error">c</span><span class="error">a</span><span class="error">t</span><span class="error">i</span><span class="error">o</span><span class="error">n</span>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">token_endpoint</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://${host}:${port}/realms/${realm}/protocol/openid-connect/token</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">token_introspection_endpoint</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://${host}:${port}/realms/${realm}/protocol/openid-connect/token/introspect</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">resource_registration_endpoint</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://${host}:${port}/realms/${realm}/authz/protection/resource_set</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">permission_endpoint</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://${host}:${port}/realms/${realm}/authz/protection/permission</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">policy_endpoint</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://${host}:${port}/realms/${realm}/authz/protection/uma-policy</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each of these endpoints expose a specific set of capabilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>token_endpoint</strong></p>
<div class="paragraph">
<p>A OAuth2-compliant Token Endpoint that supports the <code>urn:ietf:params:oauth:grant-type:uma-ticket</code> grant type. Through this
endpoint clients can send authorization requests and obtain an RPT with all permissions granted by Keycloak.</p>
</div>
</li>
<li>
<p><strong>token_introspection_endpoint</strong></p>
<div class="paragraph">
<p>A OAuth2-compliant Token Introspection Endpoint which clients can use to query the server to determine the active state of an RPT
and to determine any other information associated with the token, such as the permissions granted by Keycloak.</p>
</div>
</li>
<li>
<p><strong>resource_registration_endpoint</strong></p>
<div class="paragraph">
<p>A UMA-compliant Resource Registration Endpoint which resource servers can use to manage their protected resources and scopes. This endpoint provides
operations create, read, update and delete resources and scopes in Keycloak.</p>
</div>
</li>
<li>
<p><strong>permission_endpoint</strong></p>
<div class="paragraph">
<p>A UMA-compliant Permission Endpoint which resource servers can use to manage permission tickets. This endpoint provides
operations create, read, update, and delete permission tickets in Keycloak.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_service_obtaining_permissions"><a class="anchor" href="#_service_obtaining_permissions"></a>Obtaining permissions</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/service-authorization-obtaining-permission.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/service-authorization-obtaining-permission.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/service-authorization-obtaining-permission.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>To obtain permissions from Keycloak you send an authorization request to the token endpoint. As a result, Keycloak will
evaluate all policies associated with the resource(s) and scope(s) being requested and issue an RPT with all permissions
granted by the server.</p>
</div>
<div class="paragraph">
<p>Clients are allowed to send authorization requests to the token endpoint using the following parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>grant_type</strong></p>
<div class="paragraph">
<p>This parameter is <strong>required</strong>. Must be <code>urn:ietf:params:oauth:grant-type:uma-ticket</code>.</p>
</div>
</li>
<li>
<p><strong>ticket</strong></p>
<div class="paragraph">
<p>This parameter is <strong>optional</strong>. The most recent permission ticket received by the client as part of the UMA authorization process.</p>
</div>
</li>
<li>
<p><strong>claim_token</strong></p>
<div class="paragraph">
<p>This parameter is <strong>optional</strong>. A string representing additional claims that should be considered by the server when evaluating
permissions for the resource(s) and scope(s) being requested. This parameter allows clients to push claims to Keycloak. For more details about all supported token formats see <code>claim_token_format</code> parameter.</p>
</div>
</li>
<li>
<p><strong>claim_token_format</strong></p>
<div class="paragraph">
<p>This parameter is <strong>optional</strong>. A string indicating the format of the token specified in the <code>claim_token</code> parameter. Keycloak supports two token
formats: <code>urn:ietf:params:oauth:token-type:jwt</code> and <code><a href="https://openid.net/specs/openid-connect-core-1_0.html#IDToken" class="bare">https://openid.net/specs/openid-connect-core-1_0.html#IDToken</a></code>. The <code>urn:ietf:params:oauth:token-type:jwt</code> format
indicates that the <code>claim_token</code> parameter references an access token. The <code><a href="https://openid.net/specs/openid-connect-core-1_0.html#IDToken" class="bare">https://openid.net/specs/openid-connect-core-1_0.html#IDToken</a></code> indicates that the
<code>claim_token</code> parameter references an OpenID Connect ID Token.</p>
</div>
</li>
<li>
<p><strong>rpt</strong></p>
<div class="paragraph">
<p>This parameter is <strong>optional</strong>. A previously issued RPT which permissions should also be evaluated and added in a new one. This parameter
allows clients in possession of an RPT to perform incremental authorization where permissions are added on demand.</p>
</div>
</li>
<li>
<p><strong>permission</strong></p>
<div class="paragraph">
<p>This parameter is <strong>optional</strong>. A string representing a set of one or more resources and scopes the client is seeking access. This parameter can be defined multiple times
in order to request permission for multiple resource and scopes. This parameter is an extension to <code>urn:ietf:params:oauth:grant-type:uma-ticket</code> grant type in order to allow clients to send authorization requests without a
permission ticket. The format of the string must be: <code>RESOURCE_ID#SCOPE_ID</code>. For instance: <code>Resource A#Scope A</code>, <code>Resource A#Scope A, Scope B, Scope C</code>, <code>Resource A</code>, <code>#Scope A</code>.</p>
</div>
</li>
<li>
<p><strong>permission_resource_format</strong></p>
<div class="paragraph">
<p>This parameter is <strong>optional</strong>. A string representing a format indicating the resource in the <code>permission</code> parameter. Possible values are <code>id</code> and <code>uri</code>. <code>id</code> indicates the format is <code>RESOURCE_ID</code>. <code>uri</code> indicates the format is <code>URI</code>. If not specified, the default is <code>id</code>.</p>
</div>
</li>
<li>
<p><strong>permission_resource_matching_uri</strong></p>
<div class="paragraph">
<p>This parameter is <strong>optional</strong>. A boolean value that indicates whether to use path matching when representing resources in URI format in the <code>permission</code> parameter. If not specified, the default is false.</p>
</div>
</li>
<li>
<p><strong>audience</strong></p>
<div class="paragraph">
<p>This parameter is <strong>optional</strong>. The client identifier of the resource server to which the client is seeking access. This parameter is mandatory
in case the <code>permission</code> parameter is defined. It serves as a hint to Keycloak to indicate the context in which permissions should be evaluated.</p>
</div>
</li>
<li>
<p><strong>response_include_resource_name</strong></p>
<div class="paragraph">
<p>This parameter is <strong>optional</strong>. A boolean value indicating to the server whether resource names should be included in the RPT&#8217;s permissions. If false, only the resource
identifier is included.</p>
</div>
</li>
<li>
<p><strong>response_permissions_limit</strong></p>
<div class="paragraph">
<p>This parameter is <strong>optional</strong>. An integer N that defines a limit for the amount of permissions an RPT can have. When used together with
<code>rpt</code> parameter, only the last N requested permissions will be kept in the RPT.</p>
</div>
</li>
<li>
<p><strong>submit_request</strong></p>
<div class="paragraph">
<p>This parameter is <strong>optional</strong>. A boolean value indicating whether the server should create permission requests to the resources and scopes referenced by a permission ticket.
This parameter only has effect if used together with the <code>ticket</code> parameter as part of a UMA authorization process.</p>
</div>
</li>
<li>
<p><strong>response_mode</strong></p>
<div class="paragraph">
<p>This parameter is <strong>optional</strong>. A string value indicating how the server should respond to authorization requests. This parameter is specially useful when
you are mainly interested in either the overall decision or the permissions granted by the server, instead of a standard OAuth2 response. Possible values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>decision</code></p>
<div class="paragraph">
<p>Indicates that responses from the server should only represent the overall decision by returning a JSON with the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="error">'</span><span class="error">r</span><span class="error">e</span><span class="error">s</span><span class="error">u</span><span class="error">l</span><span class="error">t</span><span class="error">'</span>: <span class="value">true</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the authorization request does not map to any permission, a <code>403</code> HTTP status code is returned instead.</p>
</div>
</li>
<li>
<p><code>permissions</code></p>
<div class="paragraph">
<p>Indicates that responses from the server should contain any permission granted by the server by returning a JSON with the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[
    {
        <span class="error">'</span><span class="error">r</span><span class="error">s</span><span class="error">i</span><span class="error">d</span><span class="error">'</span>: <span class="error">'</span><span class="error">M</span><span class="error">y</span> <span class="error">R</span><span class="error">e</span><span class="error">s</span><span class="error">o</span><span class="error">u</span><span class="error">r</span><span class="error">c</span><span class="error">e</span><span class="error">'</span>
        <span class="error">'</span><span class="error">s</span><span class="error">c</span><span class="error">o</span><span class="error">p</span><span class="error">e</span><span class="error">s</span><span class="error">'</span>: [<span class="error">'</span><span class="error">v</span><span class="error">i</span><span class="error">e</span><span class="error">w</span><span class="error">'</span>, <span class="error">'</span><span class="error">u</span><span class="error">p</span><span class="error">d</span><span class="error">a</span><span class="error">t</span><span class="error">e</span><span class="error">'</span>]
    },

    <span class="error">.</span><span class="error">.</span><span class="error">.</span>
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the authorization request does not map to any permission, a <code>403</code> HTTP status code is returned instead.</p>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example of an authorization request when a client is seeking access to two resources protected by a resource server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X POST \
  http://${host}:${port}/realms/${realm}/protocol/openid-connect/token \
  -H &quot;Authorization: Bearer ${access_token}&quot; \
  --data &quot;grant_type=urn:ietf:params:oauth:grant-type:uma-ticket&quot; \
  --data &quot;audience={resource_server_client_id}&quot; \
  --data &quot;permission=Resource A#Scope A&quot; \
  --data &quot;permission=Resource B#Scope B&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example of an authorization request when a client is seeking access to any resource and scope protected by a resource server.
NOTE: This will not evaluate the permissions for all resources. Instead, the permissions for resources owned by the resource server, owned by the requesting user,
and explicitly granted to the requesting user by other owners are evaluated.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X POST \
  http://${host}:${port}/realms/${realm}/protocol/openid-connect/token \
  -H &quot;Authorization: Bearer ${access_token}&quot; \
  --data &quot;grant_type=urn:ietf:params:oauth:grant-type:uma-ticket&quot; \
  --data &quot;audience={resource_server_client_id}&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example of an authorization request when a client is seeking access to a UMA protected resource after receiving a permission ticket from
the resource server as part of the authorization process:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X POST \
  http://${host}:${port}/realms/${realm}/protocol/openid-connect/token \
  -H &quot;Authorization: Bearer ${access_token}&quot; \
  --data &quot;grant_type=urn:ietf:params:oauth:grant-type:uma-ticket&quot; \
  --data &quot;ticket=${permission_ticket}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If Keycloak assessment process results in issuance of permissions, it issues the RPT with which it has associated
the permissions:</p>
</div>
<div class="listingblock">
<div class="title">Keycloak responds to the client with the RPT</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">HTTP/1.1 200 OK
Content-Type: application/json
...
{
    &quot;access_token&quot;: &quot;${rpt}&quot;,
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The response from the server is just like any other response from the token endpoint when using some other grant type. The RPT can be obtained from
the <code>access_token</code> response parameter. If the client is not authorized, Keycloak responds with a <code>403</code> HTTP status code:</p>
</div>
<div class="listingblock">
<div class="title">Keycloak denies the authorization request</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">HTTP/1.1 403 Forbidden
Content-Type: application/json
...
{
    &quot;error&quot;: &quot;access_denied&quot;,
    &quot;error_description&quot;: &quot;request_denied&quot;
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_authentication_methods"><a class="anchor" href="#_authentication_methods"></a>Client authentication methods</h4>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/service-authorization-obtaining-permission-authentication.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/service-authorization-obtaining-permission-authentication.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/service-authorization-obtaining-permission-authentication.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>Clients need to authenticate to the token endpoint in order to obtain an RPT. When using the <code>urn:ietf:params:oauth:grant-type:uma-ticket</code>
grant type, clients can use any of these authentication methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Bearer Token</strong></p>
<div class="paragraph">
<p>Clients should send an access token as a Bearer credential in an HTTP Authorization header to the token endpoint.</p>
</div>
<div class="listingblock">
<div class="title">Example: an authorization request using an access token to authenticate to the token endpoint</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X POST \
  http://${host}:${port}/realms/${realm}/protocol/openid-connect/token \
  -H &quot;Authorization: Bearer ${access_token}&quot; \
  --data &quot;grant_type=urn:ietf:params:oauth:grant-type:uma-ticket&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method is especially useful when the client is acting on behalf of a user.
In this case, the bearer token is an access token previously issued by Keycloak to some client acting on behalf
of a user (or on behalf of itself). Permissions will be evaluated considering the access context represented by the access token.
For instance, if the access token was issued to Client A acting on behalf of User A, permissions will be granted depending on
the resources and scopes to which User A has access.</p>
</div>
</li>
<li>
<p><strong>Client Credentials</strong></p>
<div class="paragraph">
<p>Clients can use any of the client authentication methods supported by Keycloak. For instance, client_id/client_secret or JWT.</p>
</div>
<div class="listingblock">
<div class="title">Example: an authorization request using client id and client secret to authenticate to the token endpoint</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X POST \
  http://${host}:${port}/realms/${realm}/protocol/openid-connect/token \
  -H &quot;Authorization: Basic cGhvdGg6L7Jl13RmfWgtkk==pOnNlY3JldA==&quot; \
  --data &quot;grant_type=urn:ietf:params:oauth:grant-type:uma-ticket&quot;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_service_pushing_claims"><a class="anchor" href="#_service_pushing_claims"></a>Pushing claims</h4>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/service-authorization-pushing-claims.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/service-authorization-pushing-claims.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/service-authorization-pushing-claims.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>When obtaining permissions from the server you can push arbitrary claims in order to have these
claims available to your policies when evaluating permissions.</p>
</div>
<div class="paragraph">
<p>If you are obtaining permissions from the server <strong>without</strong> using a permission ticket (UMA flow), you can send
an authorization request to the token endpoint as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X POST \
  http://${host}:${port}/realms/${realm}/protocol/openid-connect/token \
  --data &quot;grant_type=urn:ietf:params:oauth:grant-type:uma-ticket&quot; \
  --data &quot;claim_token=ewogICAib3JnYW5pemF0aW9uIjogWyJhY21lIl0KfQ==&quot; \
  --data &quot;claim_token_format=urn:ietf:params:oauth:token-type:jwt&quot; \
  --data &quot;client_id={resource_server_client_id}&quot; \
  --data &quot;client_secret={resource_server_client_secret}&quot; \
  --data &quot;audience={resource_server_client_id}&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>claim_token</code> parameter expects a BASE64 encoded JSON with a format similar to the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">organization</span><span class="delimiter">&quot;</span></span> : [<span class="string"><span class="delimiter">&quot;</span><span class="content">acme</span><span class="delimiter">&quot;</span></span>]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The format expects one or more claims where the value for each claim must be an array of strings.</p>
</div>
<div class="sect4">
<h5 id="pushing-claims-using-uma"><a class="anchor" href="#pushing-claims-using-uma"></a>Pushing claims Using UMA</h5>
<div class="paragraph">
<p>For more details about how to push claims when using UMA and permission tickets, please take a look at <a href="#_service_protection_permission_api_papi">Permission API</a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_service_user_managed_access"><a class="anchor" href="#_service_user_managed_access"></a>User-managed access</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/service-authorization-obtaining-permission-uma.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/service-authorization-obtaining-permission-uma.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/service-authorization-obtaining-permission-uma.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>Keycloak Authorization Services is based on User-Managed Access or UMA for short. UMA is a specification that
enhances OAuth2 capabilities in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Privacy</strong></p>
<div class="paragraph">
<p>Nowadays, user privacy is becoming a huge concern, as more and more data and devices are available and connected to the cloud. With
UMA and Keycloak, resource servers can enhance their capabilities in order to improve how their resources are protected in respect
to user privacy where permissions are granted based on policies defined by the user.</p>
</div>
</li>
<li>
<p><strong>Party-to-Party Authorization</strong></p>
<div class="paragraph">
<p>Resource owners (e.g.: regular end-users) can manage access to their resources and authorize other parties (e.g: regular end-users)
to access these resources. This is different than OAuth2 where consent is given to a client application acting on behalf of a user, with UMA
resource owners are allowed to consent access to other users, in a completely asynchronous manner.</p>
</div>
</li>
<li>
<p><strong>Resource Sharing</strong></p>
<div class="paragraph">
<p>Resource owners are allowed to manage permissions to their resources and decide who can access a particular resource and how.
Keycloak can then act as a sharing management service from which resource owners can manage their resources.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Keycloak is a UMA 2.0 compliant authorization server that provides most UMA capabilities.</p>
</div>
<div class="paragraph">
<p>As an example, consider a user Alice (resource owner) using an Internet Banking Service (resource server) to manage her Bank Account (resource). One day, Alice decides
to open her bank account to Bob (requesting party), an accounting professional. However, Bob should only have access to view (scope) Alice&#8217;s account.</p>
</div>
<div class="paragraph">
<p>As a resource server, the Internet Banking Service must be able to protect Alice&#8217;s Bank Account. For that, it relies on Keycloak
Resource Registration Endpoint to create a resource in the server representing Alice&#8217;s Bank Account.</p>
</div>
<div class="paragraph">
<p>At this moment, if Bob tries to access Alice&#8217;s Bank Account, access will be denied. The Internet Banking Service defines a few default
policies for banking accounts. One of them is that only the owner, in this case Alice, is allowed to access her bank account.</p>
</div>
<div class="paragraph">
<p>However, Internet Banking Service in respect to Alice&#8217;s privacy also allows her to change specific policies for the banking account. One of these
policies that she can change is to define which people are allowed to view her bank account. For that, Internet Banking Service relies on Keycloak
to provide to Alice a space where she can select individuals and the operations (or data) they are allowed to access. At any time, Alice
can revoke access or grant additional permissions to Bob.</p>
</div>
<div class="sect3">
<h4 id="_service_uma_authorization_process"><a class="anchor" href="#_service_uma_authorization_process"></a>Authorization process</h4>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/service-authorization-uma-authz-process.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/service-authorization-uma-authz-process.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/service-authorization-uma-authz-process.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>In UMA, the authorization process starts when a client tries to access a UMA protected resource server.</p>
</div>
<div class="paragraph">
<p>A UMA protected resource server expects a bearer token in the request where the token is an RPT. When a client requests
a resource at the resource server without an RPT:</p>
</div>
<div class="listingblock">
<div class="title">Client requests a protected resource without sending an RPT</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X GET \
  http://${host}:${port}/my-resource-server/resource/1bfdfe78-a4e1-4c2d-b142-fc92b75b986f</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resource server sends a response back to the client with a permission <code>ticket</code> and a <code>as_uri</code> parameter with the location
of a Keycloak server to where the ticket should be sent in order to obtain an RPT.</p>
</div>
<div class="listingblock">
<div class="title">Resource server responds with a permission ticket</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">HTTP/1.1 401 Unauthorized
WWW-Authenticate: UMA realm=&quot;${realm}&quot;,
    as_uri=&quot;https://${host}:${port}/realms/${realm}&quot;,
    ticket=&quot;016f84e8-f9b9-11e0-bd6f-0021cc6004de&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The permission ticket is a special type of token issued by Keycloak Permission API. They represent the permissions being requested (e.g.: resources and scopes)
as well any other information associated with the request. Only resource servers are allowed to create those tokens.</p>
</div>
<div class="paragraph">
<p>Now that the client has a permission ticket and also the location of a Keycloak server, the client can use the discovery document
to obtain the location of the token endpoint and send an authorization request.</p>
</div>
<div class="listingblock">
<div class="title">Client sends an authorization request to the token endpoint to obtain an RPT</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X POST \
  http://${host}:${port}/realms/${realm}/protocol/openid-connect/token \
  -H &quot;Authorization: Bearer ${access_token}&quot; \
  --data &quot;grant_type=urn:ietf:params:oauth:grant-type:uma-ticket&quot; \
  --data &quot;ticket=${permission_ticket}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If Keycloak assessment process results in issuance of permissions, it issues the RPT with which it has associated
the permissions:</p>
</div>
<div class="listingblock">
<div class="title">Keycloak responds to the client with the RPT</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">HTTP/1.1 200 OK
Content-Type: application/json
...
{
    &quot;access_token&quot;: &quot;${rpt}&quot;,
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The response from the server is just like any other response from the token endpoint when using some other grant type. The RPT can be obtained from
the <code>access_token</code> response parameter. In case the client is not authorized to have permissions Keycloak responds with a <code>403</code> HTTP status code:</p>
</div>
<div class="listingblock">
<div class="title">Keycloak denies the authorization request</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">HTTP/1.1 403 Forbidden
Content-Type: application/json
...
{
    &quot;error&quot;: &quot;access_denied&quot;,
    &quot;error_description&quot;: &quot;request_denied&quot;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_service_authorization_aat"><a class="anchor" href="#_service_authorization_aat"></a>Submitting permission requests</h4>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/service-authorization-uma-submiting-permission-requests.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/service-authorization-uma-submiting-permission-requests.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/service-authorization-uma-submiting-permission-requests.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>As part of the authorization process, clients need first to obtain a permission ticket from a UMA protected resource server in order
to exchange it with an RPT at the Keycloak Token Endpoint.</p>
</div>
<div class="paragraph">
<p>By default, Keycloak responds with a <code>403</code> HTTP status code and a <code>request_denied</code> error in case the client can not be issued with an RPT.</p>
</div>
<div class="listingblock">
<div class="title">Keycloak denies the authorization request</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">HTTP/1.1 403 Forbidden
Content-Type: application/json
...
{
    &quot;error&quot;: &quot;access_denied&quot;,
    &quot;error_description&quot;: &quot;request_denied&quot;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Such response implies that Keycloak could not issue an RPT with the permissions represented by a permission ticket.</p>
</div>
<div class="paragraph">
<p>In some situations, client applications may want to start an asynchronous authorization flow and let the owner of the resources
being requested decide whether or not access should be granted. For that, clients can use the <code>submit_request</code> request parameter along
with an authorization request to the token endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X POST \
  http://${host}:${port}/realms/${realm}/protocol/openid-connect/token \
  -H &quot;Authorization: Bearer ${access_token}&quot; \
  --data &quot;grant_type=urn:ietf:params:oauth:grant-type:uma-ticket&quot; \
  --data &quot;ticket=${permission_ticket} \
  --data &quot;submit_request=true&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using the <code>submit_request</code> parameter, Keycloak will persist a permission request for each resource to which access was denied.
Once created, resource owners can check their account and manage their permissions requests.</p>
</div>
<div class="paragraph">
<p>You can think about this functionality as a <code>Request Access</code> button in your application, where users can ask other users for access to their resources.</p>
</div>
</div>
<div class="sect3">
<h4 id="_service_authorization_my_resources"><a class="anchor" href="#_service_authorization_my_resources"></a>Managing access to users resources</h4>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/service-authorization-uma-account-my-resources.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/service-authorization-uma-account-my-resources.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/service-authorization-uma-account-my-resources.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>Users can manage access to their resources using the Keycloak Account Console. To enable
this functionality, you must first enable User-Managed Access for your realm.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log into the Admin Console.</p>
</li>
<li>
<p>Click <strong>Realm Settings</strong> in the menu.</p>
</li>
<li>
<p>Toggle <strong>User-Managed Access</strong> to <strong>ON</strong>.</p>
</li>
<li>
<p>Click the user name at the top right of the Admin Console and select <strong>Manage Account</strong>.</p>
<div class="paragraph">
<p><span class="image"><img src="./images/service/account-my-resource.png" alt="My Resources"></span></p>
</div>
</li>
<li>
<p>Click <strong>My Resources</strong> in the menu option. A page displays with the following options.</p>
<div class="ulist">
<ul>
<li>
<p>Manage <strong>My resources</strong></p>
<div class="paragraph">
<p>This section contains a list of all resources owned by the user. Users can click on a resource for more details
and share the resource with others.
When there is a permission requests awaiting approval an icon is put next to the name of the resource.
These requests are connected to the parties (users) requesting access to a particular resource.
Users are allowed to approve or deny these requests. You can do so by clicking the icon</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/service/account-my-resource-detail.png" alt="Resource Detail"></span></p>
</div>
</li>
<li>
<p>Manage <strong>Resources shared with me</strong></p>
<div class="paragraph">
<p>This section contains a list of all resources shared with the user.</p>
</div>
</li>
<li>
<p>Manage <strong>People with access to this resource</strong></p>
<div class="paragraph">
<p>This section contains a list of people with access to this resource. Users are allowed to revoke access by clicking
on the <code>Revoke</code> button or by removing a specific <code>Permission</code>.</p>
</div>
</li>
<li>
<p>Share the resource with others</p>
<div class="paragraph">
<p>By typing the username or e-mail of another user, the user is able to share the resource and select the permissions he wants to grant access.</p>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_service_protection_api"><a class="anchor" href="#_service_protection_api"></a>Protection API</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/service-protection-protection-api.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/service-protection-protection-api.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/service-protection-protection-api.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>The Protection API provides a UMA-compliant set of endpoints providing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Resource Management</strong></p>
<div class="paragraph">
<p>With this endpoint, resource servers can manage their resources remotely and enable policy enforcers to query the server for the resources that need protection.</p>
</div>
</li>
<li>
<p><strong>Permission Management</strong></p>
<div class="paragraph">
<p>In the UMA protocol, resource servers access this endpoint to create permission tickets. Keycloak also provides
endpoints to manage the state of permissions and query permissions.</p>
</div>
</li>
<li>
<p><strong>Policy API</strong></p>
<div class="paragraph">
<p>Keycloak leverages the UMA Protection API to allow resource servers to manage permissions for their users. In addition
to the Resource and Permission APIs, Keycloak provides a Policy API from where permissions can be set to resources by resource
servers on behalf of their users.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>An important requirement for this API is that <em>only</em> resource servers are allowed to access its endpoints using a special OAuth2 access token called a protection API token (PAT).
In UMA, a PAT is a token with the scope <strong>uma_protection</strong>.</p>
</div>
<div class="sect3">
<h4 id="_service_protection_whatis_obtain_pat"><a class="anchor" href="#_service_protection_whatis_obtain_pat"></a>What is a PAT and how to obtain it</h4>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/service-protection-whatis-obtain-pat.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/service-protection-whatis-obtain-pat.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/service-protection-whatis-obtain-pat.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>A <strong>protection API token</strong> (PAT) is a special OAuth2 access token with a scope defined as  <strong>uma_protection</strong>. When you create a resource server, Keycloak automatically
creates a role, <em>uma_protection</em>, for the corresponding client application and associates it with the client&#8217;s service account.</p>
</div>
<div class="paragraph">
<div class="title">Service Account granted with <strong>uma_protection</strong> role</div>
<p><span class="image"><img src="./images/service/rs-uma-protection-role.png" alt="Service Account granted with uma_protection role"></span></p>
</div>
<div class="paragraph">
<p>Resource servers can obtain a PAT from Keycloak like any other OAuth2 access token. For example, using curl:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X POST \
    -H &quot;Content-Type: application/x-www-form-urlencoded&quot; \
    -d 'grant_type=client_credentials&amp;client_id=${client_id}&amp;client_secret=${client_secret}' \
    &quot;http://${host}:${port}/realms/${realm_name}/protocol/openid-connect/token&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above is using the <strong>client_credentials</strong> grant type to obtain a PAT from the server. As a result, the server returns a response similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">access_token</span><span class="delimiter">&quot;</span></span>: <span class="error">$</span>{<span class="error">P</span><span class="error">A</span><span class="error">T</span>},
  <span class="key"><span class="delimiter">&quot;</span><span class="content">expires_in</span><span class="delimiter">&quot;</span></span>: <span class="integer">300</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">refresh_expires_in</span><span class="delimiter">&quot;</span></span>: <span class="integer">1800</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">refresh_token</span><span class="delimiter">&quot;</span></span>: <span class="error">$</span>{<span class="error">r</span><span class="error">e</span><span class="error">f</span><span class="error">r</span><span class="error">e</span><span class="error">s</span><span class="error">h</span><span class="error">_</span><span class="error">t</span><span class="error">o</span><span class="error">k</span><span class="error">e</span><span class="error">n</span>},
  <span class="key"><span class="delimiter">&quot;</span><span class="content">token_type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">bearer</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id_token</span><span class="delimiter">&quot;</span></span>: <span class="error">$</span>{<span class="error">i</span><span class="error">d</span><span class="error">_</span><span class="error">t</span><span class="error">o</span><span class="error">k</span><span class="error">e</span><span class="error">n</span>},
  <span class="key"><span class="delimiter">&quot;</span><span class="content">not-before-policy</span><span class="delimiter">&quot;</span></span>: <span class="integer">0</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">session_state</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ccea4a55-9aec-4024-b11c-44f6f168439e</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Keycloak can authenticate your client application in different ways. For simplicity, the <strong>client_credentials</strong> grant type is used here,
which requires a <em>client_id</em> and a <em>client_secret</em>. You can choose to use any supported authentication method.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_service_protection_resources_api"><a class="anchor" href="#_service_protection_resources_api"></a>Managing resources</h4>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/service-protection-resources-api-papi.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/service-protection-resources-api-papi.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/service-protection-resources-api-papi.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>Resource servers can manage their resources remotely using a UMA-compliant endpoint.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://${host}:${port}/realms/${realm_name}/authz/protection/resource_set</code></pre>
</div>
</div>
<div class="paragraph">
<p>This endpoint provides operations outlined as follows (entire path omitted for clarity):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create resource set description: POST /resource_set</p>
</li>
<li>
<p>Read resource set description: GET /resource_set/{_id}</p>
</li>
<li>
<p>Update resource set description: PUT /resource_set/{_id}</p>
</li>
<li>
<p>Delete resource set description: DELETE /resource_set/{_id}</p>
</li>
<li>
<p>List resource set descriptions: GET /resource_set</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about the contract for each of these operations, see <a href="https://docs.kantarainitiative.org/uma/wg/oauth-uma-federated-authz-2.0-09.html#reg-api">UMA Resource Registration API</a>.</p>
</div>
<div class="sect4">
<h5 id="creating-a-resource"><a class="anchor" href="#creating-a-resource"></a>Creating a resource</h5>
<div class="paragraph">
<p>To create a resource you must send an HTTP POST request as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -v -X POST \
  http://${host}:${port}/realms/${realm_name}/authz/protection/resource_set \
  -H 'Authorization: Bearer '$pat \
  -H 'Content-Type: application/json' \
  -d '{
     &quot;name&quot;:&quot;Tweedl Social Service&quot;,
     &quot;type&quot;:&quot;http://www.example.com/rsrcs/socialstream/140-compatible&quot;,
     &quot;icon_uri&quot;:&quot;http://www.example.com/icons/sharesocial.png&quot;,
     &quot;resource_scopes&quot;:[
         &quot;read-public&quot;,
         &quot;post-updates&quot;,
         &quot;read-private&quot;,
         &quot;http://www.example.com/scopes/all&quot;
      ]
  }'</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the owner of a resource is the resource server. If you want to define a different owner, such as a
specific user, you can send a request as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -v -X POST \
  http://${host}:${port}/realms/${realm_name}/authz/protection/resource_set \
  -H 'Authorization: Bearer '$pat \
  -H 'Content-Type: application/json' \
  -d '{
     &quot;name&quot;:&quot;Alice Resource&quot;,
     &quot;owner&quot;: &quot;alice&quot;
  }'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where the property <code>owner</code> can be set with the username or the identifier of the user.</p>
</div>
</div>
<div class="sect4">
<h5 id="creating-user-managed-resources"><a class="anchor" href="#creating-user-managed-resources"></a>Creating user-managed resources</h5>
<div class="paragraph">
<p>By default, resources created via Protection API can not be managed by resource owners through the <a href="#_service_authorization_my_resources">Account Console</a>.</p>
</div>
<div class="paragraph">
<p>To create resources and allow resource owners to manage these resources, you must set <code>ownerManagedAccess</code> property as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -v -X POST \
  http://${host}:${port}/realms/${realm_name}/authz/protection/resource_set \
  -H 'Authorization: Bearer '$pat \
  -H 'Content-Type: application/json' \
  -d '{
     &quot;name&quot;:&quot;Alice Resource&quot;,
     &quot;owner&quot;: &quot;alice&quot;,
     &quot;ownerManagedAccess&quot;: true
  }'</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="updating-resources"><a class="anchor" href="#updating-resources"></a>Updating resources</h5>
<div class="paragraph">
<p>To update an existing resource, send an HTTP PUT request as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -v -X PUT \
  http://${host}:${port}/realms/${realm_name}/authz/protection/resource_set/{resource_id} \
  -H 'Authorization: Bearer '$pat \
  -H 'Content-Type: application/json' \
  -d '{
     &quot;_id&quot;: &quot;Alice Resource&quot;,
     &quot;name&quot;:&quot;Alice Resource&quot;,
     &quot;resource_scopes&quot;: [
        &quot;read&quot;
     ]
  }'</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="deleting-resources"><a class="anchor" href="#deleting-resources"></a>Deleting resources</h5>
<div class="paragraph">
<p>To delete an existing resource, send an HTTP DELETE request as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -v -X DELETE \
  http://${host}:${port}/realms/${realm_name}/authz/protection/resource_set/{resource_id} \
  -H 'Authorization: Bearer '$pat</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="querying-resources"><a class="anchor" href="#querying-resources"></a>Querying resources</h5>
<div class="paragraph">
<p>To query the resources by <code>id</code>, send an HTTP GET request as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">http://${host}:${port}/realms/${realm_name}/authz/protection/resource_set/{resource_id}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To query resources given a <code>name</code>, send an HTTP GET request as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">http://${host}:${port}/realms/${realm_name}/authz/protection/resource_set?name=Alice Resource</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the <code>name</code> filter will match any resource with the given pattern. To restrict the query to only return resources with an exact match, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">http://${host}:${port}/realms/${realm_name}/authz/protection/resource_set?name=Alice Resource&amp;exactName=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>To query resources given an <code>uri</code>, send an HTTP GET request as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">http://${host}:${port}/realms/${realm_name}/authz/protection/resource_set?uri=/api/alice</code></pre>
</div>
</div>
<div class="paragraph">
<p>To query resources given an <code>owner</code>, send an HTTP GET request as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">http://${host}:${port}/realms/${realm_name}/authz/protection/resource_set?owner=alice</code></pre>
</div>
</div>
<div class="paragraph">
<p>To query resources given an <code>type</code>, send an HTTP GET request as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">http://${host}:${port}/realms/${realm_name}/authz/protection/resource_set?type=albums</code></pre>
</div>
</div>
<div class="paragraph">
<p>To query resources given an <code>scope</code>, send an HTTP GET request as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">http://${host}:${port}/realms/${realm_name}/authz/protection/resource_set?scope=read</code></pre>
</div>
</div>
<div class="paragraph">
<p>When querying the server for permissions use parameters <code>first</code> and <code>max</code> results to limit the result.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_service_protection_permission_api_papi"><a class="anchor" href="#_service_protection_permission_api_papi"></a>Managing permission requests</h4>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/service-protection-permission-api-papi.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/service-protection-permission-api-papi.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/service-protection-permission-api-papi.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>Resource servers using the UMA protocol can use a specific endpoint to manage permission requests. This endpoint provides a UMA-compliant flow for registering permission requests and obtaining a permission ticket.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://${host}:${port}/realms/${realm_name}/authz/protection/permission</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <a href="#_overview_terminology_permission_ticket">permission ticket</a> is a special security token type representing a permission request. Per the UMA specification, a permission ticket is:</p>
</div>
<div class="paragraph">
<p><code>A correlation handle that is conveyed from an authorization server to a resource server, from a resource server to a client, and ultimately from a client back to an authorization server, to enable the authorization server to assess the correct policies to apply to a request for authorization data.</code></p>
</div>
<div class="paragraph">
<p>In most cases, you won&#8217;t need to deal with this endpoint directly. Keycloak provides a policy enforcer that enables UMA for your
resource server so it can obtain a permission ticket from the authorization server, return this ticket to client application, and enforce authorization decisions based on a final requesting party token (RPT).</p>
</div>
<div class="paragraph">
<p>The process of obtaining permission tickets from Keycloak is performed by resource servers and not regular client applications,
where permission tickets are obtained when a client tries to access a protected resource without the necessary grants to access the resource. The issuance of
permission tickets is an important aspects when using UMA as it allows resource servers to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Abstract from clients the data associated with the resources protected by the resource server</p>
</li>
<li>
<p>Register in the Keycloak authorization requests which in turn can be used later in workflows to grant access based on the resource&#8217;s owner consent</p>
</li>
<li>
<p>Decouple resource servers from authorization servers and allow them to protect and manage their resources using different authorization servers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Client wise, a permission ticket has also important aspects that its worthy to highlight:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Clients don&#8217;t need to know about how authorization data is associated with protected resources. A permission ticket is completely opaque to clients.</p>
</li>
<li>
<p>Clients can have access to resources on different resource servers and protected by different authorization servers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These are just some of the benefits brought by UMA where other aspects of UMA are strongly based on permission tickets, specially regarding
privacy and user controlled access to their resources.</p>
</div>
<div class="sect4">
<h5 id="creating-permission-ticket"><a class="anchor" href="#creating-permission-ticket"></a>Creating permission ticket</h5>
<div class="paragraph">
<p>To create a permission ticket, send an HTTP POST request as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X POST \
  http://${host}:${port}/realms/${realm_name}/authz/protection/permission \
  -H 'Authorization: Bearer '$pat \
  -H 'Content-Type: application/json' \
  -d '[
  {
    &quot;resource_id&quot;: &quot;{resource_id}&quot;,
    &quot;resource_scopes&quot;: [
      &quot;view&quot;
    ]
  }
]'</code></pre>
</div>
</div>
<div class="paragraph">
<p>When creating tickets you can also push arbitrary claims and associate these claims with the ticket:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X POST \
  http://${host}:${port}/realms/${realm_name}/authz/protection/permission \
  -H 'Authorization: Bearer '$pat \
  -H 'Content-Type: application/json' \
  -d '[
  {
    &quot;resource_id&quot;: &quot;{resource_id}&quot;,
    &quot;resource_scopes&quot;: [
      &quot;view&quot;
    ],
    &quot;claims&quot;: {
        &quot;organization&quot;: [&quot;acme&quot;]
    }
  }
]'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where these claims will be available to your policies when evaluating permissions for the resource and scope(s) associated
with the permission ticket.</p>
</div>
</div>
<div class="sect4">
<h5 id="other-non-uma-compliant-endpoints"><a class="anchor" href="#other-non-uma-compliant-endpoints"></a>Other non UMA-compliant endpoints</h5>
<div class="sect5">
<h6 id="creating-permission-ticket-2"><a class="anchor" href="#creating-permission-ticket-2"></a>Creating permission ticket</h6>
<div class="paragraph">
<p>To grant permissions for a specific resource with id {resource_id} to a user with id {user_id}, as an owner of the resource send an HTTP POST request as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X POST \
     http://${host}:${port}/realms/${realm_name}/authz/protection/permission/ticket \
     -H 'Authorization: Bearer '$access_token \
     -H 'Content-Type: application/json' \
     -d '{
       &quot;resource&quot;: &quot;{resource_id}&quot;,
       &quot;requester&quot;: &quot;{user_id}&quot;,
       &quot;granted&quot;: true,
       &quot;scopeName&quot;: &quot;view&quot;
     }'</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="getting-permission-tickets"><a class="anchor" href="#getting-permission-tickets"></a>Getting permission tickets</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl http://${host}:${port}/realms/${realm_name}/authz/protection/permission/ticket \
     -H 'Authorization: Bearer '$access_token</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use any of these query parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>scopeId</code></p>
</li>
<li>
<p><code>resourceId</code></p>
</li>
<li>
<p><code>owner</code></p>
</li>
<li>
<p><code>requester</code></p>
</li>
<li>
<p><code>granted</code></p>
</li>
<li>
<p><code>returnNames</code></p>
</li>
<li>
<p><code>first</code></p>
</li>
<li>
<p><code>max</code></p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="updating-permission-ticket"><a class="anchor" href="#updating-permission-ticket"></a>Updating permission ticket</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X PUT \
     http://${host}:${port}/realms/${realm_name}/authz/protection/permission/ticket \
     -H 'Authorization: Bearer '$access_token \
     -H 'Content-Type: application/json' \
     -d '{
       &quot;id&quot;: &quot;{ticket_id}&quot;
       &quot;resource&quot;: &quot;{resource_id}&quot;,
       &quot;requester&quot;: &quot;{user_id}&quot;,
       &quot;granted&quot;: false,
       &quot;scopeName&quot;: &quot;view&quot;
     }'</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="deleting-permission-ticket"><a class="anchor" href="#deleting-permission-ticket"></a>Deleting permission ticket</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X DELETE http://${host}:${port}/realms/${realm_name}/authz/protection/permission/ticket/{ticket_id} \
     -H 'Authorization: Bearer '$access_token</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_service_authorization_uma_policy_api"><a class="anchor" href="#_service_authorization_uma_policy_api"></a>Managing resource permissions using the Policy API</h4>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/service-protection-policy-api.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/service-protection-policy-api.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/service-protection-policy-api.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>Keycloak leverages the UMA Protection API to allow resource servers to manage permissions for their users. In addition
to the Resource and Permission APIs, Keycloak provides a Policy API from where permissions can be set to resources by resource
servers on behalf of their users.</p>
</div>
<div class="paragraph">
<p>The Policy API is available at:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://${host}:${port}/realms/${realm_name}/authz/protection/uma-policy/{resource_id}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This API is protected by a bearer token that must represent a consent granted by the user to the resource server to manage permissions on his behalf. The bearer token can be a regular access token obtained from the
token endpoint using:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Resource Owner Password Credentials Grant Type</p>
</li>
<li>
<p>Token Exchange, in order to exchange an access token granted to some client (public client) for a token
where audience is the resource server</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="associating-a-permission-with-a-resource"><a class="anchor" href="#associating-a-permission-with-a-resource"></a>Associating a permission with a resource</h5>
<div class="paragraph">
<p>To associate a permission with a specific resource you must send a HTTP POST request as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X POST \
  http://localhost:8180/realms/photoz/authz/protection/uma-policy/{resource_id} \
  -H 'Authorization: Bearer '$access_token \
  -H 'Cache-Control: no-cache' \
  -H 'Content-Type: application/json' \
  -d '{
        &quot;name&quot;: &quot;Any people manager&quot;,
        &quot;description&quot;: &quot;Allow access to any people manager&quot;,
        &quot;scopes&quot;: [&quot;read&quot;],
        &quot;roles&quot;: [&quot;people-manager&quot;]
}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above we are creating and associating a new permission to a resource represented by <code>resource_id</code> where
any user with a role <code>people-manager</code> should be granted with the <code>read</code> scope.</p>
</div>
<div class="paragraph">
<p>You can also create policies using other access control mechanisms, such as using groups:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X POST \
  http://localhost:8180/realms/photoz/authz/protection/uma-policy/{resource_id} \
  -H 'Authorization: Bearer '$access_token \
  -H 'Cache-Control: no-cache' \
  -H 'Content-Type: application/json' \
  -d '{
        &quot;name&quot;: &quot;Any people manager&quot;,
        &quot;description&quot;: &quot;Allow access to any people manager&quot;,
        &quot;scopes&quot;: [&quot;read&quot;],
        &quot;groups&quot;: [&quot;/Managers/People Managers&quot;]
}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or a specific client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X POST \
  http://localhost:8180/realms/photoz/authz/protection/uma-policy/{resource_id} \
  -H 'Authorization: Bearer '$access_token \
  -H 'Cache-Control: no-cache' \
  -H 'Content-Type: application/json' \
  -d '{
        &quot;name&quot;: &quot;Any people manager&quot;,
        &quot;description&quot;: &quot;Allow access to any people manager&quot;,
        &quot;scopes&quot;: [&quot;read&quot;],
        &quot;clients&quot;: [&quot;my-client&quot;]
}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or even using a custom policy using JavaScript:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X POST \
  http://localhost:8180/realms/photoz/authz/protection/uma-policy/{resource_id} \
  -H 'Authorization: Bearer '$access_token \
  -H 'Cache-Control: no-cache' \
  -H 'Content-Type: application/json' \
  -d '{
        &quot;name&quot;: &quot;Any people manager&quot;,
        &quot;description&quot;: &quot;Allow access to any people manager&quot;,
        &quot;scopes&quot;: [&quot;read&quot;],
        &quot;condition&quot;: &quot;my-deployed-script.js&quot;
}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to set any combination of these access control mechanisms.</p>
</div>
<div class="paragraph">
<p>To update an existing permission, send an HTTP PUT request as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X PUT \
  http://localhost:8180/realms/photoz/authz/protection/uma-policy/{permission_id} \
  -H 'Authorization: Bearer '$access_token \
  -H 'Content-Type: application/json' \
  -d '{
    &quot;id&quot;: &quot;21eb3fed-02d7-4b5a-9102-29f3f09b6de2&quot;,
    &quot;name&quot;: &quot;Any people manager&quot;,
    &quot;description&quot;: &quot;Allow access to any people manager&quot;,
    &quot;type&quot;: &quot;uma&quot;,
    &quot;scopes&quot;: [
        &quot;album:view&quot;
    ],
    &quot;logic&quot;: &quot;POSITIVE&quot;,
    &quot;decisionStrategy&quot;: &quot;UNANIMOUS&quot;,
    &quot;owner&quot;: &quot;7e22131a-aa57-4f5f-b1db-6e82babcd322&quot;,
    &quot;roles&quot;: [
        &quot;user&quot;
    ]
}'</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="removing-a-permission"><a class="anchor" href="#removing-a-permission"></a>Removing a permission</h5>
<div class="paragraph">
<p>To remove a permission associated with a resource, send an HTTP DELETE request as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X DELETE \
  http://localhost:8180/realms/photoz/authz/protection/uma-policy/{permission_id} \
  -H 'Authorization: Bearer '$access_token</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="querying-permission"><a class="anchor" href="#querying-permission"></a>Querying permission</h5>
<div class="paragraph">
<p>To query the permissions associated with a resource, send an HTTP GET request as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://${host}:${port}/realms/${realm}/authz/protection/uma-policy?resource={resource_id}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To query the permissions given its name, send an HTTP GET request as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">http://${host}:${port}/realms/${realm}/authz/protection/uma-policy?name=Any people manager</code></pre>
</div>
</div>
<div class="paragraph">
<p>To query the permissions associated with a specific scope, send an HTTP GET request as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://${host}:${port}/realms/${realm}/authz/protection/uma-policy?scope=read</code></pre>
</div>
</div>
<div class="paragraph">
<p>To query all permissions, send an HTTP GET request as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://${host}:${port}/realms/${realm}/authz/protection/uma-policy</code></pre>
</div>
</div>
<div class="paragraph">
<p>When querying the server for permissions use parameters <code>first</code> and <code>max</code> results to limit the result.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_service_rpt_overview"><a class="anchor" href="#_service_rpt_overview"></a>Requesting party token</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/service-rpt-overview.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/service-rpt-overview.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/service-rpt-overview.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>A requesting party token (RPT) is a <a href="https://datatracker.ietf.org/doc/html/rfc7519">JSON web token (JWT)</a> digitally signed using <a href="https://datatracker.ietf.org/doc/html/rfc7515">JSON web signature (JWS)</a>. The token is built based on the OAuth2 access token previously issued by Keycloak to a specific client acting on behalf of a user
or on its own behalf.</p>
</div>
<div class="paragraph">
<p>When you decode an RPT, you see a payload similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">authorization</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">permissions</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">resource_set_id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">d2fe9843-6462-4bfc-baba-b5787bb6e0e7</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">resource_set_name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World Resource</span><span class="delimiter">&quot;</span></span>
        }
      ]
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">jti</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">d6109a09-78fd-4998-bf89-95730dfd0892-1464906679405</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">exp</span><span class="delimiter">&quot;</span></span>: <span class="integer">1464906971</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">nbf</span><span class="delimiter">&quot;</span></span>: <span class="integer">0</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">iat</span><span class="delimiter">&quot;</span></span>: <span class="integer">1464906671</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">sub</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">f1888f4d-5172-4359-be0c-af338505d86c</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">typ</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">kc_ett</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">azp</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">hello-world-authz-service</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>From this token you can obtain all permissions granted by the server from the <strong>permissions</strong> claim.</p>
</div>
<div class="paragraph">
<p>Also note that permissions are directly related with the resources/scopes you are protecting and completely decoupled from
the access control methods that were used to actually grant and issue these same permissions.</p>
</div>
<div class="sect3">
<h4 id="_service_protection_token_introspection"><a class="anchor" href="#_service_protection_token_introspection"></a>Introspecting a requesting party token</h4>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/service-rpt-token-introspection.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/service-rpt-token-introspection.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/service-rpt-token-introspection.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>Sometimes you might want to introspect a requesting party token (RPT) to check its validity or obtain the permissions within the token to enforce authorization decisions on the resource server side.</p>
</div>
<div class="paragraph">
<p>There are two main use cases where token introspection can help you:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When client applications need to query the token validity to obtain a new one with the same or additional permissions</p>
</li>
<li>
<p>When enforcing authorization decisions at the resource server side, especially when none of the built-in policy enforcers fits your application</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="obtaining-information-about-an-rpt"><a class="anchor" href="#obtaining-information-about-an-rpt"></a>Obtaining Information about an RPT</h4>
<div class="paragraph">
<p>The token introspection is essentially a <a href="https://datatracker.ietf.org/doc/html/rfc7662">OAuth2 token introspection</a>-compliant endpoint from which you can obtain information about an RPT.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://${host}:${port}/realms/${realm_name}/protocol/openid-connect/token/introspect</code></pre>
</div>
</div>
<div class="paragraph">
<p>To introspect an RPT using this endpoint, you can send a request to the server as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X POST \
    -H &quot;Authorization: Basic aGVsbG8td29ybGQtYXV0aHotc2VydmljZTpzZWNyZXQ=&quot; \
    -H &quot;Content-Type: application/x-www-form-urlencoded&quot; \
    -d 'token_type_hint=requesting_party_token&amp;token=${RPT}' \
    &quot;http://localhost:8080/realms/hello-world-authz/protocol/openid-connect/token/introspect&quot;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The request above is using HTTP BASIC and passing the client&#8217;s credentials (client ID and secret) to authenticate the client attempting to introspect the token, but you can use any other client authentication method supported by Keycloak.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The introspection endpoint expects two parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>token_type_hint</strong></p>
<div class="paragraph">
<p>Use <strong>requesting_party_token</strong> as the value for this parameter, which indicates that you want to introspect an RPT.</p>
</div>
</li>
<li>
<p><strong>token</strong></p>
<div class="paragraph">
<p>Use the token string as it was returned by the server during the authorization process as the value for this parameter.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a result, the server response is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">permissions</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">resource_id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">90ccc6fc-b296-4cd1-881e-089e1ee15957</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">resource_name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World Resource</span><span class="delimiter">&quot;</span></span>
    }
  ],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">exp</span><span class="delimiter">&quot;</span></span>: <span class="integer">1465314139</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">nbf</span><span class="delimiter">&quot;</span></span>: <span class="integer">0</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">iat</span><span class="delimiter">&quot;</span></span>: <span class="integer">1465313839</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">aud</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">hello-world-authz-service</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">active</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the RPT is not active, this response is returned instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">active</span><span class="delimiter">&quot;</span></span>: <span class="value">false</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="do-i-need-to-invoke-the-server-every-time-i-want-to-introspect-an-rpt"><a class="anchor" href="#do-i-need-to-invoke-the-server-every-time-i-want-to-introspect-an-rpt"></a>Do I need to invoke the server every time I want to introspect an RPT?</h4>
<div class="paragraph">
<p>No. Just like a regular access token issued by a Keycloak server, RPTs also use the
JSON web token (JWT) specification as the default format.</p>
</div>
<div class="paragraph">
<p>If you want to validate these tokens without a call to the remote introspection endpoint, you can decode the RPT and query for its validity locally. Once you decode the token,
you can also use the permissions within the token to enforce authorization decisions.</p>
</div>
<div class="paragraph">
<p>This is essentially what the policy enforcers do. Be sure to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Validate the signature of the RPT (based on the realm&#8217;s public key)</p>
</li>
<li>
<p>Query for token validity based on its <em>exp</em>, <em>iat</em>, and <em>aud</em> claims</p>
</li>
</ul>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://datatracker.ietf.org/doc/html/rfc7519">JSON web token (JWT)</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enforcer_js_adapter"><a class="anchor" href="#_enforcer_js_adapter"></a>JavaScript integration for Policy Enforcer</h2>
<div class="sectionbody">
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak/tree/main/docs/documentation/authorization_services/topics/enforcer-js-adapter.adoc" target="_blank" rel="noopener">Edit this section</a>
<a href="https://github.com/keycloak/keycloak/issues/new?template=bug.yml&amp;title=Docs:%20authorization_services/topics/enforcer-js-adapter.adoc&amp;description=%0A%0AFile:%20authorization_services/topics/enforcer-js-adapter.adoc&amp;version=DEV&amp;behaviorExpected=%3C!--%20describe%20what%20you%20want%20to%20see%20in%20the%20docs%20--%3E&amp;behaviorActual=%3C!--%20describe%20what%20is%20currently%20wrong%20or%20missing%20in%20the%20docs%20--%3E&amp;reproducer=%3C!--%20list%20steps%20in%20the%20application%20that%20show%20behavior%20that%20should%20be%20documented%20--%3E" target="_blank" rel="noopener">Report an issue</a>
</div>
</div>
<div class="paragraph">
<p>The Keycloak Server comes with a JavaScript library you can use to interact with a resource server protected by a policy enforcer.
This library is based on the Keycloak JavaScript adapter, which can be integrated to allow your client to obtain permissions from a Keycloak Server.</p>
</div>
<div class="paragraph">
<p>You can obtain this library by installing it <a href="https://www.npmjs.com/package/keycloak-js">from NPM</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">npm install keycloak-js</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, you can create a <code>KeycloakAuthorization</code> instance as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="reserved">import</span> Keycloak from <span class="string"><span class="delimiter">&quot;</span><span class="content">keycloak-js</span><span class="delimiter">&quot;</span></span>;
<span class="reserved">import</span> KeycloakAuthorization from <span class="string"><span class="delimiter">&quot;</span><span class="content">keycloak-js/authz</span><span class="delimiter">&quot;</span></span>;

const keycloak = <span class="keyword">new</span> Keycloak({
    <span class="comment">// Replace this with your own configuration.</span>
    <span class="key">url</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://keycloak-server</span><span class="delimiter">&quot;</span></span>,
    <span class="key">realm</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">myrealm</span><span class="delimiter">&quot;</span></span>,
    <span class="key">clientId</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">myapp</span><span class="delimiter">&quot;</span></span>
});

const authorization = <span class="keyword">new</span> KeycloakAuthorization(keycloak);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>keycloak-js/authz</code> library provides two main features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Obtain permissions from the server using a permission ticket, if you are accessing a UMA protected resource server.</p>
</li>
<li>
<p>Obtain permissions from the server by sending the resources and scopes the application wants to access.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In both cases, the library allows you to easily interact with both resource server and Keycloak Authorization Services to obtain tokens with
permissions your client can use as bearer tokens to access the protected resources on a resource server.</p>
</div>
<div class="sect2">
<h3 id="handling-authorization-responses-from-a-uma-protected-resource-server"><a class="anchor" href="#handling-authorization-responses-from-a-uma-protected-resource-server"></a>Handling authorization responses from a UMA-Protected resource server</h3>
<div class="paragraph">
<p>If a resource server is protected by a policy enforcer, it responds to client requests based on the permissions carried along with a bearer token.
Typically, when you try to access a resource server with a bearer token that is lacking permissions to access a protected resource, the resource server
responds with a <strong>401</strong> status code and a <code>WWW-Authenticate</code> header.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">HTTP/1.1 401 Unauthorized
WWW-Authenticate: UMA realm=&quot;${realm}&quot;,
    as_uri=&quot;https://${host}:${port}/realms/${realm}&quot;,
    ticket=&quot;016f84e8-f9b9-11e0-bd6f-0021cc6004de&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#_service_uma_authorization_process">UMA Authorization Process</a> for more information.</p>
</div>
<div class="paragraph">
<p>What your client needs to do is extract the permission ticket from the <code><code>WWW-Authenticate</code></code> header returned by the resource server
and use the library to send an authorization request as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="comment">// prepare a authorization request with the permission ticket</span>
const authorizationRequest = { ticket };

<span class="comment">// send the authorization request, if successful retry the request</span>
authorization.authorize(authorizationRequest).then((rpt) =&gt; {
    <span class="comment">// onGrant</span>
}, () =&gt; {
    <span class="comment">// onDeny</span>
}, () =&gt; {
    <span class="comment">// onError</span>
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>authorize</code> function is completely asynchronous and supports a few callback functions to receive notifications from the server:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>onGrant</code>: The first argument of the function. If authorization was successful and the server returned an RPT with the requested permissions, the callback receives the RPT.</p>
</li>
<li>
<p><code>onDeny</code>: The second argument of the function. Only called if the server has denied the authorization request.</p>
</li>
<li>
<p><code>onError</code>: The third argument of the function. Only called if the server responds unexpectedly.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Most applications should use the <code>onGrant</code> callback to retry a request after a 401 response. Subsequent requests should include the RPT as a bearer token for retries.</p>
</div>
</div>
<div class="sect2">
<h3 id="obtaining-entitlements"><a class="anchor" href="#obtaining-entitlements"></a>Obtaining entitlements</h3>
<div class="paragraph">
<p>The <code>keycloak-js/authz</code> library provides an <code>entitlement</code> function that you can use to obtain an RPT from the server by providing
the resources and scopes your client wants to access.</p>
</div>
<div class="listingblock">
<div class="title">Example about how to obtain an RPT with permissions for all resources and scopes the user can access</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">authorization.entitlement(<span class="string"><span class="delimiter">&quot;</span><span class="content">my-resource-server-id</span><span class="delimiter">&quot;</span></span>).then((rpt) =&gt; {
    <span class="comment">// onGrant callback function.</span>
    <span class="comment">// If authorization was successful you'll receive an RPT</span>
    <span class="comment">// with the necessary permissions to access the resource server</span>
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example about how to obtain an RPT with permissions for specific resources and scopes</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">authorization.entitlement(<span class="string"><span class="delimiter">&quot;</span><span class="content">my-resource-server</span><span class="delimiter">&quot;</span></span>, {
    <span class="key">permissions</span>: [
        {
            <span class="key">id</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Some Resource</span><span class="delimiter">&quot;</span></span>
        }
    ]
}).then((rpt) =&gt; {
    <span class="comment">// onGrant</span>
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using the <code>entitlement</code> function, you must provide the <em>client_id</em> of the resource server you want to access.</p>
</div>
<div class="paragraph">
<p>The <code>entitlement</code> function is completely asynchronous and supports a few callback functions to receive notifications from the server:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>onGrant</code>: The first argument of the function. If authorization was successful and the server returned an RPT with the requested permissions, the callback receives the RPT.</p>
</li>
<li>
<p><code>onDeny</code>: The second argument of the function. Only called if the server has denied the authorization request.</p>
</li>
<li>
<p><code>onError</code>: The third argument of the function. Only called if the server responds unexpectedly.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="authorization-request"><a class="anchor" href="#authorization-request"></a>Authorization request</h3>
<div class="paragraph">
<p>Both <code>authorize</code> and <code>entitlement</code> functions accept an authorization request object. This object can be set with the following
properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>permissions</strong></p>
<div class="paragraph">
<p>An array of objects representing the resource and scopes. For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">const authorizationRequest = {
   <span class="key">permissions</span>: [
       {
           <span class="key">id</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Some Resource</span><span class="delimiter">&quot;</span></span>,
           <span class="key">scopes</span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">view</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">edit</span><span class="delimiter">&quot;</span></span>]
       }
   ]
}</code></pre>
</div>
</div>
</li>
<li>
<p><strong>metadata</strong></p>
<div class="paragraph">
<p>An object where its properties define how the authorization request should be processed by the server.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>response_include_resource_name</strong></p>
<div class="paragraph">
<p>A boolean value indicating to the server if resource names should be included in the RPT&#8217;s permissions. If false, only the resource
identifier is included.</p>
</div>
</li>
<li>
<p><strong>response_permissions_limit</strong></p>
<div class="paragraph">
<p>An integer N that defines a limit for the amount of permissions an RPT can have. When used together with
<code>rpt</code> parameter, only the last N requested permissions will be kept in the RPT</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>submit_request</strong></p>
<div class="paragraph">
<p>A boolean value indicating whether the server should create permission requests to the resources and scopes referenced by a permission ticket.
This parameter will only take effect when used together with the <code>ticket</code> parameter as part of a UMA authorization process.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="obtaining-the-rpt"><a class="anchor" href="#obtaining-the-rpt"></a>Obtaining the RPT</h3>
<div class="paragraph">
<p>If you have already obtained an RPT using any of the authorization functions provided by the library, you can always obtain the RPT as follows from the authorization object (assuming that it has been initialized by one of the techniques shown earlier):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">const rpt = authorization.rpt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-09-25 01:19:46 UTC
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.js"></script>

<script>
    const oldtoc = document.getElementById('toctitle').nextElementSibling;
    const newtoc = document.createElement('div');
    newtoc.setAttribute('id', 'tocbot');
    newtoc.setAttribute('class', 'js-toc');
    oldtoc.parentNode.replaceChild(newtoc, oldtoc);
    tocbot.init({ contentSelector: '#content',
        headingSelector: 'h2, h3, h4',
        smoothScroll: false
    });
    const handleTocOnResize = function() {
        const width = window.innerWidth
                    || document.documentElement.clientWidth
                    || document.body.clientWidth;
        if (width < 768) {
            tocbot.refresh({
                contentSelector: '#content',
                headingSelector: 'h2, h3, h4',
                collapseDepth: 6,
                activeLinkClass: 'ignoreactive',
                throttleTimeout: 1000,
                smoothScroll: false
            });
        }
        else {
            tocbot.refresh({
                contentSelector: '#content',
                headingSelector: 'h2, h3, h4',
                smoothScroll: false
            });
        }
    };
    window.addEventListener('resize', handleTocOnResize);
    handleTocOnResize();
</script>
</body>
</html>